/*! For license information please see eq.all.min.js.LICENSE */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.easyquery=e():t.easyquery=e()}(window,function(){return function(n){var i={};function o(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,o),e.l=!0,e.exports}return o.m=n,o.c=i,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=9)}([function(t,e,n){"use strict";var v;n.r(e),function(t){var l={NewQueryName:"[New query]",AltMenuAttribute:"Attribute",AltMenuConstantExpression:"Constant expression",ButtonApply:"Apply",ButtonCancel:"Cancel",ButtonOK:"OK",ButtonClear:"Clear",ButtonEnable:"Toggle enable",MenuEnable:"Enabled",MenuParameterization:"Parameterized",MenuJoinCond:"Use in JOIN",ButtonDelete:"Delete",ButtonAddCondition:"Add condition",ButtonAddPredicate:"Add group of conditions",ButtonSelectAll:"Select all",ButtonDeselectAll:"Clear selection",ButtonAddColumns:"Add column(s)",ButtonAddConditions:"Add condition(s)",CmdAddConditionAfter:"Add a new condition after the current row",CmdAddConditionInto:"Add a new condition",CmdAddPredicateAfter:"Open a bracket after the current row",CmdAddPredicateInto:"Open a bracket",CmdClickToAddCondition:"[Add new condition]",CmdDeleteRow:"Delete this row",ErrIncorrectPredicateTitleFormat:"Incorrect predicate title format",ErrNotNumber:" is not a number",ErrIncorrectInteger:"Incorrect integer value",ErrIncorrectNumberList:"Incorrect list format",False:"False",LinkTypeAll:"all",LinkTypeAny:"any",LinkTypeNone:"none",LinkTypeNotAll:"not all",ConjAll:"and",ConjAny:"or",ConjNotAll:"and",ConjNone:"or",MsgApplySelection:"[Apply selection]",MsgAs:"as",MsgEmptyList:"(empty list)",MsgEmptyListValue:"[select value]",MsgEmptyScalarValue:"[enter value]",MsgSubQueryValue:"[edit sub-query]",MsgEmptyAttrValue:"[select attribute]",MsgEmptyCustomSql:"[enter SQL expression]",MsgCustomSql:"[Custom SQL]",MsgNoResult:"No result",MsgResultCount:"{0} records found",MsgOf:"of",PredicateTitle:"{lt} of the following apply",RootPredicateTitle:"Select records where {lt} of the following apply",StrAddConditions:"Add conditions",SubQueryDialogTitle:"Edit sub-query",SubQueryColumnTitle:"Column:",SubQueryEmptyColumn:"[select column]",SubQueryQueryPanelCaption:"Conditions",True:"True",ButtonSorting:"Sorting",ButtonToAggr:"Change to aggregate column",ButtonToSimple:"Change to simple column",CmdAscending:"Ascending",CmdClickToAddColumn:"[Add new column]",CmdDeleteColumn:"Delete column",CmdDeleteSorting:"Delete sorting",CmdDescending:"Descending",CmdGroupSort:"Sorting",CmdNotSorted:"Not sorted",ColTypeAggrFunc:"Aggregate function",ColTypeCompound:"Calculated",ColTypeGroup:"Column type",ColTypeSimple:"Simple column",HeaderExpression:"Expression",HeaderSorting:"Sorting",HeaderTitle:"Title",SortHeaderColumn:"Column",SortHeaderSorting:"Sorting",StrAddColumns:"Add columns",CustomExpression:"Custom Expression",CmdMoveToStart:"Move to start",CmdMoveRight:"Move right",CmdMoveLeft:"Move left",CmdMoveToEnd:"Move to the end",CmdMoveUp:"Move up",CmdMoveDown:"Move down",ButtonMenu:"Show menu",CmdToSimple:"Not aggregated",CmdMoveToFirst:"Move to the first",CmdMoveToPrev:"Move to the previous",CmdMoveToNext:"Move to the next",CmdMoveToLast:"Move to the last",RowButtonTitle:"Click to see the available options",StrNoFilterDefined:"No filter defined",StrNoFilterClickToAdd:"No filter defined. Click to add a new condition",Today:"Today",Yesterday:"Yesterday",Tomorrow:"Tomorrow",FirstDayOfMonth:"First day of the month",LastDayOfMonth:"Last day of the month",FirstDayOfWeek:"First day of the week",FirstDayOfYear:"First day of the year",FirstDayOfNextWeek:"First day of the next week",FirstDayOfNextMonth:"First day of the next month",FirstDayOfNextYear:"First day of the next week",Now:"Now",HourStart:"This hour start",Midnight:"Midnight",Noon:"Noon",Entities:{},Attributes:{},Operators:{},AggreateFunctions:{}},e={dateFormat:"d MM, yy",decimalSeparator:"."},u={en:{englishName:"English",displayName:"English",texts:l,settings:e}},d="en";function n(t){d=t}function i(t,e){var n=u[t]||{};C.assignDeep(n,e),u[t]=n}t.getLocales=function(){var t=[];for(var e in u)t.push({locale:e,englishName:u[e].englishName,displayName:u[e].displayName});return t.sort(function(t,e){return t.englishName>e.englishName?1:t.englishName===e.englishName?0:-1})},t.getCurrentLocale=function(){return d},t.setCurrentLocale=n,t.setLocale=function(t){n(t)},t.getText=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=u[d]&&u[d].texts||{},i="";if(t&&t.length){for(var o=!1,r=t.length,s=0;s<r;s++){if(!(i=n[t[s]])){o=!0;break}n=i}if(o){var a=u.en&&u.en.texts||l;for(s=0;s<r&&(i=a[t[s]]);s++)n=i}}return i},t.getLocaleSetting=function(t){return(u[d]&&u[d].settings?u[d].settings:e)[t]||e[t]},t.updateLocaleInfo=i,t.addLocale=function(t,e){i(t,e)},t.updateLocaleTexts=function(t,e){var n=u[t];n&&(C.assignDeep(n.texts,e),u[t]=n)}}(v||(v={}));var r,i,_,o,s=function(){function t(t){this.start(t)}return t.prototype.start=function(t){this.formatStr=t,this.pos=0,this.exprNum=0,this.tokenText=""},t.prototype.skipSpaces=function(){for(;this.pos<this.formatStr.length&&" "===this.formatStr.charAt(this.pos);)this.pos++},t.prototype.next=function(){if(this.skipSpaces(),this.pos>=this.formatStr.length)return!1;var t=0;if("{"===this.formatStr.charAt(this.pos)){if((t=this.formatStr.indexOf("}",this.pos))<0)return!1;this.tokenText=this.formatStr.substring(this.pos,t+1),0===this.tokenText.indexOf("{expr")&&(this.token="expression",this.exprNum=parseInt(this.tokenText.substring(5,this.tokenText.length))),this.pos=t+1}else if("["===this.formatStr.charAt(this.pos)&&this.pos<this.formatStr.length-1&&"["===this.formatStr.charAt(this.pos+1))this.pos+=2,t=this.formatStr.indexOf("]]",this.pos),this.token="operator",this.tokenText=this.formatStr.substring(this.pos,t),this.pos=t+2;else{this.token="text";var e=this.formatStr.indexOf("{",this.pos);e<0&&(e=this.formatStr.length);var n=this.formatStr.indexOf("[[",this.pos);n<0&&(n=this.formatStr.length),t=Math.min(e,n),this.tokenText=this.formatStr.substring(this.pos,t).trim(),this.pos=t}return!0},t.prototype.getToken=function(){return{type:this.token,text:this.tokenText,index:this.exprNum-1}},t.prototype.parse=function(){for(var t=[];this.next();)t.push(this.getToken());return t},t}();(i=r||(r={}))[i.Unknown=0]="Unknown",i[i.String=1]="String",i[i.Byte=2]="Byte",i[i.Word=3]="Word",i[i.Int32=4]="Int32",i[i.Int64=5]="Int64",i[i.Bool=6]="Bool",i[i.Float=7]="Float",i[i.Currency=8]="Currency",i[i.BCD=9]="BCD",i[i.Date=10]="Date",i[i.Time=11]="Time",i[i.DateTime=12]="DateTime",i[i.Autoinc=13]="Autoinc",i[i.Memo=14]="Memo",i[i.Blob=15]="Blob",i[i.FixedChar=16]="FixedChar",i[i.Guid=17]="Guid",i[i.Geometry=18]="Geometry",i[i.Geography=19]="Geography",(o=_||(_={}))[o.None=0]="None",o[o.Any=1]="Any",o[o.NotAll=2]="NotAll",o[o.All=3]="All";var C,a,l,u,d,c=[r.Byte,r.Word,r.Int32,r.Int64,r.Float,r.Currency],h=[r.Byte,r.Word,r.Int32,r.Int64];(a=C||(C={})).combinePath=function(t,e){var n=t;return null!=n&&0<n.length?("/"!=n.charAt(n.length-1)&&(n+="/"),n+=e):n=e,n},a.assign=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var i=0;i<e.length;i++){var o=e[i];if(o)for(var r in o)o.hasOwnProperty(r)&&(t[r]=o[r])}return t},a.assignDeep=function t(e){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];for(var o=0;o<n.length;o++){var r=n[o];if(r)for(var s in r)if(r.hasOwnProperty(s)){var a=r[s];null!==a&&"object"==typeof a?(void 0===e[s]&&(e[s]={}),t(e[s],r[s])):e[s]=r[s]}}return e},a.copyArrayFrom=function(t){for(var e=[],n=0,i=t;n<i.length;n++){var o=i[n];e.push(o)}return e},a.generateId=function(){var t=new Date,e=Math.floor(1e4*Math.random());return"Y"+t.getFullYear()+"-M"+t.getMonth()+"-D"+t.getDay()+"-H"+t.getHours()+"-M"+t.getMinutes()+"-S"+t.getSeconds()+"-MS"+t.getMilliseconds()+"-"+e},a.findItemById=function(t,e){for(var n=t.length,i=0;i<n;i++)if(t[i].id===e)return t[i];return null},a.indexOfArrayItem=function(t,e){if(t.indexOf)return t.indexOf(e);for(var n=t.length,i=0;i<n;i++)if(e==t[i])return i;return-1},a.moveArrayItem=function(t,e,n){if(n>=t.length)for(var i=n-t.length;1+i--;)t.push(void 0);t.splice(n,0,t.splice(e,1)[0])},a.removeArrayItem=function(t,e){var n=t.indexOf(e);if(-1!=n)return t.splice(n,1)[0]},a.shiftToFitWindow=function(t,e){var n=document.getElementsByTagName("body")[0],i=window.innerWidth||document.documentElement.clientWidth||n.clientWidth,o=t+e,r=0;return i<o&&t+(r=i-o-10)<0&&(r=10-t),r},a.isObject=function(t){return null!==t&&("function"==typeof t||"object"==typeof t)},a.isNumericType=function(t){return 0<=c.indexOf(t)},a.isIntType=function(t){return 0<=h.indexOf(t)},a.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},a.areCompatibleDataTypes=function(t,e){return void 0===t||void 0===e||t==r.Unknown||e==r.Unknown||t==e||t==r.Date&&e==r.DateTime||t==r.DateTime&&e==r.Date},a.parseOperatorFormat=function(t){var e=v.getText("Operators",t.id,"format");return e||(e=v.getText("Operators",t.id,"displayFormat")),e||(e=t.displayFormat),new s(e).parse()},a.isPropSet=function(t,e){return t[e]||t[e.toLowerCase()]||t[e.toUpperCase()]},a.strToLinkType=function(t){return"All"==t?_.All:"NotAll"==t?_.NotAll:"Any"==t?_.Any:_.None},a.linkTypeToStr=function(t){return t===_.All?"All":t===_.NotAll?"NotAll":t==_.Any?"Any":"None"},u=l||(l={}),d=function(){this.SpecDateValues=[{id:"${Today}",key:"Today",isDefault:!0},{id:"${Yesterday}",key:"Yesterday"},{id:"${Tomorrow}",key:"Tomorrow"},{id:"${FirstDayOfMonth}",key:"FirstDayOfMonth"},{id:"${FirstDayOfYear}",key:"FirstDayOfYear"}],this.SpecTimeValues=[{id:"${Now}",key:"Now",isDefault:!0},{id:"${HourStart}",key:"HourStart"},{id:"${Midnight}",key:"Midnight"},{id:"${Noon}",key:"Noon"}],this.BooleanValues=[{id:"${false}",key:"False"},{id:"${true}",key:"True",isDefault:!0}]},u.constLists=new d,u.predicateLinkTypeList=[{id:"All",key:"LinkTypeAll"},{id:"Any",key:"LinkTypeAny"},{id:"None",key:"LinkTypeNone"},{id:"NotAll",key:"LinkTypeNotAll"}];var x,p,m,f,b,g,y,T,k,w,B=function(){function t(){}return t.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})},t}(),E=function(){function t(t){this.silentMode=0,this.events=new Array,this.source=t}return t.prototype.subscribe=function(t,e){var n=this.getEventRecByType(t),i={id:B.newGuid(),callback:e};return n?n.eventCallbacks.push(i):(n={type:t,eventCallbacks:new Array(i)},this.events.push(n)),i.id},t.prototype.unsubscribe=function(t,e){var n=this.getEventRecByType(t);if(n){var i=-1;for(i=0;i<n.eventCallbacks.length&&n.eventCallbacks[i].id!==e;i++);0<=i&&n.eventCallbacks.splice(i,1)}},t.prototype.fire=function(t,e,n,i){if(void 0===n&&(n=0),void 0===i&&(i=!1),!this.silentMode||i){var o=this.getEventRecByType(t);if(o){var r={type:t,source:this.source,data:e},s=function(){for(var t=0,e=o.eventCallbacks;t<e.length;t++){e[t].callback(r)}};0<n?setTimeout(s,n):s()}}},t.prototype.enterSilentMode=function(){this.silentMode++},t.prototype.exitSilentMode=function(){this.silentMode&&this.silentMode--},t.prototype.isSilent=function(){return 0<this.silentMode},t.prototype.getEventRecByType=function(t){for(var e=0,n=this.events;e<n.length;e++){var i=n[e];if(i.type==t)return i}return null},t}();(p=x||(x={}))[p.Scalar=0]="Scalar",p[p.Const=1]="Const",p[p.Attribute=2]="Attribute",p[p.List=4]="List",p[p.Query=5]="Query",(f=m||(m={}))[f.Unknown=0]="Unknown",f[f.Simple=1]="Simple",f[f.Predicate=51]="Predicate",(g=b||(b={}))[g.Unknown=0]="Unknown",g[g.Constant=1]="Constant",g[g.EntityAttribute=2]="EntityAttribute",g[g.ParentEntityAttribute=3]="ParentEntityAttribute",g[g.AggregateFunction=4]="AggregateFunction",g[g.Query=11]="Query",g[g.CustomSql=21]="CustomSql",(T=y||(y={})).Unknown="Unknown",T.Edit="EDIT",T.DateTime="DATETIME",T.List="LIST",T.SqlList="SQLLIST",T.CustomList="CUSTOMLIST",T.SubQuery="SUBQUERY",(w=k||(k={}))[w.None=0]="None",w[w.Model=1]="Model",w[w.Query=2]="Query",w[w.Result=4]="Result",w[w.All=65535]="All";var q,I,M=n(4),D=function(){function t(){this.id="",this.caption="",this.sqlExpr="",this.displayFormat=""}return t.prototype.loadFromData=function(t){t&&(this.id=t.id,this.caption=t.cptn,this.displayFormat=t.fmt,this.sqlExpr=t.expr)},t}(),S=function(){function t(){this.id="",this.tag=y.Unknown,this.resType=r.Unknown,this.defValue=""}return t.prototype.loadFromData=function(t){t&&(this.id=t.id,this.tag=t.tag,this.defValue=t.defval,this.resType=t.rtype,t.subType&&(this.resType=t.subType),t.name&&(this.name=t.name),t.sql&&(this.sql=t.sql),t.values&&(this.values=t.values))},t}(),A=function(){function t(){this.id="",this.caption="{Unrecognized operator}",this.displayFormat="{expr1} [[{unrecognized operator}]] {expr2}",this.isRange=!1,this.caseIns=!1,this.paramCount=2,this.defaultOperand=new P,this.operands=new Array}return t.prototype.loadFromData=function(t,e){if(e&&(this.id=e.id,this.caption=e.cptn,this.caseIns=e.caseIns,this.isRange=e.isRange,this.displayFormat=e.fmt,this.paramCount=e.pcnt,e.defOperand&&this.defaultOperand.loadFromData(t,e.defOperand),e.editor&&(this.defaultOperand.editor=t.getEditorById(e.editor)||new S),e.operands))for(var n=0;n<e.operands.length;n++){var i=new P;i.loadFromData(t,e.operands[n]),e.editor&&(i.editor=t.getEditorById(e.editor)||new S),this.operands.push(i)}},t}(),P=function(){function t(){this.kind=x.Scalar,this.dataType=r.Unknown,this.editor=new S,this.defValue=""}return t.prototype.loadFromData=function(t,e){this.kind=e.kind,this.dataType=e.dtype,this.defValue=e.val,this.defText=e.txt,e.editor&&(this.editor=t.getEditorById(e.editor)||new S)},t.prototype.copyFrom=function(t){C.assign(this,t)},t}(),O=function(){function r(){this.name="",this.caption="",this.description="",this.useInConditions=!1,this.useInResult=!1,this.attributes=new Array,this.subEntities=new Array}return r.prototype.loadFromData=function(t,e){if(e){if(this.name=e.name,this.caption=e.name,this.description=e.desc,this.useInConditions=e.uic,this.useInResult=e.uir,this.useInSorting=e.uis,this.subEntities=new Array,e.ents)for(var n=0;n<e.ents.length;n++){var i=new r;i.loadFromData(t,e.ents[n]),this.subEntities.push(i)}if(this.attributes=new Array,e.attrs)for(n=0;n<e.attrs.length;n++){var o=new L;o.loadFromData(t,e.attrs[n]),this.attributes.push(o)}}},r}(),L=function(){function t(){this.params=[],this.id="",this.caption="{Unrecognized attribute}",this.dataType=r.String,this.size=0,this.usedInCondition=!1,this.usedInResult=!1,this.usedInSorting=!1,this.defaultOperator="",this.operators=new Array,this.lookupAttr="",this.sqlExpr=""}return t.prototype.loadFromData=function(t,e){e&&(this.id=e.id,this.description=e.desc,this.caption=e.cptn,this.dataType=e.dtype,this.usedInCondition=e.uic,this.usedInResult=e.uir,this.usedInSorting=e.uis,this.size=e.size,this.sqlExpr=e.sqlExpr,this.defaultOperator=e.defOperator,this.operators=e.ops,this.lookupAttr=e.lookupAttr,e.edtr&&(this.defaultEditor=t.getEditorById(e.edtr)||new S))},t}(),j=function(){function o(){this.id=null,this.tag=b.Constant,this.kind=x.Scalar,this.dataType=r.String,this.value="",this.text="",this.distinct=!1,this.args=new Array}return o.prototype.loadFromData=function(t,e){if(e){if(this.id=e.id,this.tag=e.tag,this.tag==b.EntityAttribute||this.tag==b.ParentEntityAttribute)return;if(this.kind=e.kind,this.dataType=e.dtype,e.query&&(this.query=new W(t),this.query.loadFromDataOrJson(e.query)),e.val&&(this.value=e.val,this.text=e.txt),void 0!==e.distinct&&(this.distinct=e.distinct),e.func&&(this.func=e.func,e.args))for(var n=0;n<e.args.length;n++){var i=new o;i.loadFromData(t,e.args[n]),this.args.push(i)}e.sql&&(this.sql=e.sql,this.baseAttrId=e.baseAttrId)}},o.prototype.saveToData=function(){var t={id:this.id,tag:this.tag};if(this.tag==b.EntityAttribute)return t;if(this.query&&(t.query=this.query.toJSONData()),void 0!==this.kind&&(t.kind=this.kind),void 0!==this.dataType&&(t.dtype=this.dataType),this.value&&(t.val=this.value),this.text&&(t.txt=this.text),this.distinct&&(t.distinct=this.distinct),this.func){t.func=this.func,t.args=[];for(var e=0;e<this.args.length;e++)t.args.push(this.args[e].saveToData())}return this.sql&&(t.sql=this.sql,t.baseAttrId=this.baseAttrId),t},o}();(I=q||(q={}))[I.None=0]="None",I[I.Ascending=1]="Ascending",I[I.Descending=2]="Descending";var Q,R,F=function(){function t(){this.readOnly=!1,this.params=[],this.caption="",this.sorting=q.None,this.sortIndex=-1,this.expr=new j,this.blockId=""}return t.prototype.loadFromData=function(t,e){e&&(this.caption=e.cptn,void 0!==e.srt&&(this.sorting=e.srt,this.sortIndex=e.srtidx),void 0!==e.readOnly&&(this.readOnly=e.readOnly),this.expr.loadFromData(t,e.expr),this.blockId=e.blockId)},t.prototype.saveToData=function(){var t={};return this.caption&&(t.cptn=this.caption),void 0!==this.sorting&&(t.srt=this.sorting,t.srtidx=this.sortIndex),t.expr=this.expr.saveToData(),this.blockId&&(t.blockId=this.blockId),t},t}(),N=function(){function r(t){this.linkType=_.All,this.justAdded=!1,this.tag=t||m.Unknown,this.enabled=!0,this.readOnly=!1,this.parameterized=!1,this.inJoin=!1,this.operatorID="",this.blockId="",this.expressions=new Array,this.conditions=new Array}return r.prototype.loadFromData=function(t,e){if(e)if(this.tag=e.tag,this.tag==m.Simple){if(void 0!==e.enabled&&(this.enabled=e.enabled),void 0!==e.readOnly&&(this.readOnly=e.readOnly),void 0!==e.inJoin&&(this.inJoin=e.inJoin),void 0!==e.parameterized&&(this.parameterized=e.parameterized),this.operatorID=e.op,e.exprs)for(var n=0;n<e.exprs.length;n++){var i=new j;i.loadFromData(t,e.exprs[n]),this.expressions.push(i)}}else if(this.linkType=e.linking,e.conds)for(n=0;n<e.conds.length;n++){var o=new r;o.loadFromData(t,e.conds[n]),this.conditions.push(o)}},r.prototype.saveToData=function(){var t={};if(t.tag=this.tag,this.enabled||(t.enabled=this.enabled),this.readOnly&&(t.readOnly=this.readOnly),this.parameterized&&(t.parameterized=this.parameterized),this.inJoin&&(t.inJoin=this.inJoin),this.tag==m.Simple){t.op=this.operatorID,t.exprs=[];for(var e=0;e<this.expressions.length;e++)t.exprs.push(this.expressions[e].saveToData())}else{t.linking=this.linkType,t.conds=[];for(e=0;e<this.conditions.length;e++)t.conds.push(this.conditions[e].saveToData())}return t},r}(),W=function(){function t(t,e,n){this.extraData={},this.isNewbie=!0,this._isModified=!1,this.eventEmitter=new E(this),this.root=new N(m.Predicate),this.columns=new Array,this.justsorted=new Array,this.id||(this.id=C.generateId()),this.setDefaultName(),this.description="",this.modelId="",this.modelName="",this.model=t||new $,e&&this.loadFromData(e),this.attrClassName=n&&n.attrTag||b.EntityAttribute,this.clientListRequestHandler=n?n.clientListRequestHandler:new Array,this.serverListRequestHandler=n?n.serverListRequestHandler:new Array,this.timezoneOffset=(new Date).getTimezoneOffset()}return Object.defineProperty(t.prototype,"isModified",{get:function(){return this._isModified},set:function(t){this._isModified=t},enumerable:!0,configurable:!0}),t.prototype.reset=function(t){void 0===t&&(t=!1),this.clear(!0),this.setId(C.generateId()),this.setDefaultName(),t||this.fireChangedEvent({changeType:"query.reset"}),this._isModified=!1,this.isNewbie=!0},t.prototype.setDefaultName=function(){return this.setName(v.getText("NewQueryName")),this.getName()},t.prototype.loadFromDataOrJson=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=!0),t&&("string"==typeof t?this.loadFromJson(t,e,n):this.loadFromData(t,e,n))},t.prototype.loadFromJson=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=!0);var i=JSON.parse(t);this.loadFromData(i,e,n)},t.prototype.loadFromData=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=!0),this.eventEmitter.enterSilentMode();var i=!1;try{if(this.clear(!0),t){if(this.id=t.id,this.root.loadFromData(this.model,t.root),this.name=t.name,this.description=t.desc,this.justsorted=t.justsortcols,t.cols)for(var o=0;o<t.cols.length;o++){var r=new F;r.loadFromData(this.model,t.cols[o]),this.columns.push(r)}t.extraData&&(this.extraData=t.extraData)}i=!0}finally{this.eventEmitter.exitSilentMode()}i&&(e||this.fireChangedEvent({changeType:"query.all"}),n&&(this.isNewbie=!1,this.isModified=!1))},t.prototype.getModel=function(){return this.model},t.prototype.setModel=function(t){this.model=t},t.prototype.loadModelData=function(t){this.model.setData(t)},t.prototype.toJSON=function(){return JSON.stringify(this.toJSONData())},t.prototype.toJSONData=function(){var t={modelId:this.model?this.model.getId():null,modelName:this.model?this.model.getName():null};t.id=this.id,t.name=this.name,this.description&&(t.desc=this.description),t.cols=[];for(var e=0;e<this.columns.length;e++)t.cols.push(this.columns[e].saveToData());return t.justsortcols=this.justsorted,t.root=this.root.saveToData(),this.extraData&&(t.extraData=this.extraData),t.timezoneOffset=this.timezoneOffset,t},t.prototype.isEmptyConditions=function(){return!this.root||!this.root.conditions||0===this.root.conditions.length},t.prototype.isEmptyColumns=function(){return!this.columns||0===this.columns.length},t.prototype.beginUpdate=function(){this.eventEmitter.enterSilentMode()},t.prototype.endUpdate=function(t){void 0===t&&(t=!1),this.eventEmitter.exitSilentMode(),!this.eventEmitter.isSilent()&&t&&this.fireChangedEvent({changeType:"query.all"})},t.prototype.clear=function(t){void 0===t&&(t=!1),this.beginUpdate();try{this.clearColumns(),this.clearConditions()}finally{this.endUpdate(!1),t||this.fireChangedEvent({changeType:"query.clear"})}},t.prototype.clearColumns=function(){this.columns=[],this.justsorted=[],this.fireChangedEvent({changeType:"query.columns.clear"})},t.prototype.clearConditions=function(){this.root.conditions=[],this.root.linkType=_.All,this.root.enabled=!0,this.fireChangedEvent({changeType:"query.conditions.clear"})},t.prototype.getId=function(){return this.id},t.prototype.setId=function(t){this.id=t},t.prototype.getName=function(){return this.name},t.prototype.setName=function(t){this.name=t},t.prototype.getDescription=function(){return this.description},t.prototype.setDescription=function(t){this.description=t},t.prototype.getColumns=function(){return this.columns},t.prototype.getSortedColumns=function(){for(var t,e=new Array,n=this.getColumns(),i=0;i<n.length;i++)0<=(t=n[i]).sortIndex&&e.push(t);return e.sort(function(t,e){return t.sortIndex-e.sortIndex}),e},t.prototype.getColumnSortIndex=function(t){if(t.sorting==q.None)return-1;if(t.sortIndex<0){var e=this.getColumns();return C.indexOfArrayItem(e,t)}return t.sortIndex},t.prototype.addColumn=function(t,e){var n,i=this.columns;if(t.column)n=t.column;else{n=new F;var o=void 0;if(t.attribute)o=t.attribute;else{if(!t.attributeId)throw new Error("Not enought data: addColumn");if(!(o=this.model.getAttributeById(t.attributeId)))throw new Error("Incorrect attribute id: addColumn")}var r=new j;r.id=o.id,r.tag=b.EntityAttribute,n.expr=r,n.caption=t.caption||o.caption,n.sorting=t.sorting||q.None,n.sortIndex=t.sortIndex||-1}t.index&&0<=t.index&&t.index<i.length?i.splice(t.index,0,n):i.push(n),this.fireChangedEvent({author:e,changeType:"column.add",column:n})},t.prototype.addColumnObj=function(t,e,n){var i=this.columns;void 0===t.length?"number"==typeof e?i.splice(e,0,t):i.push(t):"number"==typeof e?i.push.apply(i,[e,0].concat(t)):i.push.apply(i,[].concat(t)),this.fireChangedEvent({author:n,changeType:"column.add",column:t})},t.prototype.moveColumn=function(t,e,n){var i=this.getColumns(),o=i[t];C.moveArrayItem(i,t,e),this.fireChangedEvent({author:n,changeType:"column.move",column:o})},t.prototype.removeColumn=function(t,e){var n=this.getColumns(),i=n.indexOf(t);0<=i&&(n.splice(i,1),this.fireChangedEvent({author:e,changeType:"column.remove",column:t}))},t.prototype.addSearchCondition=function(t){var e=t.parent||this.getRootCondition(),n=this.getModel(),i=n.getFirstUICAttr(),o=n.getDefaultOperatorForAttr(i),r=this.createSimpleConditionObject(i,o,""),s=e.linkType===_.All?_.Any:_.All,a=new N(m.Predicate);return a.linkType=s,a.conditions.push(r),a},t.prototype.addSimpleCondition=function(t,e){var n=t.parent||this.getRootCondition(),i=this.getModel();if(!i)return null;if(!t.attribute&&!t.attributeId)throw new Error("Either `attribute` or `attributeId` parameter must have a value");if(!t.attribute&&(t.attribute=i.getAttributeById(t.attributeId),!t.attribute))throw new Error("Could not find this attribute: "+t.attributeId);!t.operator&&t.operatorId&&(t.operator=i.getOperatorById(t.operatorId)),t.operator||(t.operator=i.getDefaultOperatorForAttr(t.attribute));var o=this.createSimpleConditionObject(t.attribute,t.operator,t.value);return n.conditions.push(o),this.fireChangedEvent({author:e,changeType:"condition.add",condition:o}),o},t.prototype.createValueExpr=function(t,e,n,i){var o=this.getModel().getOperand(t,e,n),r=void 0===i,s=new j;if(o.kind===x.Query)s.tag=b.Query,s.dataType=o.dataType,s.kind=o.kind,s.value=i,s.text="";else if(o.kind===x.Attribute){if(!r){var a=this.getModel().getFirstAttributeByFilter(function(t){return 1==t.usedInCondition&&(!o.dataType||t.dataType==o.dataType)});i=a?a.id:null}s.tag=b.EntityAttribute,s.dataType=o.dataType,s.kind=o.kind,s.id=i,s.value=i,s.text=""}else r&&(i=o.defValue&&""!=o.defValue?o.defValue:o.editor&&o.editor.defValue?o.editor.defValue:""),s.tag=b.Constant,s.dataType=o.dataType,s.kind=o.kind,s.value=i,s.text=i;return s},t.prototype.createSimpleConditionObject=function(t,e,n){if(!t)return null;if(!t.usedInCondition)return null;var i=new j;i.id=t.id,i.tag=this.attrClassName;var o=new N(m.Simple);if(o.enabled=!0,o.operatorID=e.id,o.expressions.push(i),null!=n)if(Array.isArray(n))for(var r=n.length,s=0;s<r;s++)o.expressions.push(this.createValueExpr(t,e,s+1,n[s]));else o.expressions.push(this.createValueExpr(t,e,1,n));return o},t.prototype.removeColumns=function(t,e){for(var n=this.getColumns(),i=t.length,o=0;o<i;o++){var r=n.indexOf(t[o]);0<=r&&n.splice(r,1)}this.fireChangedEvent({author:e,changeType:"column.remove",column:t})},t.prototype.fireProcessEvent=function(t){this.eventEmitter.fire("query.process",t)},t.prototype.fireChangedEvent=function(t,e,n){void 0===e&&(e=!0),void 0===n&&(n=100),this.isModified=e,this.eventEmitter.fire("query.change",t,n)},t.prototype.runThroughConditions=function(i){var o=function(t){for(var e=0;e<t.conditions.length;e++){var n=t.conditions[e];n.conditions?o(n):i&&i(n)}};o(this.getRootCondition())},t.prototype.getOneValueForAttr=function(e){var n=null;return this.runThroughConditions(function(t){t.enabled&&(t.expressions[0].id!=e||!t.expressions[1]||"Equal"!=t.operatorID&&"InList"!=t.operatorID&&"StartsWith"!=t.operatorID||(n=t.expressions[1].value))}),n},t.prototype.getRootCondition=function(){return this.root},t.prototype.addProcessCallback=function(t){return this.eventEmitter.subscribe("query.process",t)},t.prototype.removeProcessCallback=function(t){this.eventEmitter.unsubscribe("query.process",t)},t.prototype.addChangedCallback=function(t){return this.eventEmitter.subscribe("query.change",t)},t.prototype.removeChangedCallback=function(t){this.eventEmitter.unsubscribe("query.change",t)},t.prototype.getConditionsText=function(){var g=this.getModel();if(!g)return"";var y=function(t){var e,n,i="",o="Conj"+C.linkTypeToStr(t.linkType),r=v.getText(o);for(n=0;n<t.conditions.length;n++){e="";var s=t.conditions[n];if(s.enabled||void 0===s.enabled)if(s.conditions&&s.conditions.length)(e=y(s))&&(e="("+e+")");else for(var a=s.operatorID,l=g.getOperatorById(a),u=C.parseOperatorFormat(l),d=u.length,c=0;c<d;c++){var h=u[c],p=h.text;if("expression"==h.type){var m=s.expressions[h.index];if(m.kind==x.Attribute||m.tag==b.EntityAttribute){var f=g.getAttributeById(m.id);p=g.getAttributeText(f,"{entity} {attr}")}else p=m.text}0<c&&(e+=" "),e+=p}e&&(0<n&&i&&(i+=" "+r+" "),i+=e)}return t.linkType!=_.None&&t.linkType!=_.NotAll||(i="not ( "+i+" )"),i};return y(this.getRootCondition())},t}(),$=function(){function t(){this.id="",this.name="",this.eqlcns=null,this.operators=new Array,this.rootEntity=new O,this.aggrFunctions=new Array,this.dateMacros=["${Today}","${Yesterday}","${Tomorrow}","${FirstDayOfMonth}","${LastDayOfMonth}","${FirstDayOfWeek}","${FirstDayOfYear}","${FirstDayOfNextWeek}","${FirstDayOfNextMonth}","${FirstDayOfNextYear}"],this.timeMacros=["${Now}","${HourStart}","${Midnight}","${Noon}"],this.rgdlceval=!1}return t.prototype.loadFromJSON=function(t){var e=JSON.parse(t);this.loadFromData(e)},t.prototype.loadFromData=function(t){if(this.id=t.id,this.name=t.name,this.version=t.vers,t.easyQuery&&(this.eqlcns=new V,this.eqlcns.loadFromData(t.easyQuery),this.rgdlceval=this.eqlcns.chkrgd()),this.editors=new Array,t.editors)for(var e=0;e<t.editors.length;e++){var n=new S;n.loadFromData(t.editors[e]),this.editors.push(n)}if(this.operators=new Array,t.operators)for(e=0;e<t.operators.length;e++){var i=new A;i.loadFromData(this,t.operators[e]),this.operators.push(i)}if(this.rootEntity.loadFromData(this,t.entroot),this.aggrFunctions=new Array,t.aggrfuncs)for(e=0;e<t.aggrfuncs.length;e++){var o=new D;o.loadFromData(t.aggrfuncs[e]),this.aggrFunctions.push(o)}},t.prototype.getObject=function(){return this},t.prototype.setData=function(t){"string"==typeof t?this.loadFromJSON(t):this.loadFromData(t)},t.prototype.createQuery=function(){return new W(this)},t.prototype.isEmpty=function(){return 0===this.rootEntity.subEntities.length&&0===this.rootEntity.attributes.length},t.prototype.getId=function(){return this.id},t.prototype.getName=function(){return this.name},t.prototype.getRootEntity=function(){return this.rootEntity},t.prototype.rgdlce=function(){return this.rgdlceval},t.prototype.getEditorById=function(t){for(var e=0,n=this.editors;e<n.length;e++){var i=n[e];if(i.id===t)return i}return null},t.prototype.getAttributeById=function(t){var e=this.getEntityAttrById(this.getRootEntity(),t);return e||(e=new L),e},t.prototype.checkAttrProperty=function(t,e){var n=this.getAttributeById(t);return!!n&&(!!n[e]||!!n.lookupAttr&&(t=n.lookupAttr,(n=this.getAttributeById(t))&&n[e]))},t.prototype.getEntityAttrById=function(t,e){var n,i;if(t.attributes){var o=t.attributes.length;for(n=0;n<o;n++)if(t.attributes[n].id==e)return t.attributes[n]}if(t.subEntities){var r=t.subEntities.length;for(n=0;n<r;n++)if(i=this.getEntityAttrById(t.subEntities[n],e))return i}return null},t.prototype.listByEntityWithFilter=function(t,e){var n,i=new Array,o=null;if(t.subEntities)for(var r=t.subEntities.length,s=0;s<r;s++){if(o=t.subEntities[s],!e||e(o))(n=v.getText("Entities",o.name))||(n=o.caption),(d=C.assign(new O,{id:o.name,text:n,items:[],isEntity:!0})).items=this.listByEntityWithFilter(o,e),0<d.items.length&&i.push(d)}var a=null;if(t.attributes)for(var l=t.attributes.length,u=0;u<l;u++)if(a=t.attributes[u],!e||e(a)){(n=v.getText("Attributes",a.id))||(n=a.caption);var d=C.assign(new O,{id:a.id,text:n,dataType:a.dataType});i.push(d)}return i},t.prototype.listByEntity=function(t,e){e=e||{};var n,i=[],o=[],r=null;if(t.subEntities)for(var s=t.subEntities.length,a=0;a<s;a++)if(r=t.subEntities[a],!1!==e.addUIC&&!1!==r.useInConditions||!1!==e.addUIR&&!1!==r.useInResult||!1!==e.addUIS&&!1!==r.useInSorting){(n=v.getText("Entities",r.name))||(n=r.caption);var l=C.assign(new O,{id:r.name,text:n,items:[],isEntity:!0,description:r.description}),u=C.assign({},e);u.includeRootData=!1,l.items=this.listByEntity(r,u),i.push(l)}var d=null;if(t.attributes)for(var c=t.attributes.length,h=0;h<c;h++)d=t.attributes[h],(!1!==e.addUIC&&!1!==d.usedInCondition||!1!==e.addUIR&&!1!==d.usedInResult||!1!==e.addUIS&&!1!==d.usedInSorting)&&((n=v.getText("Attributes",d.id))||(n=d.caption),o.push(C.assign(new L,{id:d.id,text:n,dataType:d.dataType,lookupAttr:d.lookupAttr,description:d.description})));var p,m=function(t,e){return t.text.toLowerCase()==e.text.toLowerCase()?0:t.text.toLowerCase()>e.text.toLowerCase()?1:-1};return e.sortEntities&&(i.sort(m),o.sort(m)),p=e.attrPlacement&&0!=e.attrPlacement?o.concat(i):i.concat(o),2==e.attrPlacement&&p.sort(m),e.includeRootData?((n=v.getText("Entities",t.name))||(n=t.caption),{id:t.name,text:n,items:p}):p},t.prototype.getEntitiesTree=function(t){return this.listByEntity(this.getRootEntity(),t)},t.prototype.getEntitiesTreeWithFilter=function(t){return this.listByEntityWithFilter(this.getRootEntity(),t)},t.prototype.getFullEntityPathByAttr=function(t,e){return e=e||" ",this.getEntityPathByAttr(this.getRootEntity(),t,e,!0)},t.prototype.getEntityPathByAttr=function(t,e,n,i){if(!t)return"";n=n||" ";var o="";if(t.caption&&!i){var r=v.getText("Entities",t.caption);o=r||t.caption}if(t.attributes)for(var s=t.attributes.length,a=0;a<s;a++)if(t.attributes[a].id==e)return o;if(t.subEntities){var l=t.subEntities.length;for(a=0;a<l;a++){var u=t.subEntities[a],d=this.getEntityPathByAttr(u,e,n,!1);if(""!==d)return""!==o&&(d=o+n+d),d}}return""},t.prototype.getAttributeText=function(t,e){var n=v.getText("Attributes",t.id);if(n||(n=t.caption),!e)return n;var i=this.getFullEntityPathByAttr(t.id," ");return(i?e.replace(new RegExp("{attr}","g"),n).replace(new RegExp("{entity}","g"),i):n).trim()},t.prototype.getFirstUICAttr=function(){return this.getFirstUICAttrInEntity(this.getRootEntity())},t.prototype.getFirstUICAttrInEntity=function(t){if(!1!==t.useInConditions){if(t.attributes)for(var e=t.attributes.length,n=0;n<e;n++)if(t.attributes[n].usedInCondition)return t.attributes[n];if(t.subEntities){var i=t.subEntities.length;for(n=0;n<i;n++){var o=this.getFirstUICAttrInEntity(t.subEntities[n]);if(o)return o}}}return null},t.prototype.runThroughEntities=function(r,s){var a={stop:!1},l=function(t){if(s&&s(t,a),t.attributes)for(var e=t.attributes.length,n=0;n<e&&!a.stop;n++){var i=t.attributes[n];if(r&&r(i,a),a.stop)return}if(t.subEntities){var o=t.subEntities.length;for(n=0;n<o&&!a.stop;n++)l(t.subEntities[n])}};l(this.getRootEntity())},t.prototype.getFirstAttributeByFilter=function(n){var i=null;return this.runThroughEntities(function(t,e){n(t)&&(e.stop=!0,i=t)},null),i},t.prototype.findOperatorById=function(t){if(0<this.operators.length)for(var e=this.operators.length,n=0;n<e;n++)if(this.operators[n].id==t)return this.operators[n];return null},t.prototype.getOperatorById=function(t){var e=this.findOperatorById(t);return e||(e=new A),e},t.prototype.getDefaultOperatorIdForAttr=function(t){return t.defaultOperator?t.defaultOperator:0<t.operators.length?t.operators[0]:(new A).id},t.prototype.getAggrFunctionCaption=function(t){var e=v.getText("AggregateFunctions",t),n=e?e.caption:v.getText("Aggr"+t.replace(" ","")+"_Caption");if(n)return n;var i=C.findItemById(this.aggrFunctions,t);return i&&i.caption?i.caption:t},t.prototype.getAggrFunctionFormat=function(t){var e=v.getText("AggregateFunctions",t),n=e?e.displayFormat:v.getText("Aggr"+t.replace(" ","")+"_Format");if(n)return n;var i=C.findItemById(this.aggrFunctions,t);return i&&i.displayFormat?i.displayFormat:""},t.prototype.getDefaultOperatorForAttr=function(t){var e=this.getDefaultOperatorIdForAttr(t);return this.getOperatorById(e)},t.prototype.getOperand=function(t,e,n){var i=new P;e&&e.defaultOperand?(i.copyFrom(e.defaultOperand),i.defValue||(i.defValue=""),i.defText||(i.defText="")):(i.kind=x.Scalar,i.dataType=r.Unknown,i.defValue="",i.defText="",i.editor=null);var o=i;return o.dataType===r.Unknown&&t&&(o.dataType=t.dataType),e&&0<=n&&e.operands&&e.operands[n-1]&&(o=C.assign(o,e.operands[n-1])),o.editor||(i.editor?o.editor=i.editor:i.kind===x.Query?o.editor.tag=y.SubQuery:t&&t.defaultEditor?o.editor=t.defaultEditor:o.dataType===r.Date||o.dataType===r.DateTime||o.dataType===r.Time?o.editor.tag=y.DateTime:o.editor.tag=y.Edit),o},t.prototype.getAggrFunctions=function(){return this.aggrFunctions},t.prototype.getDateMacroValue=function(t){var e=new Date;if(this.isDateMacro(t)){switch(t){case"${Today}":break;case"${Yesterday}":e.setDate(e.getDate()-1);break;case"${Tomorrow}":e.setDate(e.getDate()+1);break;case"${FirstDayOfMonth}":e.setDate(1);break;case"${LastDayOfMonth}":e.setMonth(e.getMonth()+1,0);break;case"${FirstDayOfWeek}":n=0==(n=e.getDay())?6:n-1,e.setDate(e.getDate()-n);break;case"${FirstDayOfYear}":e.setMonth(0,1);break;case"${FirstDayOfNextWeek}":var n;n=0==(n=e.getDay())?1:8-n,e.setDate(e.getDate()+n);break;case"${FirstDayOfNextMonth}":e.setMonth(e.getMonth()+1,1);break;case"${FirstDayOfNextYear}":e.setFullYear(e.getFullYear()+1,0,1)}return e}return null},t.prototype.isDateMacro=function(t){return 0<=C.indexOfArrayItem(this.dateMacros,t)},t.prototype.getDateOrMacroValue=function(t){var e=this.getDateMacroValue(t);return e||t},t.prototype.getTimeMacroValue=function(t){var e=new Date;if(this.isTimeMacro(t)){switch(t){case"${Now}":break;case"${HourStart}":e.setMinutes(0,0,0);break;case"${Midnight}":e.setHours(0,0,0,0);break;case"${Noon}":e.setHours(12,0,0,0)}return e}return null},t.prototype.isTimeMacro=function(t){return 0<=C.indexOfArrayItem(this.timeMacros,t)},t.prototype.getTimeOrMacroValue=function(t){var e=this.getTimeMacroValue(t);return e||t},t}(),V=function(){function t(){this.version="5.0.0",this.token="                "}return t.prototype.loadFromData=function(t){t.version&&(this.version=t.version),t.token&&(this.token=t.token)},t.prototype.chkrgd=function(){var t=this.token,e=this.version.split("."),n=0<e.length?parseInt(e[0]):0,i=1<e.length?parseInt(e[1]):0;return n%10+i%10+65==t.charCodeAt(i%14+2)},t}();(R=Q||(Q={}))[R.Error=0]="Error",R[R.Success=1]="Success";var z=function(){function t(){this.internalListCache={},this.paging={},this.useBootstrap=!1,this.loadModelOnStart=!0,this.loadQueryOnStart=!1,this.dataModel=new $,this.query=new W(this.dataModel),this.widgets=new Array,this.eventEmitter=new E(this)}return t.prototype.init=function(n){var i=this;(n=n||{}).defaultQueryId&&this.query.setId(n.defaultQueryId),n.listCache&&this.setExternalListCache(n.listCache),n.broker&&(this.broker=n.broker.resolver(this)),n.locale&&v.setCurrentLocale(n.locale),this.loadQueryOnStart=!1,n.loadQueryOnStart&&(this.loadQueryOnStart=n.loadQueryOnStart),this.loadModelOnStart=!0,void 0!==n.loadModelOnStart&&(this.loadModelOnStart=n.loadModelOnStart),n.handlers&&(n.handlers.onInit&&this.addEventListener("ready",n.handlers.onInit),n.handlers.onLoadModel&&this.addEventListener("loadModel",n.handlers.onLoadModel),n.handlers.onLoadQuery&&this.addEventListener("loadQuery",n.handlers.onLoadQuery),n.handlers.onInitialModelLoad&&this.addEventListener("initialModelLoad",n.handlers.onInitialModelLoad),n.handlers.onProcessStart&&this.addEventListener("processStart",n.handlers.onProcessStart),n.handlers.onProcessEnd&&this.addEventListener("processEnd",n.handlers.onProcessEnd),n.handlers.onError?this.addEventListener("error",n.handlers.onError):this.addEventListener("error",function(t){t.result=Q.Error;var e=t&&t?t.action+" error":"Error",n=t&&t.text?t.text:"";console.error(e+": "+n)}),n.handlers.listRequestHandler&&(this.clientListRequestHandler=n.handlers.listRequestHandler)),this.initialQuery=n.initialQuery,this.defaultQueryId=n.defaultQueryId||"",this.defaultModelId=n.defaultModelId||"",n.broker&&this.broker.init(n.broker),this.widgets.forEach(function(t){var e={};n.widgets&&n.widgets[t.widgetType]&&(e=n.widgets[t.widgetType]),t.init(i,e)}),this.loadModelOnStart?this.loadDefaultModel():this.fireEvent("ready")},t.prototype.addWidget=function(t){this.widgets.push(t)},t.prototype.refreshWidgets=function(e){void 0===e&&(e=k.All),this.widgets.forEach(function(t){t.belongsToGroup(e)&&t.refresh()})},t.prototype.addQueryChangedCallback=function(t){this.query.addChangedCallback(t)},t.prototype.removeQueryChangedCallback=function(t){this.query.removeChangedCallback(t)},t.prototype.getBroker=function(){return this.broker},t.prototype.getQuery=function(){return this.query},t.prototype.getModel=function(){return this.dataModel},t.prototype.setModel=function(t){this.query.loadModelData(t),this.dataModel=this.query.getModel()},t.prototype.setDefaultModelId=function(t){this.defaultModelId=t},t.prototype.newQuery=function(){return this.query.clear(!0),this.query.setId(C.generateId()),this.query.setDefaultName(),this.query},t.prototype.startProcess=function(t,e){this.eventEmitter.fire("processStart",t),this.widgets.forEach(function(t){t.belongsToGroup(e)&&t.onProcessStart()})},t.prototype.endProcess=function(t,e){this.eventEmitter.fire("processEnd",t),this.widgets.forEach(function(t){t.belongsToGroup(e)&&t.onProcessEnd()})},t.prototype.throwError=function(t){t.result=Q.Error,this.eventEmitter.fire("error",t)},t.prototype.loadDefaultModel=function(){var n=this;this.broker.loadModel({modelId:this.defaultModelId,success:function(t){n.refreshWidgets(k.Model);var e=n.getQuery();n.fireEvent("initialModelLoad",e.getModel()),n.initialQuery&&e.loadFromData(n.initialQuery,!0,!1),n.loadQueryOnStart?n.broker.loadQuery({id:n.defaultQueryId,modelId:n.defaultModelId,success:function(){n.refreshWidgets(k.Query),n.fireEvent("ready")}}):(n.refreshWidgets(k.Query),n.fireEvent("ready"))}})},t.prototype.clearQuery=function(){this.query.clear(),this.refreshWidgets(k.Query)},t.prototype.clearResult=function(){(this.resultContent||this.resultStatement||this.resultSet)&&(this.resultStatement=null,this.resultSet=null,this.resultContent=null,this.refreshWidgets(k.Result))},t.prototype.setExternalListCache=function(t){this.externalListCache=t},t.prototype.getListFromCache=function(t){var e="SQL"==t.listName?"SQL_"+t.editorId:t.listName;return this.externalListCache?this.externalListCache.get(e):this.internalListCache[e]},t.prototype.addListToCache=function(t,e){var n="SQL"==t.listName?"SQL_"+t.editorId:t.listName;this.externalListCache?this.externalListCache.set(n,e):this.internalListCache[n]=e},t.prototype.resetListCache=function(){this.externalListCache?this.externalListCache.clear():this.internalListCache={}},t.prototype.getListRequestHandler=function(){var s=this;return function(e,n){if(null!=e&&e.listName){var t=e.listName.match(/{{(.+?)}}/);if(t){var i=s.query.getOneValueForAttr(t[1]);i||(i=""),e.listName=e.listName.replace(/{{.+?}}/,i)}var o=s.getListFromCache(e);if(o&&0<o.length)n(o);else{var r=!1;s.clientListRequestHandler&&(r=s.clientListRequestHandler(e,n)),r||s.broker.loadValueList({params:e,success:function(t){t&&s.addListToCache(e,t),n(t)}})}}}},t.prototype.addLocale=function(t,e){v.addLocale(t,e)},t.prototype.addEventListener=function(t,e){return this.eventEmitter.subscribe(t,function(t){return e(t.data)})},t.prototype.addCustomEventListener=function(t,e){return this.eventEmitter.subscribe(t,function(t){return e(t.data)})},t.prototype.removeEventListener=function(t,e){this.eventEmitter.unsubscribe(t,e)},t.prototype.fireEvent=function(t,e){this.eventEmitter.fire(t,e)},t.prototype.fireCustomEvent=function(t,e){this.eventEmitter.fire(t,e)},t}(),H=function(){function t(t){this.slot=t}return t.prototype.init=function(t,e){this.context=t},t.prototype.getContext=function(){return this.context},t.prototype.refresh=function(){this.refreshCore()},t.prototype.refreshCore=function(){},t.prototype.onProcessStart=function(){this.onProcessStartCore()},t.prototype.onProcessStartCore=function(){},t.prototype.onProcessEnd=function(){this.onProcessEndCore()},t.prototype.onProcessEndCore=function(){},t.prototype.belongsToGroup=function(t){return void 0===t||null==t||0!=(t&this.group)},t}();function U(n){var t=window.XDomainRequest,i=new("onload"in new XMLHttpRequest?XMLHttpRequest:t),e=n.type||"POST";i.open(e,n.url,!0);var o=n.contentType||"application/json";return i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.setRequestHeader("Content-Type",o),n.beforeSend&&n.beforeSend(i,n.data),"string"!=typeof n.data&&0==o.indexOf("application/json")&&(n.data=JSON.stringify(n.data)),i.onreadystatechange=function(){if(4==i.readyState){var t=parseInt(i.status);if(300<=t||t<200)n.error&&n.error(i,t,i.statusText);else if(n.success){var e={};try{e=JSON.parse(i.responseText)}catch(t){e=i.responseText}n.success(e,i)}}},i.send(n.data),i}n.d(e,"equtils",function(){return C}),n.d(e,"eqi18n",function(){return v}),n.d(e,"eqconsts",function(){return l}),n.d(e,"EqGuid",function(){return B}),n.d(e,"EventEmitter",function(){return E}),n.d(e,"DataKind",function(){return x}),n.d(e,"DataType",function(){return r}),n.d(e,"LinkType",function(){return _}),n.d(e,"CondTag",function(){return m}),n.d(e,"ExprTag",function(){return b}),n.d(e,"EditorTag",function(){return y}),n.d(e,"WidgetGroup",function(){return k}),n.d(e,"EqDataTable",function(){return M.a}),n.d(e,"AggrFunction",function(){return D}),n.d(e,"DataModel",function(){return $}),n.d(e,"Entity",function(){return O}),n.d(e,"EntityAttr",function(){return L}),n.d(e,"Expression",function(){return j}),n.d(e,"Operator",function(){return A}),n.d(e,"Operand",function(){return P}),n.d(e,"ValueEditor",function(){return S}),n.d(e,"EqContext",function(){return z}),n.d(e,"Widget",function(){return H}),n.d(e,"EqActionResult",function(){return Q}),n.d(e,"SortDirection",function(){return q}),n.d(e,"Column",function(){return F}),n.d(e,"Condition",function(){return N}),n.d(e,"Query",function(){return W}),n.d(e,"ajax",function(){return U}),n.d(e,"FormatParser",function(){return s})},function(t,e,n){"use strict";var i,o;n.d(e,"a",function(){return i}),(o=i||(i={})).LoadModel="broker.LoadModel",o.LoadQuery="broker.LoadQuery",o.LoadQueryList="broker.LoadQueryList",o.NewQuery="broker.NewQuery",o.SaveQuery="broker.SaveQuery",o.RemoveQuery="broker.RemoveQuery",o.SyncQuery="broker.SyncQuery",o.ExecuteQuery="broker.ExecuteQuery",o.GetValueList="broker.GetValueList",o.ExportResult="broker.ExportResult"},function(t,e,n){"use strict";(function(r){n.d(e,"a",function(){return t});var t=function(){function t(){}return t.prototype.openConfirm=function(t,e,n){if(!n)return new r(function(t){t(confirm(e))});n(confirm(e))},t.prototype.openPrompt=function(t,n,i,e){if(!e)return new r(function(t){for(var e="";!(null===(e=prompt(n,i||""))||0<e.replace(/\s/g,"").length););t(e)});for(var o="";!(null===(o=prompt(n,i||""))||0<o.replace(/\s/g,"").length););e(o)},t}()}).call(this,n(15))},function(t,e,n){"use strict";(function(r){n.d(e,"a",function(){return t});var t=function(){function t(){$("body").append($('<div id="eqv-dialog-confirm" style="display: none"><p id="eqv-dialog-confirm-content"></p></div>')),$("body").append($('<div id="eqv-dialog-form" style="display: none">\n                        <label for="name" id="eqv-dialog-form-content"></label>\n                        <input type="text" name="name" id="eqv-dialog-form-input" class="text ui-widget-content ui-corner-all" />\n                </div>')),this.confirmDialog=$("#eqv-dialog-confirm"),this.promptDialog=$("#eqv-dialog-form"),this.confirmDialog.dialog({dialogClass:"eqv-dialog eq-js-dialog",closeOnEscape:!1,resizable:!1,height:"auto",width:"auto",modal:!0,autoOpen:!1}),this.promptDialog.dialog({dialogClass:"eqv-dialog eq-js-dialog",closeOnEscape:!1,draggable:!1,resizable:!1,height:"auto",width:"auto",modal:!0,autoOpen:!1})}return t.prototype.openConfirm=function(t,e,n){var i=this;return this.confirmDialog.dialog("option","title",t),$("#eqv-dialog-confirm-content").text(e),n?(this.setConfirmButtons(n),void this.confirmDialog.dialog("open")):new r(function(t){i.setConfirmButtons(t),i.confirmDialog.dialog("open")})},t.prototype.setConfirmButtons=function(t){var e=[{text:"OK",click:function(){t(!0),$(this).dialog("close")}},{text:"Cancel",click:function(){t(!1),$(this).dialog("close")}}];this.confirmDialog.dialog("option","buttons",e)},t.prototype.openPrompt=function(t,e,n,i){var o=this;return this.promptDialog.dialog("option","title",t),$("#eqv-dialog-form-content").text(e),$("#eqv-dialog-form-input").val(n||""),i?(this.setPromptButtons(i),void this.promptDialog.dialog("open")):new r(function(t){o.setPromptButtons(t),o.promptDialog.dialog("open")})},t.prototype.setPromptButtons=function(e){var t=[{text:"OK",click:function(){var t=$("#eqv-dialog-form-input").val();t&&0<t.replace(/\s/g,"").length&&(e(t),$(this).dialog("close"))}},{text:"Cancel",click:function(){e(""),$(this).dialog("close")}}];this.promptDialog.dialog("option","buttons",t)},t}()}).call(this,n(16))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return EqDataTable});var EqDataTable=function(){function EqDataTable(t){"string"==typeof t?this.loadFromJSON(t):this.tableObj=t}return EqDataTable.prototype.loadFromJSON=function(t){this.tableObj=JSON.parse(t)},EqDataTable.prototype.toJSON=function(){return JSON.stringify(this.tableObj)},EqDataTable.prototype.getObject=function(){return this.tableObj},EqDataTable.prototype.isEmpty=function(){return 0==this.getNumberOfColumns()||0==this.getNumberOfRows()},EqDataTable.prototype.getNumberOfColumns=function(){return this.tableObj.cols.length},EqDataTable.prototype.getColumnObject=function(t){return t<this.tableObj.cols.length?this.tableObj.cols[t]:null},EqDataTable.prototype.getColumnId=function(t){var e=this.getColumnObject(t);return e?e.id:null},EqDataTable.prototype.getColumnLabel=function(t){var e=this.getColumnObject(t);return e?e.label:null},EqDataTable.prototype.getColumnType=function(t){var e=this.getColumnObject(t);return e?e.type:null},EqDataTable.prototype.getColumnProperties=function(t){var e=this.getColumnObject(t);return e?e.p:null},EqDataTable.prototype.getNumberOfRows=function(){return this.tableObj.rows.length},EqDataTable.prototype.getFormattedValue=function(rowIndex,colIndex){var row=rowIndex<this.tableObj.rows.length?this.tableObj.rows[rowIndex]:null;if(row){var cell=colIndex<this.tableObj.cols.length?row.c[colIndex]:null;if(cell){if(void 0!==cell.f)return cell.f;var v=cell.v,dt;if(null!=v){var colType=this.getColumnType(colIndex);"date"==colType||"datetime"==colType?(dt=eval("new "+v),v="date"==colType?dt.toLocaleDateString():dt.toLocaleString()):"timeofday"==colType&&(dt=new Date,dt.setHours(v[0],v[1],v[2],v[3]),v=dt.toLocaleTimeString())}return v}}return null},EqDataTable}()},function(t,n,i){"use strict";(function(e){i.d(n,"a",function(){return t});var u=i(0),d=i(1),t=function(){function t(t){this.baseEndpoint="/api/easyquery",this.modelPromise=null,this.context=t}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return this.baseEndpoint},set:function(t){this.baseEndpoint=t},enumerable:!0,configurable:!0}),t.prototype.initEndpointResolvers=function(){var i=this;this.getLoadModelEndpoint||(this.getLoadModelEndpoint=function(t){return u.equtils.combinePath(i.baseEndpoint,"models/"+i.ensureUrl(t))}),this.getNewQueryEndpoint||(this.getNewQueryEndpoint=function(t){return u.equtils.combinePath(i.baseEndpoint,"models/"+i.ensureUrl(t)+"/queries")}),this.getLoadQueryEndpoint||(this.getLoadQueryEndpoint=function(t,e){return u.equtils.combinePath(i.baseEndpoint,"models/"+i.ensureUrl(t)+"/queries/"+i.ensureUrl(e))}),this.getSaveQueryEndpoint||(this.getSaveQueryEndpoint=function(t,e){return u.equtils.combinePath(i.baseEndpoint,"models/"+i.ensureUrl(t)+"/queries/"+i.ensureUrl(e))}),this.getSyncQueryEndpoint||(this.getSyncQueryEndpoint=function(t,e){return u.equtils.combinePath(i.baseEndpoint,"models/"+i.ensureUrl(t)+"/queries/"+i.ensureUrl(e)+"/sync")}),this.getExecuteQueryEndpoint||(this.getExecuteQueryEndpoint=function(t,e){return u.equtils.combinePath(i.baseEndpoint,"models/"+i.ensureUrl(t)+"/queries/"+i.ensureUrl(e)+"/execute")}),this.getValueListRequestEndpoint||(this.getValueListRequestEndpoint=function(t,e){return u.equtils.combinePath(i.baseEndpoint,"models/"+i.ensureUrl(t)+"/valuelists/"+e)}),this.getLoadQueryListEndpoint||(this.getLoadQueryListEndpoint=function(t){return u.equtils.combinePath(i.baseEndpoint,"models/"+i.ensureUrl(t)+"/queries")}),this.getRemoveQueryEndpoint||(this.getRemoveQueryEndpoint=function(t,e){return u.equtils.combinePath(i.baseEndpoint,"models/"+i.ensureUrl(t)+"/queries/"+i.ensureUrl(e))}),this.getExportResultEndpoint||(this.getExportResultEndpoint=function(t,e,n){return u.equtils.combinePath(i.baseEndpoint,"models/"+i.ensureUrl(t)+"/queries/"+i.ensureUrl(e)+"/export/"+i.ensureUrl(n))})},t.prototype.addAntiForgeryToken=function(t){return this.antiForgeryToken&&(t.__RequestVerificationToken=this.antiForgeryToken),t},t.prototype.init=function(t){(this.brokerOptions=t).serviceUrl&&(this.baseEndpoint=t.serviceUrl),t.endpoint&&(this.baseEndpoint=t.endpoint),this.initEndpointResolvers(),this.antiForgeryToken=t.antiForgeryToken,this.onRequest=t.onRequest},t.prototype.ajaxRequest=function(t){var e=u.equtils.assign({type:"GET",contentType:"application/json",dataType:"json"},t);return"string"!=typeof t.data&&(e.data=JSON.stringify(t.data)),Object(u.ajax)(e)},t.prototype.getModelPromise=function(){return this.modelPromise||this.context.loadDefaultModel(),this.modelPromise},t.prototype.doWhenModelLoaded=function(t){this.modelPromise?this.modelPromise.then(function(){t()}):t()},t.prototype.loadModel=function(r){var n=this,s=this.context,a=(r=r||{}).modelId||"",t=r.data||{},i=this.addAntiForgeryToken({modelId:a,data:t});this.modelPromise=new e(function(e,o){n.ajaxRequest({url:n.getLoadModelEndpoint(a),data:JSON.stringify(i),beforeSend:function(t,e){s.startProcess({action:d.a.LoadModel,text:"Loading model: "+a},u.WidgetGroup.Model),n.onRequest&&n.onRequest(t),r.beforeSend&&r.beforeSend(t,e)},success:function(t){s.endProcess({result:u.EqActionResult.Success,action:d.a.LoadModel,text:"Model loaded: "+a},u.WidgetGroup.Model),t.model||s.throwError({action:d.a.LoadModel,text:"Wrong response format"}),n.context.setModel(t.model),r.success&&r.success(t.model),n.context.refreshWidgets(u.WidgetGroup.Model|u.WidgetGroup.Query),n.context.fireEvent("loadModel",t.model),e(t.model)},error:function(t,e,n){if(s.endProcess({result:u.EqActionResult.Error,action:d.a.LoadModel,text:"Model loaded error: "+a},u.WidgetGroup.Model),r.error)r.error(t,t.status,"LoadModel");else{var i="Can't load model ["+a+"]";t.responseText&&(i+=t.responseText),s.throwError({action:d.a.LoadModel,text:i})}o(r.error)}})})},t.prototype.loadQuery=function(o){var n=this,r=this.context,i=r.getQuery();o||(o={});var s=o.silent||!1,a=i.getId();void 0===o.id?o.queryId&&(a=o.queryId):a=o.id,this.doWhenModelLoaded(function(){var t=o.modelId;t||(t=i.getModel().getId());var e=n.addAntiForgeryToken({id:a,modelId:o.modelId});o.data&&(e.data=o.data),n.ajaxRequest({url:n.getLoadQueryEndpoint(t,a),data:JSON.stringify(e),beforeSend:function(t,e){r.startProcess({action:d.a.LoadQuery,text:"Query loading: "+a},u.WidgetGroup.Query),n.onRequest&&n.onRequest(t),o.beforeSend&&o.beforeSend(t,e)},success:function(t){try{t.query?r.query.loadFromData(t.query,s):r.throwError({action:d.a.LoadQuery,text:"Wrong response format"})}finally{r.endProcess({result:u.EqActionResult.Success,action:d.a.LoadQuery,text:"Query loaded: "+a},u.WidgetGroup.Query)}o.success&&o.success(t.query),n.context.fireEvent("loadQuery",r.getQuery())},error:function(t,e,n){if(r.endProcess({result:u.EqActionResult.Error,action:d.a.LoadQuery,text:"Query load error: "+a},u.WidgetGroup.Query),o.error)o.error(t.status,t.responseText,"LoadQuery");else{var i="Can't load query ["+o.id+"]\n";t.responseText&&(i+=t.responseText),r.throwError({action:d.a.LoadQuery,text:i})}}})})},t.prototype.loadQueryList=function(o){var i=this,r=this.context;o=o||{},this.doWhenModelLoaded(function(){var t=r.getQuery(),e=o.modelId||t.getModel().getId(),n=i.addAntiForgeryToken({modelId:e});o.data&&(n.data=o.data),i.ajaxRequest({url:i.getLoadQueryListEndpoint(e),data:JSON.stringify(n),beforeSend:function(t,e){i.onRequest&&i.onRequest(t),o.beforeSend&&o.beforeSend(t,e)},success:function(t){t.queries||r.throwError({action:d.a.LoadQueryList,text:"Wrong response format"}),o.success&&o.success(t.queries)},error:function(t,e,n){if(o.error)o.error(t.status,t.responseText,"LoadQueryList");else{var i="Can't load list of queries";t.responseText&&(i+=t.responseText),r.throwError({action:d.a.LoadQueryList,text:i})}}})})},t.prototype.newQuery=function(o){var n=this,r=this.context,s=this.context.getQuery();o.queryName&&s.setName(o.queryName);var t=s.getModel(),e=o.modelId||(t?t.getId():""),i=this.addAntiForgeryToken({query:s.toJSONData()});o.data&&(i.data=o.data),this.doWhenModelLoaded(function(){n.ajaxRequest({type:"POST",url:n.getNewQueryEndpoint(e),data:JSON.stringify(i),beforeSend:function(t,e){r.startProcess({action:d.a.NewQuery,text:"Query creating"},u.WidgetGroup.Query),n.onRequest&&n.onRequest(t),o.beforeSend&&o.beforeSend(t,e)},success:function(t){r.endProcess({result:u.EqActionResult.Error,action:d.a.NewQuery,text:"Query creating"},u.WidgetGroup.Query),t.query||r.throwError({action:d.a.NewQuery,text:"Wrong response format"}),s.loadFromData(t.query),s.isNewbie=!0,o.success&&o.success(t.query),r.refreshWidgets(u.WidgetGroup.Model|u.WidgetGroup.Query)},error:function(t,e,n){if(r.endProcess({result:u.EqActionResult.Error,action:d.a.NewQuery,text:"Query creating error"},u.WidgetGroup.Query),o.error)o.error(t.status,t.responseText,"NewQuery");else{var i="Can't create a new query ["+s.getName()+"]";t.responseText&&(i+=t.responseText),r.throwError({action:d.a.NewQuery,text:i})}}})})},t.prototype.saveQuery=function(o){var n=this;o=o||{};var r=this.context.getQuery(),t="";if(r){var e=o.modelId||r.getModel().getId();t=o.queryName||r.getName(),o.queryId&&r.setId(o.queryId);var i=this.addAntiForgeryToken({query:r.toJSONData(),queryName:t});o.data&&(i.data=o.data);var s=this.context;this.ajaxRequest({type:"PUT",url:this.getSaveQueryEndpoint(e,r.getId()),data:JSON.stringify(i),beforeSend:function(t,e){s.startProcess({action:d.a.SaveQuery,text:"Query saving: "+r.getId()},u.WidgetGroup.Query),n.onRequest&&n.onRequest(t),o.beforeSend&&o.beforeSend(t,e)},success:function(t){s.endProcess({action:d.a.SaveQuery,result:u.EqActionResult.Success,text:"Query saved: "+r.getId()},u.WidgetGroup.Query),r.isModified=!1,r.isNewbie=!1,t.query&&s.query.loadFromData(t.query),o.success&&o.success(t),s.refreshWidgets(u.WidgetGroup.Query)},error:function(t,e,n){if(s.endProcess({action:d.a.SaveQuery,result:u.EqActionResult.Error,text:"Query saved error: "+r.getId()},u.WidgetGroup.Query),o.error)o.error(t.status,t.responseText,"SaveQuery");else{var i="Can't save query ["+r.getId()+"]\n";t.responseText&&(i+=t.responseText),s.throwError({action:d.a.SaveQuery,text:i})}}})}},t.prototype.removeQuery=function(o){var n=this,e=this.context.getQuery(),t=(o=o||{}).modelId||e.getModel().getId(),r=o.id||o.queryId||e.getId(),i=this.addAntiForgeryToken({modelId:t,id:r});o.data&&(i.data=o.data);var s=this.context;this.ajaxRequest({type:"DELETE",url:this.getRemoveQueryEndpoint(t,r),data:i,beforeSend:function(t,e){n.onRequest&&n.onRequest(t),o.beforeSend&&o.beforeSend(t,e)},success:function(t){e.setId(null),e.clear(!0),o.success&&o.success(t)},error:function(t,e,n){if(o.error)o.error(t.status,t.responseText,"RemoveQuery");else{var i="Can't remove query ["+r+"]\n";t.responseText&&(i+=t.responseText),s.throwError({action:d.a.RemoveQuery,text:i})}}})},t.prototype.syncQuery=function(o){var r=this,s=(o=o||{}).query||this.context.getQuery();if(s){var t=this.brokerOptions.syncQueryOptions||null,e=o.options||t||{},n=this.addAntiForgeryToken({query:s.toJSONData(),options:e});e.data&&(n.data=e.data);var a=this.context;this.ajaxRequest({type:"POST",url:this.getSyncQueryEndpoint(s.getModel().getId(),s.getId()),data:JSON.stringify(n),beforeSend:function(t,e){r.onRequest&&r.onRequest(t),r.context.startProcess({action:d.a.SyncQuery,text:"Query syncing: "+s.getId()},u.WidgetGroup.Query),o.beforeSend&&o.beforeSend(t,e)},success:function(t){r.context.endProcess({result:u.EqActionResult.Success,action:d.a.SyncQuery,text:"Query synced: "+s.getId()},u.WidgetGroup.Query),t.statement&&(a.resultStatement=t.statement),o.success&&o.success(t),a.refreshWidgets(u.WidgetGroup.Query)},error:function(t,e,n){if(r.context.endProcess({result:u.EqActionResult.Error,action:d.a.SyncQuery,text:"Query synced error: "+s.getId()},u.WidgetGroup.Query),o.error)o.error(t.status,t.responseText,"SyncQuery");else{var i="Can't sync query ["+s.getId()+"]\n";t.responseText&&(i+=t.responseText),a.throwError({action:d.a.SyncQuery,text:i})}}})}},t.prototype.executeQuery=function(o){var r=this;o=o||{};var s,t=this.brokerOptions.syncQueryOptions||{},e=o.options||{},n=u.equtils.assign(t,e),i={};if(o.fromStorage)i={query:{modelId:o.modelId,id:o.queryId},options:n},s=o.queryId,o.modelId;else{var a=this.context.getQuery();s=a.getId(),a.getModel().getId();var l=a.toJSONData();i=this.addAntiForgeryToken({query:l,options:n})}o.data&&(i.data=o.data),i=this.addAntiForgeryToken(i),this.brokerOptions.onExecuteQuery&&this.brokerOptions.onExecuteQuery(i),this.ajaxRequest({type:"POST",url:this.getExecuteQueryEndpoint(i.query.modelId,s),data:JSON.stringify(i),beforeSend:function(t,e){r.context.startProcess({action:d.a.ExecuteQuery,text:"Query executing: "+s},u.WidgetGroup.Result),r.onRequest&&r.onRequest(t),o.beforeSend&&o.beforeSend(t,e)},success:function(t){r.context.endProcess({result:u.EqActionResult.Success,action:d.a.ExecuteQuery,text:"Query executed: "+s},u.WidgetGroup.Result),t.statement&&(r.context.resultStatement=t.statement),t.resultSet?r.context.resultSet=new u.EqDataTable(t.resultSet):r.context.resultContent=t,o.success&&o.success(t),r.context.refreshWidgets(u.WidgetGroup.Result)},error:function(t,e,n){if(r.context.endProcess({result:u.EqActionResult.Error,action:d.a.ExecuteQuery,text:"Query execution error: "+s},u.WidgetGroup.Result),o.error)o.error(t.status,t.responseText,'"ExecuteQuery');else{var i="Can't execute query ["+s+"]";t.responseText&&(i+=t.responseText),r.context.throwError({action:d.a.ExecuteQuery,text:i})}}})},t.prototype.loadValueList=function(o){var r=this,t=this.context.getQuery(),e=o.modelId||t.getModel().getId(),s=u.equtils.assign({modelId:e},o.params),n=this.addAntiForgeryToken(s),i=this.context;this.ajaxRequest({url:this.getValueListRequestEndpoint(e,s.editorId),data:JSON.stringify(n),beforeSend:function(t,e){r.onRequest&&r.onRequest(t),o.beforeSend&&o.beforeSend()},success:function(t){var e=u.EqActionResult.Success;t.values||(i.throwError({action:d.a.GetValueList,text:"Wrong response format"}),e=u.EqActionResult.Error),r.context.endProcess({result:e,action:d.a.GetValueList,text:"Values loaded"},u.WidgetGroup.Result),o.success&&o.success(t.values)},error:function(t,e,n){o.success&&o.success(null);var i="Can't load request list ["+s.editorId+"]\n";t.responseText&&(i+=t.responseText),r.context.throwError({action:d.a.GetValueList,text:i})}})},t.prototype.exportResult=function(o){var r=this,t=o.format||"csv",e=this.context.getQuery(),s=e.getId(),n=e.getModel().getId(),i=e.toJSONData(),a=this.addAntiForgeryToken({query:i});this.getExportResultEndpoint(n,s,t);this.ajaxRequest({type:"POST",url:this.getExportResultEndpoint(n,s,t),data:JSON.stringify(a),contentType:"blob",beforeSend:function(t,e){r.context.startProcess({action:d.a.ExportResult,text:"Exporting result for query: "+s},u.WidgetGroup.Result),r.onRequest&&r.onRequest(t),o.beforeSend&&o.beforeSend(t,e)},success:function(t,e){r.context.endProcess({result:u.EqActionResult.Success,action:d.a.ExportResult,text:"The result set for query ["+s+"] has been successfully exported"},u.WidgetGroup.Result);var n=new Blob([t]),i=e.getResponseHeader("Content-Disposition").match(/filename="(.*)"/)[1];if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(n,i);else{var o=document.createElement("a");document.body.appendChild(o),o.style.display="none",o.href=window.URL.createObjectURL(n),o.download=i,o.click(),window.URL.revokeObjectURL(o.href),document.body.removeChild(o)}},error:function(t,e,n){if(r.context.endProcess({action:d.a.ExportResult,text:"Error during exporting data for query: "+s},u.WidgetGroup.Result),o.error)o.error(t.status,t.responseText,'"ExecuteQuery');else{var i="Can't export result query ["+s+"]";t.responseText&&(i+=t.responseText),r.context.throwError({action:d.a.ExportResult,text:i})}}})},t.prototype.ensureUrl=function(t){return t||"__default"},t}()}).call(this,i(14))},function(t,e){var n,i,o=t.exports={};function r(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===r||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:r}catch(t){n=r}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(t){i=s}}();var l,u=[],d=!1,c=-1;function h(){d&&l&&(d=!1,l.length?u=l.concat(u):c=-1,u.length&&p())}function p(){if(!d){var t=a(h);d=!0;for(var e=u.length;e;){for(l=u,u=[];++c<e;)l&&l[c].run();c=-1,e=u.length}l=null,d=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(t)}}function m(t,e){this.fun=t,this.array=e}function f(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new m(t,e)),1!==u.length||d||a(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=f,o.addListener=f,o.once=f,o.off=f,o.removeListener=f,o.removeAllListeners=f,o.emit=f,o.prependListener=f,o.prependOnceListener=f,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(module,__webpack_exports__,__webpack_require__){"use strict";function registerEqJquiTimePicker($){if($.ui.timepicker=$.ui.timepicker||{},!$.ui.timepicker.version){$.extend($.ui,{timepicker:{version:"1.5.5"}});var Timepicker=function(){this.regional=[],this.regional[""]={currentText:"Now",closeText:"Done",amNames:["AM","A"],pmNames:["PM","P"],timeFormat:"HH:mm",timeSuffix:"",timeOnlyTitle:"Choose Time",timeText:"Time",hourText:"Hour",minuteText:"Minute",secondText:"Second",millisecText:"Millisecond",microsecText:"Microsecond",timezoneText:"Time Zone",isRTL:!1},this._defaults={showButtonPanel:!0,timeOnly:!1,timeOnlyShowDate:!1,showHour:null,showMinute:null,showSecond:null,showMillisec:null,showMicrosec:null,showTimezone:null,showTime:!0,stepHour:1,stepMinute:1,stepSecond:1,stepMillisec:1,stepMicrosec:1,hour:0,minute:0,second:0,millisec:0,microsec:0,timezone:null,hourMin:0,minuteMin:0,secondMin:0,millisecMin:0,microsecMin:0,hourMax:23,minuteMax:59,secondMax:59,millisecMax:999,microsecMax:999,minDateTime:null,maxDateTime:null,maxTime:null,minTime:null,onSelect:null,hourGrid:0,minuteGrid:0,secondGrid:0,millisecGrid:0,microsecGrid:0,alwaysSetTime:!0,separator:" ",altFieldTimeOnly:!0,altTimeFormat:null,altSeparator:null,altTimeSuffix:null,altRedirectFocus:!0,pickerTimeFormat:null,pickerTimeSuffix:null,showTimepicker:!0,timezoneList:null,addSliderAccess:!1,sliderAccessArgs:null,controlType:"slider",oneLine:!1,defaultValue:null,parse:"strict",afterInject:null},$.extend(this._defaults,this.regional[""])};$.extend(Timepicker.prototype,{$input:null,$altInput:null,$timeObj:null,inst:null,hour_slider:null,minute_slider:null,second_slider:null,millisec_slider:null,microsec_slider:null,timezone_select:null,maxTime:null,minTime:null,hour:0,minute:0,second:0,millisec:0,microsec:0,timezone:null,hourMinOriginal:null,minuteMinOriginal:null,secondMinOriginal:null,millisecMinOriginal:null,microsecMinOriginal:null,hourMaxOriginal:null,minuteMaxOriginal:null,secondMaxOriginal:null,millisecMaxOriginal:null,microsecMaxOriginal:null,ampm:"",formattedDate:"",formattedTime:"",formattedDateTime:"",timezoneList:null,units:["hour","minute","second","millisec","microsec"],support:{},control:null,setDefaults:function(t){return extendRemove(this._defaults,t||{}),this},_newInst:function($input,opts){var tp_inst=new Timepicker,inlineSettings={},fns={},overrides,i;for(var attrName in this._defaults)if(this._defaults.hasOwnProperty(attrName)){var attrValue=$input.attr("time:"+attrName);if(attrValue)try{inlineSettings[attrName]=eval(attrValue)}catch(t){inlineSettings[attrName]=attrValue}}for(i in overrides={beforeShow:function(t,e){if($.isFunction(tp_inst._defaults.evnts.beforeShow))return tp_inst._defaults.evnts.beforeShow.call($input[0],t,e,tp_inst)},onChangeMonthYear:function(t,e,n){$.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)&&tp_inst._defaults.evnts.onChangeMonthYear.call($input[0],t,e,n,tp_inst)},onClose:function(t,e){!0===tp_inst.timeDefined&&""!==$input.val()&&tp_inst._updateDateTime(e),$.isFunction(tp_inst._defaults.evnts.onClose)&&tp_inst._defaults.evnts.onClose.call($input[0],t,e,tp_inst)}},overrides)overrides.hasOwnProperty(i)&&(fns[i]=opts[i]||this._defaults[i]||null);tp_inst._defaults=$.extend({},this._defaults,inlineSettings,opts,overrides,{evnts:fns,timepicker:tp_inst}),tp_inst.amNames=$.map(tp_inst._defaults.amNames,function(t){return t.toUpperCase()}),tp_inst.pmNames=$.map(tp_inst._defaults.pmNames,function(t){return t.toUpperCase()}),tp_inst.support=detectSupport(tp_inst._defaults.timeFormat+(tp_inst._defaults.pickerTimeFormat?tp_inst._defaults.pickerTimeFormat:"")+(tp_inst._defaults.altTimeFormat?tp_inst._defaults.altTimeFormat:"")),"string"==typeof tp_inst._defaults.controlType?("slider"===tp_inst._defaults.controlType&&void 0===$.ui.slider&&(tp_inst._defaults.controlType="select"),tp_inst.control=tp_inst._controls[tp_inst._defaults.controlType]):tp_inst.control=tp_inst._defaults.controlType;var timezoneList=[-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];null!==tp_inst._defaults.timezoneList&&(timezoneList=tp_inst._defaults.timezoneList);var tzl=timezoneList.length,tzi=0,tzv=null;if(0<tzl&&"object"!=typeof timezoneList[0])for(;tzi<tzl;tzi++)tzv=timezoneList[tzi],timezoneList[tzi]={value:tzv,label:$.timepicker.timezoneOffsetString(tzv,tp_inst.support.iso8601)};return tp_inst._defaults.timezoneList=timezoneList,tp_inst.timezone=null!==tp_inst._defaults.timezone?$.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone):-1*(new Date).getTimezoneOffset(),tp_inst.hour=tp_inst._defaults.hour<tp_inst._defaults.hourMin?tp_inst._defaults.hourMin:tp_inst._defaults.hour>tp_inst._defaults.hourMax?tp_inst._defaults.hourMax:tp_inst._defaults.hour,tp_inst.minute=tp_inst._defaults.minute<tp_inst._defaults.minuteMin?tp_inst._defaults.minuteMin:tp_inst._defaults.minute>tp_inst._defaults.minuteMax?tp_inst._defaults.minuteMax:tp_inst._defaults.minute,tp_inst.second=tp_inst._defaults.second<tp_inst._defaults.secondMin?tp_inst._defaults.secondMin:tp_inst._defaults.second>tp_inst._defaults.secondMax?tp_inst._defaults.secondMax:tp_inst._defaults.second,tp_inst.millisec=tp_inst._defaults.millisec<tp_inst._defaults.millisecMin?tp_inst._defaults.millisecMin:tp_inst._defaults.millisec>tp_inst._defaults.millisecMax?tp_inst._defaults.millisecMax:tp_inst._defaults.millisec,tp_inst.microsec=tp_inst._defaults.microsec<tp_inst._defaults.microsecMin?tp_inst._defaults.microsecMin:tp_inst._defaults.microsec>tp_inst._defaults.microsecMax?tp_inst._defaults.microsecMax:tp_inst._defaults.microsec,tp_inst.ampm="",tp_inst.$input=$input,tp_inst._defaults.altField&&(tp_inst.$altInput=$(tp_inst._defaults.altField),!0===tp_inst._defaults.altRedirectFocus&&tp_inst.$altInput.css({cursor:"pointer"}).focus(function(){$input.trigger("focus")})),0!==tp_inst._defaults.minDate&&0!==tp_inst._defaults.minDateTime||(tp_inst._defaults.minDate=new Date),0!==tp_inst._defaults.maxDate&&0!==tp_inst._defaults.maxDateTime||(tp_inst._defaults.maxDate=new Date),void 0!==tp_inst._defaults.minDate&&tp_inst._defaults.minDate instanceof Date&&(tp_inst._defaults.minDateTime=new Date(tp_inst._defaults.minDate.getTime())),void 0!==tp_inst._defaults.minDateTime&&tp_inst._defaults.minDateTime instanceof Date&&(tp_inst._defaults.minDate=new Date(tp_inst._defaults.minDateTime.getTime())),void 0!==tp_inst._defaults.maxDate&&tp_inst._defaults.maxDate instanceof Date&&(tp_inst._defaults.maxDateTime=new Date(tp_inst._defaults.maxDate.getTime())),void 0!==tp_inst._defaults.maxDateTime&&tp_inst._defaults.maxDateTime instanceof Date&&(tp_inst._defaults.maxDate=new Date(tp_inst._defaults.maxDateTime.getTime())),tp_inst.$input.bind("focus",function(){tp_inst._onFocus()}),tp_inst},_addTimePicker:function(t){var e=$.trim(this.$altInput&&this._defaults.altFieldTimeOnly?this.$input.val()+" "+this.$altInput.val():this.$input.val());this.timeDefined=this._parseTime(e),this._limitMinMaxDateTime(t,!1),this._injectTimePicker(),this._afterInject()},_parseTime:function(e,t){if(this.inst||(this.inst=$.datepicker._getInst(this.$input[0])),t||!this._defaults.timeOnly){var n=$.datepicker._get(this.inst,"dateFormat");try{var i=parseDateTimeInternal(n,this._defaults.timeFormat,e,$.datepicker._getFormatConfig(this.inst),this._defaults);if(!i.timeObj)return!1;$.extend(this,i.timeObj)}catch(t){return $.timepicker.log("Error parsing the date/time string: "+t+"\ndate/time string = "+e+"\ntimeFormat = "+this._defaults.timeFormat+"\ndateFormat = "+n),!1}return!0}var o=$.datepicker.parseTime(this._defaults.timeFormat,e,this._defaults);return!!o&&($.extend(this,o),!0)},_afterInject:function(){var t=this.inst.settings;$.isFunction(t.afterInject)&&t.afterInject.call(this)},_injectTimePicker:function(){var t=this.inst.dpDiv,e=this.inst.settings,s=this,a="",n="",i=null,o={},r={},l=null,u=0,d=0;if(0===t.find("div.ui-timepicker-div").length&&e.showTimepicker){var c=" ui_tpicker_unit_hide",h='<div class="ui-timepicker-div'+(e.isRTL?" ui-timepicker-rtl":"")+(e.oneLine&&"select"===e.controlType?" ui-timepicker-oneLine":"")+'"><dl><dt class="ui_tpicker_time_label'+(e.showTime?"":c)+'">'+e.timeText+'</dt><dd class="ui_tpicker_time '+(e.showTime?"":c)+'"></dd>';for(u=0,d=this.units.length;u<d;u++){if(i=null!==e["show"+(n=(a=this.units[u]).substr(0,1).toUpperCase()+a.substr(1))]?e["show"+n]:this.support[a],o[a]=parseInt(e[a+"Max"]-(e[a+"Max"]-e[a+"Min"])%e["step"+n],10),r[a]=0,h+='<dt class="ui_tpicker_'+a+"_label"+(i?"":c)+'">'+e[a+"Text"]+'</dt><dd class="ui_tpicker_'+a+(i?"":c)+'"><div class="ui_tpicker_'+a+"_slider"+(i?"":c)+'"></div>',i&&0<e[a+"Grid"]){if(h+='<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>',"hour"===a)for(var p=e[a+"Min"];p<=o[a];p+=parseInt(e[a+"Grid"],10)){r[a]++;var m=$.datepicker.formatTime(this.support.ampm?"hht":"HH",{hour:p},e);h+='<td data-for="'+a+'">'+m+"</td>"}else for(var f=e[a+"Min"];f<=o[a];f+=parseInt(e[a+"Grid"],10))r[a]++,h+='<td data-for="'+a+'">'+(f<10?"0":"")+f+"</td>";h+="</tr></table></div>"}h+="</dd>"}var g=null!==e.showTimezone?e.showTimezone:this.support.timezone;h+='<dt class="ui_tpicker_timezone_label'+(g?"":c)+'">'+e.timezoneText+"</dt>",h+='<dd class="ui_tpicker_timezone'+(g?"":c)+'"></dd>';var y=$(h+="</dl></div>");for(!0===e.timeOnly&&(y.prepend('<div class="ui-widget-header ui-helper-clearfix ui-corner-all"><div class="ui-datepicker-title">'+e.timeOnlyTitle+"</div></div>"),t.find(".ui-datepicker-header, .ui-datepicker-calendar").hide()),u=0,d=s.units.length;u<d;u++)i=null!==e["show"+(n=(a=s.units[u]).substr(0,1).toUpperCase()+a.substr(1))]?e["show"+n]:this.support[a],s[a+"_slider"]=s.control.create(s,y.find(".ui_tpicker_"+a+"_slider"),a,s[a],e[a+"Min"],o[a],e["step"+n]),i&&0<e[a+"Grid"]&&(l=100*r[a]*e[a+"Grid"]/(o[a]-e[a+"Min"]),y.find(".ui_tpicker_"+a+" table").css({width:l+"%",marginLeft:e.isRTL?"0":l/(-2*r[a])+"%",marginRight:e.isRTL?l/(-2*r[a])+"%":"0",borderCollapse:"collapse"}).find("td").click(function(t){var e=$(this),n=e.html(),i=parseInt(n.replace(/[^0-9]/g),10),o=n.replace(/[^apm]/gi),r=e.data("for");"hour"===r&&(-1!==o.indexOf("p")&&i<12?i+=12:-1!==o.indexOf("a")&&12===i&&(i=0)),s.control.value(s,s[r+"_slider"],a,i),s._onTimeChange(),s._onSelectHandler()}).css({cursor:"pointer",width:100/r[a]+"%",textAlign:"center",overflow:"hidden"}));if(this.timezone_select=y.find(".ui_tpicker_timezone").append("<select></select>").find("select"),$.fn.append.apply(this.timezone_select,$.map(e.timezoneList,function(t,e){return $("<option />").val("object"==typeof t?t.value:t).text("object"==typeof t?t.label:t)})),void 0!==this.timezone&&null!==this.timezone&&""!==this.timezone)-1*new Date(this.inst.selectedYear,this.inst.selectedMonth,this.inst.selectedDay,12).getTimezoneOffset()===this.timezone?selectLocalTimezone(s):this.timezone_select.val(this.timezone);else void 0!==this.hour&&null!==this.hour&&""!==this.hour?this.timezone_select.val(e.timezone):selectLocalTimezone(s);this.timezone_select.change(function(){s._onTimeChange(),s._onSelectHandler(),s._afterInject()});var v=t.find(".ui-datepicker-buttonpane");if(v.length?v.before(y):t.append(y),this.$timeObj=y.find(".ui_tpicker_time"),null!==this.inst){var _=this.timeDefined;this._onTimeChange(),this.timeDefined=_}if(this._defaults.addSliderAccess){var C=this._defaults.sliderAccessArgs,x=this._defaults.isRTL;C.isRTL=x,setTimeout(function(){if(0===y.find(".ui-slider-access").length){y.find(".ui-slider:visible").sliderAccess(C);var s=y.find(".ui-slider-access:eq(0)").outerWidth(!0);s&&y.find("table:visible").each(function(){var t=$(this),e=t.outerWidth(),n=t.css(x?"marginRight":"marginLeft").toString().replace("%",""),i=e-s,o=n*i/e+"%",r={width:i,marginRight:0,marginLeft:0};r[x?"marginRight":"marginLeft"]=o,t.css(r)})}},10)}s._limitMinMaxDateTime(this.inst,!0)}},_limitMinMaxDateTime:function(t,e){var n=this._defaults,i=new Date(t.selectedYear,t.selectedMonth,t.selectedDay);if(this._defaults.showTimepicker){if(null!==$.datepicker._get(t,"minDateTime")&&void 0!==$.datepicker._get(t,"minDateTime")&&i){var o=$.datepicker._get(t,"minDateTime"),r=new Date(o.getFullYear(),o.getMonth(),o.getDate(),0,0,0,0);null!==this.hourMinOriginal&&null!==this.minuteMinOriginal&&null!==this.secondMinOriginal&&null!==this.millisecMinOriginal&&null!==this.microsecMinOriginal||(this.hourMinOriginal=n.hourMin,this.minuteMinOriginal=n.minuteMin,this.secondMinOriginal=n.secondMin,this.millisecMinOriginal=n.millisecMin,this.microsecMinOriginal=n.microsecMin),t.settings.timeOnly||r.getTime()===i.getTime()?(this._defaults.hourMin=o.getHours(),this.hour<=this._defaults.hourMin?(this.hour=this._defaults.hourMin,this._defaults.minuteMin=o.getMinutes(),this.minute<=this._defaults.minuteMin?(this.minute=this._defaults.minuteMin,this._defaults.secondMin=o.getSeconds(),this.second<=this._defaults.secondMin?(this.second=this._defaults.secondMin,this._defaults.millisecMin=o.getMilliseconds(),this.millisec<=this._defaults.millisecMin?(this.millisec=this._defaults.millisecMin,this._defaults.microsecMin=o.getMicroseconds()):(this.microsec<this._defaults.microsecMin&&(this.microsec=this._defaults.microsecMin),this._defaults.microsecMin=this.microsecMinOriginal)):(this._defaults.millisecMin=this.millisecMinOriginal,this._defaults.microsecMin=this.microsecMinOriginal)):(this._defaults.secondMin=this.secondMinOriginal,this._defaults.millisecMin=this.millisecMinOriginal,this._defaults.microsecMin=this.microsecMinOriginal)):(this._defaults.minuteMin=this.minuteMinOriginal,this._defaults.secondMin=this.secondMinOriginal,this._defaults.millisecMin=this.millisecMinOriginal,this._defaults.microsecMin=this.microsecMinOriginal)):(this._defaults.hourMin=this.hourMinOriginal,this._defaults.minuteMin=this.minuteMinOriginal,this._defaults.secondMin=this.secondMinOriginal,this._defaults.millisecMin=this.millisecMinOriginal,this._defaults.microsecMin=this.microsecMinOriginal)}if(null!==$.datepicker._get(t,"maxDateTime")&&void 0!==$.datepicker._get(t,"maxDateTime")&&i){var s=$.datepicker._get(t,"maxDateTime"),a=new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0,0);null!==this.hourMaxOriginal&&null!==this.minuteMaxOriginal&&null!==this.secondMaxOriginal&&null!==this.millisecMaxOriginal||(this.hourMaxOriginal=n.hourMax,this.minuteMaxOriginal=n.minuteMax,this.secondMaxOriginal=n.secondMax,this.millisecMaxOriginal=n.millisecMax,this.microsecMaxOriginal=n.microsecMax),t.settings.timeOnly||a.getTime()===i.getTime()?(this._defaults.hourMax=s.getHours(),this.hour>=this._defaults.hourMax?(this.hour=this._defaults.hourMax,this._defaults.minuteMax=s.getMinutes(),this.minute>=this._defaults.minuteMax?(this.minute=this._defaults.minuteMax,this._defaults.secondMax=s.getSeconds(),this.second>=this._defaults.secondMax?(this.second=this._defaults.secondMax,this._defaults.millisecMax=s.getMilliseconds(),this.millisec>=this._defaults.millisecMax?(this.millisec=this._defaults.millisecMax,this._defaults.microsecMax=s.getMicroseconds()):(this.microsec>this._defaults.microsecMax&&(this.microsec=this._defaults.microsecMax),this._defaults.microsecMax=this.microsecMaxOriginal)):(this._defaults.millisecMax=this.millisecMaxOriginal,this._defaults.microsecMax=this.microsecMaxOriginal)):(this._defaults.secondMax=this.secondMaxOriginal,this._defaults.millisecMax=this.millisecMaxOriginal,this._defaults.microsecMax=this.microsecMaxOriginal)):(this._defaults.minuteMax=this.minuteMaxOriginal,this._defaults.secondMax=this.secondMaxOriginal,this._defaults.millisecMax=this.millisecMaxOriginal,this._defaults.microsecMax=this.microsecMaxOriginal)):(this._defaults.hourMax=this.hourMaxOriginal,this._defaults.minuteMax=this.minuteMaxOriginal,this._defaults.secondMax=this.secondMaxOriginal,this._defaults.millisecMax=this.millisecMaxOriginal,this._defaults.microsecMax=this.microsecMaxOriginal)}if(null!==t.settings.minTime){var l=new Date("01/01/1970 "+t.settings.minTime);this.hour<l.getHours()?(this.hour=this._defaults.hourMin=l.getHours(),this.minute=this._defaults.minuteMin=l.getMinutes()):this.hour===l.getHours()&&this.minute<l.getMinutes()?this.minute=this._defaults.minuteMin=l.getMinutes():this._defaults.hourMin<l.getHours()?(this._defaults.hourMin=l.getHours(),this._defaults.minuteMin=l.getMinutes()):this._defaults.hourMin===l.getHours()===this.hour&&this._defaults.minuteMin<l.getMinutes()?this._defaults.minuteMin=l.getMinutes():this._defaults.minuteMin=0}if(null!==t.settings.maxTime){var u=new Date("01/01/1970 "+t.settings.maxTime);this.hour>u.getHours()?(this.hour=this._defaults.hourMax=u.getHours(),this.minute=this._defaults.minuteMax=u.getMinutes()):this.hour===u.getHours()&&this.minute>u.getMinutes()?this.minute=this._defaults.minuteMax=u.getMinutes():this._defaults.hourMax>u.getHours()?(this._defaults.hourMax=u.getHours(),this._defaults.minuteMax=u.getMinutes()):this._defaults.hourMax===u.getHours()===this.hour&&this._defaults.minuteMax>u.getMinutes()?this._defaults.minuteMax=u.getMinutes():this._defaults.minuteMax=59}if(void 0!==e&&!0===e){var d=parseInt(this._defaults.hourMax-(this._defaults.hourMax-this._defaults.hourMin)%this._defaults.stepHour,10),c=parseInt(this._defaults.minuteMax-(this._defaults.minuteMax-this._defaults.minuteMin)%this._defaults.stepMinute,10),h=parseInt(this._defaults.secondMax-(this._defaults.secondMax-this._defaults.secondMin)%this._defaults.stepSecond,10),p=parseInt(this._defaults.millisecMax-(this._defaults.millisecMax-this._defaults.millisecMin)%this._defaults.stepMillisec,10),m=parseInt(this._defaults.microsecMax-(this._defaults.microsecMax-this._defaults.microsecMin)%this._defaults.stepMicrosec,10);this.hour_slider&&(this.control.options(this,this.hour_slider,"hour",{min:this._defaults.hourMin,max:d,step:this._defaults.stepHour}),this.control.value(this,this.hour_slider,"hour",this.hour-this.hour%this._defaults.stepHour)),this.minute_slider&&(this.control.options(this,this.minute_slider,"minute",{min:this._defaults.minuteMin,max:c,step:this._defaults.stepMinute}),this.control.value(this,this.minute_slider,"minute",this.minute-this.minute%this._defaults.stepMinute)),this.second_slider&&(this.control.options(this,this.second_slider,"second",{min:this._defaults.secondMin,max:h,step:this._defaults.stepSecond}),this.control.value(this,this.second_slider,"second",this.second-this.second%this._defaults.stepSecond)),this.millisec_slider&&(this.control.options(this,this.millisec_slider,"millisec",{min:this._defaults.millisecMin,max:p,step:this._defaults.stepMillisec}),this.control.value(this,this.millisec_slider,"millisec",this.millisec-this.millisec%this._defaults.stepMillisec)),this.microsec_slider&&(this.control.options(this,this.microsec_slider,"microsec",{min:this._defaults.microsecMin,max:m,step:this._defaults.stepMicrosec}),this.control.value(this,this.microsec_slider,"microsec",this.microsec-this.microsec%this._defaults.stepMicrosec))}}},_onTimeChange:function(){if(this._defaults.showTimepicker){var t=!!this.hour_slider&&this.control.value(this,this.hour_slider,"hour"),e=!!this.minute_slider&&this.control.value(this,this.minute_slider,"minute"),n=!!this.second_slider&&this.control.value(this,this.second_slider,"second"),i=!!this.millisec_slider&&this.control.value(this,this.millisec_slider,"millisec"),o=!!this.microsec_slider&&this.control.value(this,this.microsec_slider,"microsec"),r=!!this.timezone_select&&this.timezone_select.val(),s=this._defaults,a=s.pickerTimeFormat||s.timeFormat,l=s.pickerTimeSuffix||s.timeSuffix;"object"==typeof t&&(t=!1),"object"==typeof e&&(e=!1),"object"==typeof n&&(n=!1),"object"==typeof i&&(i=!1),"object"==typeof o&&(o=!1),"object"==typeof r&&(r=!1),!1!==t&&(t=parseInt(t,10)),!1!==e&&(e=parseInt(e,10)),!1!==n&&(n=parseInt(n,10)),!1!==i&&(i=parseInt(i,10)),!1!==o&&(o=parseInt(o,10)),!1!==r&&(r=r.toString());var u=s[t<12?"amNames":"pmNames"][0],d=t!==parseInt(this.hour,10)||e!==parseInt(this.minute,10)||n!==parseInt(this.second,10)||i!==parseInt(this.millisec,10)||o!==parseInt(this.microsec,10)||0<this.ampm.length&&t<12!=(-1!==$.inArray(this.ampm.toUpperCase(),this.amNames))||null!==this.timezone&&r!==this.timezone.toString();d&&(!1!==t&&(this.hour=t),!1!==e&&(this.minute=e),!1!==n&&(this.second=n),!1!==i&&(this.millisec=i),!1!==o&&(this.microsec=o),!1!==r&&(this.timezone=r),this.inst||(this.inst=$.datepicker._getInst(this.$input[0])),this._limitMinMaxDateTime(this.inst,!0)),this.support.ampm&&(this.ampm=u),this.formattedTime=$.datepicker.formatTime(s.timeFormat,this,s),this.$timeObj&&(a===s.timeFormat?this.$timeObj.text(this.formattedTime+l):this.$timeObj.text($.datepicker.formatTime(a,this,s)+l)),this.timeDefined=!0,d&&this._updateDateTime()}},_onSelectHandler:function(){var t=this._defaults.onSelect||this.inst.settings.onSelect,e=this.$input?this.$input[0]:null;t&&e&&t.apply(e,[this.formattedDateTime,this])},_updateDateTime:function(t){var e=0<(t=this.inst||t).currentYear?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(t.selectedYear,t.selectedMonth,t.selectedDay),n=$.datepicker._daylightSavingAdjust(e),i=$.datepicker._get(t,"dateFormat"),o=$.datepicker._getFormatConfig(t),r=null!==n&&this.timeDefined;this.formattedDate=$.datepicker.formatDate(i,null===n?new Date:n,o);var s=this.formattedDate;if(""===t.lastVal&&(t.currentYear=t.selectedYear,t.currentMonth=t.selectedMonth,t.currentDay=t.selectedDay),!0===this._defaults.timeOnly&&!1===this._defaults.timeOnlyShowDate?s=this.formattedTime:(!0!==this._defaults.timeOnly&&(this._defaults.alwaysSetTime||r)||!0===this._defaults.timeOnly&&!0===this._defaults.timeOnlyShowDate)&&(s+=this._defaults.separator+this.formattedTime+this._defaults.timeSuffix),this.formattedDateTime=s,this._defaults.showTimepicker)if(this.$altInput&&!1===this._defaults.timeOnly&&!0===this._defaults.altFieldTimeOnly)this.$altInput.val(this.formattedTime),this.$input.val(this.formattedDate);else if(this.$altInput){this.$input.val(s);var a="",l=null!==this._defaults.altSeparator?this._defaults.altSeparator:this._defaults.separator,u=null!==this._defaults.altTimeSuffix?this._defaults.altTimeSuffix:this._defaults.timeSuffix;this._defaults.timeOnly||(a=this._defaults.altFormat?$.datepicker.formatDate(this._defaults.altFormat,null===n?new Date:n,o):this.formattedDate)&&(a+=l),null!==this._defaults.altTimeFormat?a+=$.datepicker.formatTime(this._defaults.altTimeFormat,this,this._defaults)+u:a+=this.formattedTime+u,this.$altInput.val(a)}else this.$input.val(s);else this.$input.val(this.formattedDate);this.$input.trigger("change")},_onFocus:function(){if(!this.$input.val()&&this._defaults.defaultValue){this.$input.val(this._defaults.defaultValue);var t=$.datepicker._getInst(this.$input.get(0)),e=$.datepicker._get(t,"timepicker");if(e&&e._defaults.timeOnly&&t.input.val()!==t.lastVal)try{$.datepicker._updateDatepicker(t)}catch(t){$.timepicker.log(t)}}},_controls:{slider:{create:function(n,t,i,e,o,r,s){var a=n._defaults.isRTL;return t.prop("slide",null).slider({orientation:"horizontal",value:a?-1*e:e,min:a?-1*r:o,max:a?-1*o:r,step:s,slide:function(t,e){n.control.value(n,$(this),i,a?-1*e.value:e.value),n._onTimeChange()},stop:function(t,e){n._onSelectHandler()}})},options:function(t,e,n,i,o){if(t._defaults.isRTL){if("string"==typeof i)return"min"===i||"max"===i?void 0!==o?e.slider(i,-1*o):Math.abs(e.slider(i)):e.slider(i);var r=i.min,s=i.max;return i.min=i.max=null,void 0!==r&&(i.max=-1*r),void 0!==s&&(i.min=-1*s),e.slider(i)}return"string"==typeof i&&void 0!==o?e.slider(i,o):e.slider(i)},value:function(t,e,n,i){return t._defaults.isRTL?void 0!==i?e.slider("value",-1*i):Math.abs(e.slider("value")):void 0!==i?e.slider("value",i):e.slider("value")}},select:{create:function(e,t,n,i,o,r,s){for(var a='<select class="ui-timepicker-select ui-state-default ui-corner-all" data-unit="'+n+'" data-min="'+o+'" data-max="'+r+'" data-step="'+s+'">',l=e._defaults.pickerTimeFormat||e._defaults.timeFormat,u=o;u<=r;u+=s)a+='<option value="'+u+'"'+(u===i?" selected":"")+">",a+="hour"===n?$.datepicker.formatTime($.trim(l.replace(/[^ht ]/gi,"")),{hour:u},e._defaults):"millisec"===n||"microsec"===n||10<=u?u:"0"+u.toString(),a+="</option>";return a+="</select>",t.children("select").remove(),$(a).appendTo(t).change(function(t){e._onTimeChange(),e._onSelectHandler(),e._afterInject()}),t},options:function(t,e,n,i,o){var r={},s=e.children("select");if("string"==typeof i){if(void 0===o)return s.data(i);r[i]=o}else r=i;return t.control.create(t,e,s.data("unit"),s.val(),0<=r.min?r.min:s.data("min"),r.max||s.data("max"),r.step||s.data("step"))},value:function(t,e,n,i){var o=e.children("select");return void 0!==i?o.val(i):o.val()}}}}),$.fn.extend({timepicker:function(t){t=t||{};var e=Array.prototype.slice.call(arguments);return"object"==typeof t&&(e[0]=$.extend(t,{timeOnly:!0})),$(this).each(function(){$.fn.datetimepicker.apply($(this),e)})},datetimepicker:function(e){var n=arguments;return"string"==typeof(e=e||{})?"getDate"===e||"option"===e&&2===n.length&&"string"==typeof n[1]?$.fn.datepicker.apply($(this[0]),n):this.each(function(){var t=$(this);t.datepicker.apply(t,n)}):this.each(function(){var t=$(this);t.datepicker($.timepicker._newInst(t,e)._defaults)})}}),$.datepicker.parseDateTime=function(t,e,n,i,o){var r=parseDateTimeInternal(t,e,n,i,o);if(r.timeObj){var s=r.timeObj;r.date.setHours(s.hour,s.minute,s.second,s.millisec),r.date.setMicroseconds(s.microsec)}return r.date},$.datepicker.parseTime=function(t,e,n){var i=extendRemove(extendRemove({},$.timepicker._defaults),n||{}),o=(t.replace(/\'.*?\'/g,"").indexOf("Z"),function(t,e,r){var n,i="^"+t.toString().replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g,function(t){var e,n,i,o=t.length;switch(t.charAt(0).toLowerCase()){case"h":case"m":case"s":return 1===o?"(\\d?\\d)":"(\\d{"+o+"})";case"l":case"c":return"(\\d?\\d?\\d)";case"z":return"(z|[-+]\\d\\d:?\\d\\d|\\S+)?";case"t":return e=r.amNames,n=r.pmNames,i=[],e&&$.merge(i,e),n&&$.merge(i,n),"("+(i=$.map(i,function(t){return t.replace(/[.*+?|()\[\]{}\\]/g,"\\$&")})).join("|")+")?";default:return"("+t.replace(/\'/g,"").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g,function(t){return"\\"+t})+")?"}}).replace(/\s/g,"\\s?")+r.timeSuffix+"$",o=function(t){var e=t.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),n={h:-1,m:-1,s:-1,l:-1,c:-1,t:-1,z:-1};if(e)for(var i=0;i<e.length;i++)-1===n[e[i].toString().charAt(0)]&&(n[e[i].toString().charAt(0)]=i+1);return n}(t),s="",a={hour:0,minute:0,second:0,millisec:0,microsec:0};return!!(n=e.match(new RegExp(i,"i")))&&(-1!==o.t&&(void 0===n[o.t]||0===n[o.t].length?(s="",a.ampm=""):(s=-1!==$.inArray(n[o.t].toUpperCase(),$.map(r.amNames,function(t,e){return t.toUpperCase()}))?"AM":"PM",a.ampm=r["AM"===s?"amNames":"pmNames"][0])),-1!==o.h&&("AM"===s&&"12"===n[o.h]?a.hour=0:"PM"===s&&"12"!==n[o.h]?a.hour=parseInt(n[o.h],10)+12:a.hour=Number(n[o.h])),-1!==o.m&&(a.minute=Number(n[o.m])),-1!==o.s&&(a.second=Number(n[o.s])),-1!==o.l&&(a.millisec=Number(n[o.l])),-1!==o.c&&(a.microsec=Number(n[o.c])),-1!==o.z&&void 0!==n[o.z]&&(a.timezone=$.timepicker.timezoneOffsetNumber(n[o.z])),a)});return"function"==typeof i.parse?i.parse(t,e,i):"loose"===i.parse?function(e,n,i){try{var t=new Date("2012-01-01 "+n);if(isNaN(t.getTime())&&(t=new Date("2012-01-01T"+n),isNaN(t.getTime())&&(t=new Date("01/01/2012 "+n),isNaN(t.getTime()))))throw"Unable to parse time with native Date: "+n;return{hour:t.getHours(),minute:t.getMinutes(),second:t.getSeconds(),millisec:t.getMilliseconds(),microsec:t.getMicroseconds(),timezone:-1*t.getTimezoneOffset()}}catch(t){try{return o(e,n,i)}catch(t){$.timepicker.log("Unable to parse \ntimeString: "+n+"\ntimeFormat: "+e)}}return!1}(t,e,i):o(t,e,i)},$.datepicker.formatTime=function(t,e,n){n=n||{},n=$.extend({},$.timepicker._defaults,n),e=$.extend({hour:0,minute:0,second:0,millisec:0,microsec:0,timezone:null},e);var i=t,o=n.amNames[0],r=parseInt(e.hour,10);return 11<r&&(o=n.pmNames[0]),i=i.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g,function(t){switch(t){case"HH":return("0"+r).slice(-2);case"H":return r;case"hh":return("0"+convert24to12(r)).slice(-2);case"h":return convert24to12(r);case"mm":return("0"+e.minute).slice(-2);case"m":return e.minute;case"ss":return("0"+e.second).slice(-2);case"s":return e.second;case"l":return("00"+e.millisec).slice(-3);case"c":return("00"+e.microsec).slice(-3);case"z":return $.timepicker.timezoneOffsetString(null===e.timezone?n.timezone:e.timezone,!1);case"Z":return $.timepicker.timezoneOffsetString(null===e.timezone?n.timezone:e.timezone,!0);case"T":return o.charAt(0).toUpperCase();case"TT":return o.toUpperCase();case"t":return o.charAt(0).toLowerCase();case"tt":return o.toLowerCase();default:return t.replace(/'/g,"")}})},$.datepicker._base_selectDate=$.datepicker._selectDate,$.datepicker._selectDate=function(t,e){var n,i=this._getInst($(t)[0]),o=this._get(i,"timepicker");o&&i.settings.showTimepicker?(o._limitMinMaxDateTime(i,!0),n=i.inline,i.inline=i.stay_open=!0,this._base_selectDate(t,e),i.inline=n,i.stay_open=!1,this._notifyChange(i),this._updateDatepicker(i)):this._base_selectDate(t,e)},$.datepicker._base_updateDatepicker=$.datepicker._updateDatepicker,$.datepicker._updateDatepicker=function(t){var e=t.input[0];if(!($.datepicker._curInst&&$.datepicker._curInst!==t&&$.datepicker._datepickerShowing&&$.datepicker._lastInput!==e||"boolean"==typeof t.stay_open&&!1!==t.stay_open)){this._base_updateDatepicker(t);var n=this._get(t,"timepicker");n&&n._addTimePicker(t)}},$.datepicker._base_doKeyPress=$.datepicker._doKeyPress,$.datepicker._doKeyPress=function(t){var e=$.datepicker._getInst(t.target),n=$.datepicker._get(e,"timepicker");if(n&&$.datepicker._get(e,"constrainInput")){var i=n.support.ampm,o=null!==n._defaults.showTimezone?n._defaults.showTimezone:n.support.timezone,r=$.datepicker._possibleChars($.datepicker._get(e,"dateFormat")),s=n._defaults.timeFormat.toString().replace(/[hms]/g,"").replace(/TT/g,i?"APM":"").replace(/Tt/g,i?"AaPpMm":"").replace(/tT/g,i?"AaPpMm":"").replace(/T/g,i?"AP":"").replace(/tt/g,i?"apm":"").replace(/t/g,i?"ap":"")+" "+n._defaults.separator+n._defaults.timeSuffix+(o?n._defaults.timezoneList.join(""):"")+n._defaults.amNames.join("")+n._defaults.pmNames.join("")+r,a=String.fromCharCode(void 0===t.charCode?t.keyCode:t.charCode);return t.ctrlKey||a<" "||!r||-1<s.indexOf(a)}return $.datepicker._base_doKeyPress(t)},$.datepicker._base_updateAlternate=$.datepicker._updateAlternate,$.datepicker._updateAlternate=function(t){var e=this._get(t,"timepicker");if(e){var n=e._defaults.altField;if(n){e._defaults.altFormat||e._defaults.dateFormat;var i=this._getDate(t),o=$.datepicker._getFormatConfig(t),r="",s=e._defaults.altSeparator?e._defaults.altSeparator:e._defaults.separator,a=e._defaults.altTimeSuffix?e._defaults.altTimeSuffix:e._defaults.timeSuffix,l=null!==e._defaults.altTimeFormat?e._defaults.altTimeFormat:e._defaults.timeFormat;r+=$.datepicker.formatTime(l,e,e._defaults)+a,e._defaults.timeOnly||e._defaults.altFieldTimeOnly||null===i||(r=e._defaults.altFormat?$.datepicker.formatDate(e._defaults.altFormat,i,o)+s+r:e.formattedDate+s+r),$(n).val(t.input.val()?r:"")}}else $.datepicker._base_updateAlternate(t)},$.datepicker._base_doKeyUp=$.datepicker._doKeyUp,$.datepicker._doKeyUp=function(t){var e=$.datepicker._getInst(t.target),n=$.datepicker._get(e,"timepicker");if(n&&n._defaults.timeOnly&&e.input.val()!==e.lastVal)try{$.datepicker._updateDatepicker(e)}catch(t){$.timepicker.log(t)}return $.datepicker._base_doKeyUp(t)},$.datepicker._base_gotoToday=$.datepicker._gotoToday,$.datepicker._gotoToday=function(t){var e=this._getInst($(t)[0]),n=(e.dpDiv,this._get(e,"timepicker"));selectLocalTimezone(n);var i=new Date;this._setTime(e,i),this._setDate(e,i),this._base_gotoToday(t)},$.datepicker._disableTimepickerDatepicker=function(t){var e=this._getInst(t);if(e){var n=this._get(e,"timepicker");$(t).datepicker("getDate"),n&&(e.settings.showTimepicker=!1,n._defaults.showTimepicker=!1,n._updateDateTime(e))}},$.datepicker._enableTimepickerDatepicker=function(t){var e=this._getInst(t);if(e){var n=this._get(e,"timepicker");$(t).datepicker("getDate"),n&&(e.settings.showTimepicker=!0,n._defaults.showTimepicker=!0,n._addTimePicker(e),n._updateDateTime(e))}},$.datepicker._setTime=function(t,e){var n=this._get(t,"timepicker");if(n){var i=n._defaults;n.hour=e?e.getHours():i.hour,n.minute=e?e.getMinutes():i.minute,n.second=e?e.getSeconds():i.second,n.millisec=e?e.getMilliseconds():i.millisec,n.microsec=e?e.getMicroseconds():i.microsec,n._limitMinMaxDateTime(t,!0),n._onTimeChange(),n._updateDateTime(t)}},$.datepicker._setTimeDatepicker=function(t,e,n){var i=this._getInst(t);if(i){var o,r=this._get(i,"timepicker");if(r)this._setDateFromField(i),e&&("string"==typeof e?(r._parseTime(e,n),(o=new Date).setHours(r.hour,r.minute,r.second,r.millisec),o.setMicroseconds(r.microsec)):(o=new Date(e.getTime())).setMicroseconds(e.getMicroseconds()),"Invalid Date"===o.toString()&&(o=void 0),this._setTime(i,o))}},$.datepicker._base_setDateDatepicker=$.datepicker._setDateDatepicker,$.datepicker._setDateDatepicker=function(t,e){var n=this._getInst(t),i=e;if(n){"string"==typeof e&&((i=new Date(e)).getTime()||(this._base_setDateDatepicker.apply(this,arguments),i=$(t).datepicker("getDate")));var o,r=this._get(n,"timepicker");i instanceof Date?(o=new Date(i.getTime())).setMicroseconds(i.getMicroseconds()):o=i,r&&o&&(r.support.timezone||null!==r._defaults.timezone||(r.timezone=-1*o.getTimezoneOffset()),i=$.timepicker.timezoneAdjust(i,r.timezone),o=$.timepicker.timezoneAdjust(o,r.timezone)),this._updateDatepicker(n),this._base_setDateDatepicker.apply(this,arguments),this._setTimeDatepicker(t,o,!0)}},$.datepicker._base_getDateDatepicker=$.datepicker._getDateDatepicker,$.datepicker._getDateDatepicker=function(t,e){var n=this._getInst(t);if(n){var i=this._get(n,"timepicker");if(i){void 0===n.lastVal&&this._setDateFromField(n,e);var o=this._getDate(n),r=$.trim(i.$altInput&&i._defaults.altFieldTimeOnly?i.$input.val()+" "+i.$altInput.val():i.$input.val());return o&&i._parseTime(r,!n.settings.timeOnly)&&(o.setHours(i.hour,i.minute,i.second,i.millisec),o.setMicroseconds(i.microsec),null!=i.timezone&&(i.support.timezone||null!==i._defaults.timezone||(i.timezone=-1*o.getTimezoneOffset()),o=$.timepicker.timezoneAdjust(o,i.timezone))),o}return this._base_getDateDatepicker(t,e)}},$.datepicker._base_parseDate=$.datepicker.parseDate,$.datepicker.parseDate=function(e,n,i){var o;try{o=this._base_parseDate(e,n,i)}catch(t){if(!(0<=t.indexOf(":")))throw t;o=this._base_parseDate(e,n.substring(0,n.length-(t.length-t.indexOf(":")-2)),i),$.timepicker.log("Error parsing the date string: "+t+"\ndate string = "+n+"\ndate format = "+e)}return o},$.datepicker._base_formatDate=$.datepicker._formatDate,$.datepicker._formatDate=function(t,e,n,i){var o=this._get(t,"timepicker");return o?(o._updateDateTime(t),o.$input.val()):this._base_formatDate(t)},$.datepicker._base_optionDatepicker=$.datepicker._optionDatepicker,$.datepicker._optionDatepicker=function(t,e,n){var i,o=this._getInst(t);if(!o)return null;var r=this._get(o,"timepicker");if(r){var s,a,l,u,d=null,c=null,h=null,p=r._defaults.evnts,m={};if("string"==typeof e){if("minDate"===e||"minDateTime"===e)d=n;else if("maxDate"===e||"maxDateTime"===e)c=n;else if("onSelect"===e)h=n;else if(p.hasOwnProperty(e)){if(void 0===n)return p[e];m[e]=n,i={}}}else if("object"==typeof e)for(s in e.minDate?d=e.minDate:e.minDateTime?d=e.minDateTime:e.maxDate?c=e.maxDate:e.maxDateTime&&(c=e.maxDateTime),p)p.hasOwnProperty(s)&&e[s]&&(m[s]=e[s]);for(s in m)m.hasOwnProperty(s)&&(p[s]=m[s],i||(i=$.extend({},e)),delete i[s]);if(i&&isEmptyObject(i))return;if(d?(d=0===d?new Date:new Date(d),r._defaults.minDate=d,r._defaults.minDateTime=d):c?(c=0===c?new Date:new Date(c),r._defaults.maxDate=c,r._defaults.maxDateTime=c):h&&(r._defaults.onSelect=h),d||c)return l=(u=$(t)).datetimepicker("getDate"),a=this._base_optionDatepicker.call($.datepicker,t,i||e,n),u.datetimepicker("setDate",l),a}return void 0===n?this._base_optionDatepicker.call($.datepicker,t,e):this._base_optionDatepicker.call($.datepicker,t,i||e,n)};var isEmptyObject=function(t){var e;for(e in t)if(t.hasOwnProperty(e))return!1;return!0},extendRemove=function(t,e){for(var n in $.extend(t,e),e)null!==e[n]&&void 0!==e[n]||(t[n]=e[n]);return t},detectSupport=function(t){var e=t.replace(/'.*?'/g,"").toLowerCase(),n=function(t,e){return-1!==t.indexOf(e)};return{hour:n(e,"h"),minute:n(e,"m"),second:n(e,"s"),millisec:n(e,"l"),microsec:n(e,"c"),timezone:n(e,"z"),ampm:n(e,"t")&&n(t,"h"),iso8601:n(t,"Z")}},convert24to12=function(t){return 0===(t%=12)&&(t=12),String(t)},computeEffectiveSetting=function(t,e){return t&&t[e]?t[e]:$.timepicker._defaults[e]},splitDateTime=function(t,e){var n=computeEffectiveSetting(e,"separator"),i=computeEffectiveSetting(e,"timeFormat").split(n).length,o=t.split(n),r=o.length;return 1<r?{dateString:o.splice(0,r-i).join(n),timeString:o.splice(0,i).join(n)}:{dateString:t,timeString:""}},parseDateTimeInternal=function(t,e,n,i,o){var r,s,a;if(s=splitDateTime(n,o),r=$.datepicker._base_parseDate(t,s.dateString,i),""===s.timeString)return{date:r};if(!(a=$.datepicker.parseTime(e,s.timeString,o)))throw"Wrong time format";return{date:r,timeObj:a}},selectLocalTimezone=function(t,e){if(t&&t.timezone_select){var n=e||new Date;t.timezone_select.val(-n.getTimezoneOffset())}};$.timepicker=new Timepicker,$.timepicker.timezoneOffsetString=function(t,e){if(isNaN(t)||840<t||t<-720)return t;var n=t%60,i=(t-n)/60,o=e?":":"",r=(0<=t?"+":"-")+("0"+Math.abs(i)).slice(-2)+o+("0"+Math.abs(n)).slice(-2);return"+00:00"===r?"Z":r},$.timepicker.timezoneOffsetNumber=function(t){var e=t.toString().replace(":","");return"Z"===e.toUpperCase()?0:/^(\-|\+)\d{4}$/.test(e)?("-"===e.substr(0,1)?-1:1)*(60*parseInt(e.substr(1,2),10)+parseInt(e.substr(3,2),10)):t},$.timepicker.timezoneAdjust=function(t,e){var n=$.timepicker.timezoneOffsetNumber(e);return isNaN(n)||t.setMinutes(t.getMinutes()+-t.getTimezoneOffset()-n),t},$.timepicker.timeRange=function(t,e,n){return $.timepicker.handleRange("timepicker",t,e,n)},$.timepicker.datetimeRange=function(t,e,n){$.timepicker.handleRange("datetimepicker",t,e,n)},$.timepicker.dateRange=function(t,e,n){$.timepicker.handleRange("datepicker",t,e,n)},$.timepicker.handleRange=function(a,l,u,d){d=$.extend({},{minInterval:0,maxInterval:0,start:{},end:{}},d);var t=!1;function n(t,e){var n=l[a]("getDate"),i=u[a]("getDate"),o=t[a]("getDate");if(null!==n){var r=new Date(n.getTime()),s=new Date(n.getTime());r.setMilliseconds(r.getMilliseconds()+d.minInterval),s.setMilliseconds(s.getMilliseconds()+d.maxInterval),0<d.minInterval&&i<r?u[a]("setDate",r):0<d.maxInterval&&s<i?u[a]("setDate",s):i<n&&e[a]("setDate",o)}}function e(t,e,n){if(t.val()){var i=t[a].call(t,"getDate");null!==i&&0<d.minInterval&&("minDate"===n&&i.setMilliseconds(i.getMilliseconds()+d.minInterval),"maxDate"===n&&i.setMilliseconds(i.getMilliseconds()-d.minInterval)),i.getTime&&e[a].call(e,"option",n,i)}}return"timepicker"===a&&(t=!0,a="datetimepicker"),$.fn[a].call(l,$.extend({timeOnly:t,onClose:function(t,e){n($(this),u)},onSelect:function(t){e($(this),u,"minDate")}},d,d.start)),$.fn[a].call(u,$.extend({timeOnly:t,onClose:function(t,e){n($(this),l)},onSelect:function(t){e($(this),l,"maxDate")}},d,d.end)),n(l,u),e(l,u,"minDate"),e(u,l,"maxDate"),$([l.get(0),u.get(0)])},$.timepicker.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];window.console&&window.console.log.apply(window.console,Array.prototype.slice.call(t))},$.timepicker._util={_extendRemove:extendRemove,_isEmptyObject:isEmptyObject,_convert24to12:convert24to12,_detectSupport:detectSupport,_selectLocalTimezone:selectLocalTimezone,_computeEffectiveSetting:computeEffectiveSetting,_splitDateTime:splitDateTime,_parseDateTimeInternal:parseDateTimeInternal},Date.prototype.getMicroseconds||(Date.prototype.microseconds=0,Date.prototype.getMicroseconds=function(){return this.microseconds},Date.prototype.setMicroseconds=function(t){return this.setMilliseconds(this.getMilliseconds()+Math.floor(t/1e3)),this.microseconds=t%1e3,this}),$.timepicker.version="1.5.5"}}__webpack_require__.d(__webpack_exports__,"a",function(){return registerEqJquiTimePicker})},function(t,e,n){n(10),t.exports=n(22)},function(t,e,n){n(11),n(12),n(13)},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){(function(R,F){t.exports=function(){"use strict";function l(t){return"function"==typeof t}var n=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},i=0,e=void 0,o=void 0,a=function(t,e){h[i]=t,h[i+1]=e,2===(i+=2)&&(o?o(p):v())},t="undefined"!=typeof window?window:void 0,r=t||{},s=r.MutationObserver||r.WebKitMutationObserver,u="undefined"==typeof self&&void 0!==R&&"[object process]"==={}.toString.call(R),d="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function c(){var t=setTimeout;return function(){return t(p,1)}}var h=new Array(1e3);function p(){for(var t=0;t<i;t+=2){var e=h[t],n=h[t+1];e(n),h[t]=void 0,h[t+1]=void 0}i=0}var m,f,g,y,v=void 0;function _(t,e){var n=this,i=new this.constructor(b);void 0===i[x]&&L(i);var o=n._state;if(o){var r=arguments[o-1];a(function(){return P(o,i,r,n._result)})}else S(n,i,t,e);return i}function C(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(b);return q(e,t),e}v=u?function(){return R.nextTick(p)}:s?(f=0,g=new s(p),y=document.createTextNode(""),g.observe(y,{characterData:!0}),function(){y.data=f=++f%2}):d?((m=new MessageChannel).port1.onmessage=p,function(){return m.port2.postMessage(0)}):void 0===t?function(){try{var t=Function("return this")().require("vertx");return void 0===(e=t.runOnLoop||t.runOnContext)?c():function(){e(p)}}catch(t){return c()}}():c();var x=Math.random().toString(36).substring(2);function b(){}var T=void 0,k=1,w=2;function B(t,e,n,i){try{t.call(e,n,i)}catch(t){return t}}function E(t,e,n){var i,o,r,s;e.constructor===t.constructor&&n===_&&e.constructor.resolve===C?(r=t,(s=e)._state===k?M(r,s._result):s._state===w?D(r,s._result):S(s,void 0,function(t){return q(r,t)},function(t){return D(r,t)})):void 0===n?M(t,e):l(n)?(i=e,o=n,a(function(e){var n=!1,t=B(o,i,function(t){n||(n=!0,i!==t?q(e,t):M(e,t))},function(t){n||(n=!0,D(e,t))},e._label);!n&&t&&(n=!0,D(e,t))},t)):M(t,e)}function q(e,t){if(e===t)D(e,new TypeError("You cannot resolve a promise with itself"));else if(o=typeof(i=t),null===i||"object"!==o&&"function"!==o)M(e,t);else{var n=void 0;try{n=t.then}catch(t){return void D(e,t)}E(e,t,n)}var i,o}function I(t){t._onerror&&t._onerror(t._result),A(t)}function M(t,e){t._state===T&&(t._result=e,t._state=k,0!==t._subscribers.length&&a(A,t))}function D(t,e){t._state===T&&(t._state=w,t._result=e,a(I,t))}function S(t,e,n,i){var o=t._subscribers,r=o.length;t._onerror=null,o[r]=e,o[r+k]=n,o[r+w]=i,0===r&&t._state&&a(A,t)}function A(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var i=void 0,o=void 0,r=t._result,s=0;s<e.length;s+=3)i=e[s],o=e[s+n],i?P(n,i,o,r):o(r);t._subscribers.length=0}}function P(t,e,n,i){var o=l(n),r=void 0,s=void 0,a=!0;if(o){try{r=n(i)}catch(t){a=!1,s=t}if(e===r)return void D(e,new TypeError("A promises callback cannot return that same promise."))}else r=i;e._state!==T||(o&&a?q(e,r):!1===a?D(e,s):t===k?M(e,r):t===w&&D(e,r))}var O=0;function L(t){t[x]=O++,t._state=void 0,t._result=void 0,t._subscribers=[]}var j=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(b),this.promise[x]||L(this.promise),n(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?M(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&M(this.promise,this._result))):D(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===T&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===C){var o=void 0,r=void 0,s=!1;try{o=e.then}catch(t){s=!0,r=t}if(o===_&&e._state!==T)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===Q){var a=new n(b);s?D(a,r):E(a,e,o),this._willSettleAt(a,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(i(e),t)},t.prototype._settledAt=function(t,e,n){var i=this.promise;i._state===T&&(this._remaining--,t===w?D(i,n):this._result[e]=n),0===this._remaining&&M(i,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;S(t,void 0,function(t){return n._settledAt(k,e,t)},function(t){return n._settledAt(w,e,t)})},t}(),Q=function(){function e(t){this[x]=O++,this._result=this._state=void 0,this._subscribers=[],b!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t(function(t){q(e,t)},function(t){D(e,t)})}catch(t){D(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var n=this.constructor;return l(e)?this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})}):this.then(e,e)},e}();return Q.prototype.then=_,Q.all=function(t){return new j(this,t).promise},Q.race=function(o){var r=this;return n(o)?new r(function(t,e){for(var n=o.length,i=0;i<n;i++)r.resolve(o[i]).then(t,e)}):new r(function(t,e){return e(new TypeError("You must pass an array to race."))})},Q.resolve=C,Q.reject=function(t){var e=new this(b);return D(e,t),e},Q._setScheduler=function(t){o=t},Q._setAsap=function(t){a=t},Q._asap=a,Q.polyfill=function(){var t=void 0;if(void 0!==F)t=F;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=Q},Q.Promise=Q}()}).call(this,n(6),n(7))},function(t,e,n){(function(R,F){t.exports=function(){"use strict";function l(t){return"function"==typeof t}var n=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},i=0,e=void 0,o=void 0,a=function(t,e){h[i]=t,h[i+1]=e,2===(i+=2)&&(o?o(p):v())},t="undefined"!=typeof window?window:void 0,r=t||{},s=r.MutationObserver||r.WebKitMutationObserver,u="undefined"==typeof self&&void 0!==R&&"[object process]"==={}.toString.call(R),d="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function c(){var t=setTimeout;return function(){return t(p,1)}}var h=new Array(1e3);function p(){for(var t=0;t<i;t+=2){var e=h[t],n=h[t+1];e(n),h[t]=void 0,h[t+1]=void 0}i=0}var m,f,g,y,v=void 0;function _(t,e){var n=this,i=new this.constructor(b);void 0===i[x]&&L(i);var o=n._state;if(o){var r=arguments[o-1];a(function(){return P(o,i,r,n._result)})}else S(n,i,t,e);return i}function C(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(b);return q(e,t),e}v=u?function(){return R.nextTick(p)}:s?(f=0,g=new s(p),y=document.createTextNode(""),g.observe(y,{characterData:!0}),function(){y.data=f=++f%2}):d?((m=new MessageChannel).port1.onmessage=p,function(){return m.port2.postMessage(0)}):void 0===t?function(){try{var t=Function("return this")().require("vertx");return void 0===(e=t.runOnLoop||t.runOnContext)?c():function(){e(p)}}catch(t){return c()}}():c();var x=Math.random().toString(36).substring(2);function b(){}var T=void 0,k=1,w=2;function B(t,e,n,i){try{t.call(e,n,i)}catch(t){return t}}function E(t,e,n){var i,o,r,s;e.constructor===t.constructor&&n===_&&e.constructor.resolve===C?(r=t,(s=e)._state===k?M(r,s._result):s._state===w?D(r,s._result):S(s,void 0,function(t){return q(r,t)},function(t){return D(r,t)})):void 0===n?M(t,e):l(n)?(i=e,o=n,a(function(e){var n=!1,t=B(o,i,function(t){n||(n=!0,i!==t?q(e,t):M(e,t))},function(t){n||(n=!0,D(e,t))},e._label);!n&&t&&(n=!0,D(e,t))},t)):M(t,e)}function q(e,t){if(e===t)D(e,new TypeError("You cannot resolve a promise with itself"));else if(o=typeof(i=t),null===i||"object"!==o&&"function"!==o)M(e,t);else{var n=void 0;try{n=t.then}catch(t){return void D(e,t)}E(e,t,n)}var i,o}function I(t){t._onerror&&t._onerror(t._result),A(t)}function M(t,e){t._state===T&&(t._result=e,t._state=k,0!==t._subscribers.length&&a(A,t))}function D(t,e){t._state===T&&(t._state=w,t._result=e,a(I,t))}function S(t,e,n,i){var o=t._subscribers,r=o.length;t._onerror=null,o[r]=e,o[r+k]=n,o[r+w]=i,0===r&&t._state&&a(A,t)}function A(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var i=void 0,o=void 0,r=t._result,s=0;s<e.length;s+=3)i=e[s],o=e[s+n],i?P(n,i,o,r):o(r);t._subscribers.length=0}}function P(t,e,n,i){var o=l(n),r=void 0,s=void 0,a=!0;if(o){try{r=n(i)}catch(t){a=!1,s=t}if(e===r)return void D(e,new TypeError("A promises callback cannot return that same promise."))}else r=i;e._state!==T||(o&&a?q(e,r):!1===a?D(e,s):t===k?M(e,r):t===w&&D(e,r))}var O=0;function L(t){t[x]=O++,t._state=void 0,t._result=void 0,t._subscribers=[]}var j=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(b),this.promise[x]||L(this.promise),n(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?M(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&M(this.promise,this._result))):D(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===T&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===C){var o=void 0,r=void 0,s=!1;try{o=e.then}catch(t){s=!0,r=t}if(o===_&&e._state!==T)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===Q){var a=new n(b);s?D(a,r):E(a,e,o),this._willSettleAt(a,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(i(e),t)},t.prototype._settledAt=function(t,e,n){var i=this.promise;i._state===T&&(this._remaining--,t===w?D(i,n):this._result[e]=n),0===this._remaining&&M(i,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;S(t,void 0,function(t){return n._settledAt(k,e,t)},function(t){return n._settledAt(w,e,t)})},t}(),Q=function(){function e(t){this[x]=O++,this._result=this._state=void 0,this._subscribers=[],b!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t(function(t){q(e,t)},function(t){D(e,t)})}catch(t){D(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var n=this.constructor;return l(e)?this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})}):this.then(e,e)},e}();return Q.prototype.then=_,Q.all=function(t){return new j(this,t).promise},Q.race=function(o){var r=this;return n(o)?new r(function(t,e){for(var n=o.length,i=0;i<n;i++)r.resolve(o[i]).then(t,e)}):new r(function(t,e){return e(new TypeError("You must pass an array to race."))})},Q.resolve=C,Q.reject=function(t){var e=new this(b);return D(e,t),e},Q._setScheduler=function(t){o=t},Q._setAsap=function(t){a=t},Q._asap=a,Q.polyfill=function(){var t=void 0;if(void 0!==F)t=F;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=Q},Q.Promise=Q}()}).call(this,n(6),n(7))},function(t,e,n){(function(R,F){t.exports=function(){"use strict";function l(t){return"function"==typeof t}var n=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},i=0,e=void 0,o=void 0,a=function(t,e){h[i]=t,h[i+1]=e,2===(i+=2)&&(o?o(p):v())},t="undefined"!=typeof window?window:void 0,r=t||{},s=r.MutationObserver||r.WebKitMutationObserver,u="undefined"==typeof self&&void 0!==R&&"[object process]"==={}.toString.call(R),d="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function c(){var t=setTimeout;return function(){return t(p,1)}}var h=new Array(1e3);function p(){for(var t=0;t<i;t+=2){var e=h[t],n=h[t+1];e(n),h[t]=void 0,h[t+1]=void 0}i=0}var m,f,g,y,v=void 0;function _(t,e){var n=this,i=new this.constructor(b);void 0===i[x]&&L(i);var o=n._state;if(o){var r=arguments[o-1];a(function(){return P(o,i,r,n._result)})}else S(n,i,t,e);return i}function C(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(b);return q(e,t),e}v=u?function(){return R.nextTick(p)}:s?(f=0,g=new s(p),y=document.createTextNode(""),g.observe(y,{characterData:!0}),function(){y.data=f=++f%2}):d?((m=new MessageChannel).port1.onmessage=p,function(){return m.port2.postMessage(0)}):void 0===t?function(){try{var t=Function("return this")().require("vertx");return void 0===(e=t.runOnLoop||t.runOnContext)?c():function(){e(p)}}catch(t){return c()}}():c();var x=Math.random().toString(36).substring(2);function b(){}var T=void 0,k=1,w=2;function B(t,e,n,i){try{t.call(e,n,i)}catch(t){return t}}function E(t,e,n){var i,o,r,s;e.constructor===t.constructor&&n===_&&e.constructor.resolve===C?(r=t,(s=e)._state===k?M(r,s._result):s._state===w?D(r,s._result):S(s,void 0,function(t){return q(r,t)},function(t){return D(r,t)})):void 0===n?M(t,e):l(n)?(i=e,o=n,a(function(e){var n=!1,t=B(o,i,function(t){n||(n=!0,i!==t?q(e,t):M(e,t))},function(t){n||(n=!0,D(e,t))},e._label);!n&&t&&(n=!0,D(e,t))},t)):M(t,e)}function q(e,t){if(e===t)D(e,new TypeError("You cannot resolve a promise with itself"));else if(o=typeof(i=t),null===i||"object"!==o&&"function"!==o)M(e,t);else{var n=void 0;try{n=t.then}catch(t){return void D(e,t)}E(e,t,n)}var i,o}function I(t){t._onerror&&t._onerror(t._result),A(t)}function M(t,e){t._state===T&&(t._result=e,t._state=k,0!==t._subscribers.length&&a(A,t))}function D(t,e){t._state===T&&(t._state=w,t._result=e,a(I,t))}function S(t,e,n,i){var o=t._subscribers,r=o.length;t._onerror=null,o[r]=e,o[r+k]=n,o[r+w]=i,0===r&&t._state&&a(A,t)}function A(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var i=void 0,o=void 0,r=t._result,s=0;s<e.length;s+=3)i=e[s],o=e[s+n],i?P(n,i,o,r):o(r);t._subscribers.length=0}}function P(t,e,n,i){var o=l(n),r=void 0,s=void 0,a=!0;if(o){try{r=n(i)}catch(t){a=!1,s=t}if(e===r)return void D(e,new TypeError("A promises callback cannot return that same promise."))}else r=i;e._state!==T||(o&&a?q(e,r):!1===a?D(e,s):t===k?M(e,r):t===w&&D(e,r))}var O=0;function L(t){t[x]=O++,t._state=void 0,t._result=void 0,t._subscribers=[]}var j=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(b),this.promise[x]||L(this.promise),n(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?M(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&M(this.promise,this._result))):D(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===T&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===C){var o=void 0,r=void 0,s=!1;try{o=e.then}catch(t){s=!0,r=t}if(o===_&&e._state!==T)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===Q){var a=new n(b);s?D(a,r):E(a,e,o),this._willSettleAt(a,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(i(e),t)},t.prototype._settledAt=function(t,e,n){var i=this.promise;i._state===T&&(this._remaining--,t===w?D(i,n):this._result[e]=n),0===this._remaining&&M(i,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;S(t,void 0,function(t){return n._settledAt(k,e,t)},function(t){return n._settledAt(w,e,t)})},t}(),Q=function(){function e(t){this[x]=O++,this._result=this._state=void 0,this._subscribers=[],b!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t(function(t){q(e,t)},function(t){D(e,t)})}catch(t){D(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var n=this.constructor;return l(e)?this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})}):this.then(e,e)},e}();return Q.prototype.then=_,Q.all=function(t){return new j(this,t).promise},Q.race=function(o){var r=this;return n(o)?new r(function(t,e){for(var n=o.length,i=0;i<n;i++)r.resolve(o[i]).then(t,e)}):new r(function(t,e){return e(new TypeError("You must pass an array to race."))})},Q.resolve=C,Q.reject=function(t){var e=new this(b);return D(e,t),e},Q._setScheduler=function(t){o=t},Q._setAsap=function(t){a=t},Q._asap=a,Q.polyfill=function(){var t=void 0;if(void 0!==F)t=F;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=Q},Q.Promise=Q}()}).call(this,n(17),n(18))},function(t,e){var n,i,o=t.exports={};function r(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===r||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:r}catch(t){n=r}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(t){i=s}}();var l,u=[],d=!1,c=-1;function h(){d&&l&&(d=!1,l.length?u=l.concat(u):c=-1,u.length&&p())}function p(){if(!d){var t=a(h);d=!0;for(var e=u.length;e;){for(l=u,u=[];++c<e;)l&&l[c].run();c=-1,e=u.length}l=null,d=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(t)}}function m(t,e){this.fun=t,this.array=e}function f(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new m(t,e)),1!==u.length||d||a(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=f,o.addListener=f,o.once=f,o.off=f,o.removeListener=f,o.removeAllListeners=f,o.emit=f,o.prependListener=f,o.prependOnceListener=f,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},,,,function(t,e,n){"use strict";n.r(e);var i={};n.r(i),n.d(i,"EqServerBroker",function(){return l.a}),n.d(i,"EqBrokerAction",function(){return u.a});var o={};n.r(o),n.d(o,"EasyChartWidget",function(){return W}),n.d(o,"EntitiesPanel",function(){return k}),n.d(o,"EqResultGrid",function(){return I}),n.d(o,"HtmlContentWidget",function(){return M}),n.d(o,"EqHtmlGrid",function(){return S}),n.d(o,"Grid",function(){return B}),n.d(o,"StatementPanel",function(){return $}),n.d(o,"ProcessWidget",function(){return V}),n.d(o,"GoogleChartProvider",function(){return O}),n.d(o,"ChartJsChartProvider",function(){return L}),n.d(o,"DefaultDialogService",function(){return j.a}),n.d(o,"AdvancedSearchView",function(){return Y}),n.d(o,"DataFilterView",function(){return K}),n.d(o,"ReportView",function(){return Z}),n.d(o,"DragManager",function(){return X}),n.d(o,"eqDragManager",function(){return tt}),n.d(o,"domel",function(){return nt});var r={};n.r(r),n.d(r,"JQueryColumnsBarWidget",function(){return xt}),n.d(r,"JQueryColumnsPanelWidget",function(){return Tt}),n.d(r,"JQueryEntitiesPanelWidget",function(){return wt}),n.d(r,"JQueryQueryPanelWidget",function(){return Et}),n.d(r,"JQueryFilterBarWidget",function(){return It}),n.d(r,"AdvancedSearchViewJQuery",function(){return St}),n.d(r,"DataFilterViewJQuery",function(){return Pt}),n.d(r,"ReportViewJQuery",function(){return Lt}),n.d(r,"HtmlDataFilterView",function(){return Qt}),n.d(r,"JQueryDialogService",function(){return Mt.a});var s,a,F=n(0),l=n(5),u=n(1);function N(t,e,n){var i=document.createElement(e),o=n||{};return o.cssClass&&(i.className=o.cssClass),t.appendChild(i),i}function m(t,e){t.className=t.className?t.className+" "+e:e}function d(t){t.style.display="none"}function f(t,e){e||(e="block"),t.style.display=e}function c(e){var t=e.pageIndex||1,n=e.pageCount||1,i=function(){if(this.hasAttribute("data-page")){var t=parseInt(this.getAttribute("data-page"));e.pageSelectedCallback&&e.pageSelectedCallback(t)}},o=e.maxButtonCount||10,r=t-1,s=r-r%o+1,a=s+o-1;n<a&&(a=n);var l=document.createElement("ul");e.useBootstrap?l.className="pagination":l.className="eqv-pagination",e.pageItemCssClass&&(l.className+=" "+e.pageItemCssClass);var u=document.createElement("li");e.useBootstrap&&(u.className="page-item");var d=document.createElement("span");if(d.setAttribute("aria-hidden","true"),e.useBootstrap&&(d.className="page-link"),1==s)u.className+=" disabled";else{if(e.useBootstrap)(d=document.createElement("a")).setAttribute("href","javascript:void(0)"),d.setAttribute("data-page",""+(s-1)),d.className="page-link";else(h=document.createElement("a")).setAttribute("href","javascript:void(0)"),h.setAttribute("data-page",""+(s-1)),d=h;d.addEventListener("click",i)}d.innerHTML="&laquo;",u.appendChild(d),l.appendChild(u);for(var c=s;c<=a;c++)u=document.createElement("li"),e.useBootstrap&&(u.className="page-item"),c==t&&(u.className+=" active"),(d=document.createElement("a")).setAttribute("href","javascript:void(0)"),d.innerHTML=c.toString(),d.setAttribute("data-page",c.toString()),d.className="page-link",d.addEventListener("click",i),u.appendChild(d),l.appendChild(u);if(u=document.createElement("li"),e.useBootstrap&&(u.className="page-item"),(d=document.createElement("span")).setAttribute("aria-hidden","true"),e.useBootstrap&&(d.className="page-link"),a==n)u.className+="disabled";else{var h;if(e.useBootstrap)(d=document.createElement("a")).setAttribute("href","javascript:void(0)"),d.setAttribute("data-page",""+(a+1)),d.className+=" page-link";else(h=document.createElement("a")).setAttribute("href","javascript:void(0)"),h.setAttribute("data-page",""+(a+1)),d=h;d.addEventListener("click",i)}return d.innerHTML="&raquo;",u.appendChild(d),l.appendChild(u),l}F.eqi18n.updateLocaleTexts("en",{RemoveQueryTitle:"Confirmation",RemoveQueryContent:"Remove query '{queryName}'?",NewQueryTitle:"New query",NewQueryContent:"Enter new query name",NewQueryDefName:"New query",SaveQueryTitle:"Save query",SaveQueryContent:"Please, enter query name: ",SaveQueryDefName:"{queryName} copy",QueryChangedTitle:"Confirmation",QueryChangedContent:"Query was changed. Do you want to save it first?",UpdateQuerySelector:"[click here to load query]"}),(a=s||(s={}))[a.Column=3]="Column",a[a.Histogram=4]="Histogram",a[a.Bar=5]="Bar",a[a.Combo=6]="Combo",a[a.Area=7]="Area",a[a.Line=9]="Line",a[a.Pie=10]="Pie",a[a.Donut=12]="Donut",a[a.Gauge=17]="Gauge",a[a.Candlestick=18]="Candlestick";var h,p,g,y,v,_,C,x,b=(h=function(t,e){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}h(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),W=function(i){function t(t,e){var n=i.call(this,t)||this;return n.chartType=s.Pie,n.supportedChartTypes=[],n.chartProvider=null,n.dataTable=null,n.potentialLabelColumns=[],n.potentialDataColumns=[],n.labelColumnIndex=-1,n.dataColumnIndexes=[],n.cssClasses={header:"eqjs-chart-header",main:"eqjs-chart-main",settings:"eqjs-chart-settings",content:"eqjs-chart-content"},n.element=t,n.chartProvider=e,n.group=F.WidgetGroup.Result,n}return b(t,i),t.prototype.init=function(t,e){i.prototype.init.call(this,t,e),this.dataTable=t.resultSet,this.setOptions(e)},t.prototype.hasData=function(){var t=null!=this.dataTable;return t&&(t=0<this.dataTable.getNumberOfColumns()&&0<this.dataTable.getNumberOfRows()),t},t.prototype.hasColumnsForChart=function(){return 0<this.potentialLabelColumns.length&&0<this.potentialDataColumns.length},t.prototype.refreshCore=function(){this.dataTable=this.context.resultSet,this.prepareChartData(),this.render()},t.prototype.setOptions=function(t){t.chartType&&(this.chartType=t.chartType),t.chartProvider&&(this.chartProvider=t.chartProvider)},t.prototype.setChartProvider=function(t){this.chartProvider=t},t.prototype.getChartTypeName=function(t){switch(t){case s.Area:return"Area chart";case s.Bar:return"Bar chart";case s.Candlestick:return"Candlestick chart";case s.Column:return"Column chart";case s.Combo:return"Combo chart";case s.Donut:return"Donut chart";case s.Gauge:return"Gauge chart";case s.Histogram:return"Histogram chart";case s.Line:return"Line chart";default:return"Pie chart"}},t.prototype.prepareChartData=function(){if(this.chartProvider&&this.dataTable){this.supportedChartTypes=this.chartProvider.getSupportedChartTypes(),this.potentialLabelColumns=[],this.potentialDataColumns=[];for(var t=this.dataTable.getNumberOfColumns(),e=0;e<t;e++){var n=this.dataTable.getColumnType(e),i=this.dataTable.getColumnLabel(e);"string"==n?this.potentialLabelColumns.push({idx:e,label:i}):"number"==n&&this.potentialDataColumns.push({idx:e,label:i})}0<this.potentialLabelColumns.length?this.labelColumnIndex=this.potentialLabelColumns[0].idx:this.labelColumnIndex=-1,0<this.potentialDataColumns.length?this.dataColumnIndexes=[].concat(this.potentialDataColumns[0].idx):this.dataColumnIndexes=[],this.chartProvider.init(this.dataTable,this.chartType,this.labelColumnIndex,this.dataColumnIndexes)}},t.prototype.render=function(){var n=this;if(this.clear(),this.hasData()&&this.hasColumnsForChart()&&this.context.paging.pageCount<=1){var t=document.createElement("div");m(t,this.cssClasses.header);var e=document.createElement("div");if(m(e,this.cssClasses.main),null!=this.chartProvider&&this.chartProvider.canDraw()){for(var i=document.createElement("select"),o=0,r=this.supportedChartTypes;o<r.length;o++){var s=r[o],a=document.createElement("option");a.value=s.toString(),a.text=this.getChartTypeName(s),i.appendChild(a)}i.value=this.chartType.toString(),t.appendChild(i),i.addEventListener("change",function(t){var e=t.target.value;n.chartType=parseInt(e),n.chartProvider.setChartType(n.chartType),n.refresh()}),this.settingsDiv=document.createElement("div"),m(this.settingsDiv,this.cssClasses.settings),d(this.settingsDiv),e.appendChild(this.settingsDiv),this.chartDiv=document.createElement("div"),m(this.chartDiv,this.cssClasses.content),d(this.chartDiv),e.appendChild(this.chartDiv),this.initSettingsDiv();var l=document.createElement("div");m(l,"eqjs-chart-settings-icon"),l.title="Settings",t.appendChild(l),l.onclick=function(t){n.toggleSettings()},this.drawChart(100)}else this.addContentDiv(e,"Chart Provider is not defined");this.element.appendChild(t),this.element.appendChild(e),this.element.style.display=""}else this.element.style.display="none"},t.prototype.addContentDiv=function(t,e){var n=document.createElement("div");m(n,"eqjs-chart-no-data"),n.innerText=e,t.appendChild(n)},t.prototype.clear=function(){this.element.innerHTML=""},t.prototype.drawChart=function(t){var e=this;f(this.chartDiv,"block");var n=this,i=function(){n.chartProvider.draw(e.chartDiv)};0<t?setTimeout(i,t):i()},t.prototype.initSettingsDiv=function(){var e=this,t=document.createElement("div");t.textContent="SETTINGS",m(t,this.cssClasses.settings+"-header"),this.settingsDiv.appendChild(t);var n=document.createElement("div");m(n,this.cssClasses.settings+"-single"),this.settingsDiv.appendChild(n);var i=document.createElement("span");f(i,"inline-block"),i.textContent="Label column",n.appendChild(i);var o=document.createElement("select");f(o,"inline-block"),n.appendChild(o);for(var r=0,s=this.potentialLabelColumns;r<s.length;r++){var a=s[r];(p=document.createElement("option")).value=a.idx.toString(),p.text=a.label,o.appendChild(p)}0<=this.labelColumnIndex&&(o.value=this.labelColumnIndex.toString()),o.addEventListener("change",function(t){e.labelColumnIndex=parseInt(t.target.value),e.chartProvider.setLabelColumn(e.labelColumnIndex),e.chartProvider.updateChartColumns(),e.toggleSettings(function(){e.drawChart(100)})});var l=document.createElement("div");m(l,this.cssClasses.settings+"-single"),this.settingsDiv.appendChild(l);var u=document.createElement("span");f(u,"inline-block"),u.textContent="Data column",l.appendChild(u);var d=document.createElement("select");f(d,"inline-block"),l.appendChild(d);for(var c=0,h=this.potentialDataColumns;c<h.length;c++){var p;a=h[c];(p=document.createElement("option")).value=a.idx.toString(),p.text=a.label,d.appendChild(p)}0<this.dataColumnIndexes.length&&0<=this.dataColumnIndexes[0]&&(d.value=this.dataColumnIndexes[0].toString()),d.addEventListener("change",function(t){e.dataColumnIndexes[0]=parseInt(t.target.value),e.chartProvider.setDataColumns(e.dataColumnIndexes),e.chartProvider.updateChartColumns(),e.toggleSettings(function(){e.drawChart(100)})})},t.prototype.toggleSettings=function(t){var e,n,i,o,r,s;n="none"!=(i=this.chartDiv).style.display&&0!=i.offsetWidth&&0!=i.offsetHeight?(e=this.chartDiv,this.settingsDiv):(e=this.settingsDiv,this.chartDiv),o=e,r=n,(s={complete:t})||(s={}),s.display||(s.display="block"),s.duration||(s.duration=200),d(o),f(r,s.display),s.complete&&s.complete()},t}(F.Widget),T=(p=function(t,e){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}p(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),k=function(n){function t(t){var e=n.call(this,t)||this;return e.group=F.WidgetGroup.Model,e.widgetType="entitiesPanel",e.panel=t,e}return T(t,n),t.prototype.init=function(t,e){n.prototype.init.call(this,t,e),this.setOptions(e)},t.prototype.refreshCore=function(){this.render(),this.options.syncWithColumns&&this.refreshCheckedStateByColumns()},t.prototype.startLoading=function(){this.options.showIndicatorOnLoad&&this.panel.appendChild(this.progressBlock)},t.prototype.finishLoading=function(){this.options.showIndicatorOnLoad&&this.panel.removeChild(this.progressBlock)},t.prototype.setOptions=function(t){this.options={showToolbar:!0,showSelectAllButton:!1,showClearSelectionButton:!0,showAddColumnButton:!0,showAddConditionButton:!0,showCheckboxes:!0,showTooltips:!0,clickableAttributes:0,draggableAttributes:!0,showAttributes:{usedInConditions:!0,usedInColumns:!0,usedInSorting:!1},showFilterBox:!1,filterBoxMode:0,showIndicatorOnLoad:!0,attrPlacement:0,sortEntities:!1,autoClearSelection:!0,syncWithColumns:!1,entityRenderedCallback:null,attributeRenderedCallback:null},t&&F.equtils.assignDeep(this.options,t)},t.prototype.render=function(){var t=this.context.getModel();if(this.clear(),this.panel.classList.contains("eqjs-ep-panel")||(this.panel.className+=" eqjs-ep-panel"),this.rootEntityBlock=document.createElement("div"),null!=t&&!t.isEmpty()){var e=t.getEntitiesTree({addUIC:this.options.showAttributes.usedInConditions,addUIR:this.options.showAttributes.usedInColumns,addUIS:this.options.showAttributes.usedInSorting,attrPlacement:this.options.attrPlacement,sortEntities:this.options.sortEntities,includeRootData:!0});this.entityTreeBlock=this.renderEntity(e,this.rootEntityBlock,0),this.panel.append(this.entityTreeBlock)}this.options.showFilterBox?this.createFilterBox():this.rootEntityBlock.style.top="0",this.options.showToolbar&&!this.options.syncWithColumns?this.createToolPanel():this.rootEntityBlock.style.bottom="0",this.renderProgressBlock()},t.prototype.renderEntity=function(t,e,n){var i,o=this,r="eqjs-ep-entity",s=document.createElement("div");s.className+=" "+r+"-node";var a=document.createElement("div");a.className+=" "+r+"-children";var l=document.createElement("label");l.className+=" "+r+"-node-label";var u=document.createElement("input");u.type="checkbox";var d,c,h,p=document.createElement("a");p.href="javascript:void(0)",p.className+=" "+r+"-node-button";var m=n;if(e?(i=e).innerHTML="":i=document.createElement("div"),i.className+=" "+r,t.id&&""!=t.id){l.innerText=t.text,s.append(l),o.options.showCheckboxes&&l.prepend(u),s.prepend(p),o.options.showTooltips&&t.description&&l.setAttribute("title",t.description);for(var f=0;f<m;f++){(C=document.createElement("div")).className+=" "+r+"-offset",s.prepend(C)}i.append(s),a.hidden=!0,m++}var g,y=t.items?t.items.length:0;for(f=0;f<y;f++){var v=t.items[f];if(v.isEntity)a.append(o.renderEntity(v,null,m));else if(!(v.lookupAttr&&(g=v.lookupAttr,0<a.querySelectorAll("."+r+'-attr[data-id="'+g+'"]').length))){(c=document.createElement("label")).innerText=v.text,c.className+=" "+r+"-attr-label",o.options.showCheckboxes&&((h=document.createElement("input")).type="checkbox",c.prepend(h),h.addEventListener("change",function(){o.options.syncWithColumns})),o.options.showTooltips&&v.description&&c.setAttribute("title",v.description);for(var _=0;_<m+1;_++){var C;(C=document.createElement("div")).className+=" "+r+"-offset",c.prepend(C)}var x=r+"-attr";0==s.innerHTML.length&&(x+=" "+r+"-attr-root"),(d=document.createElement("div")).setAttribute("class",x),d.innerHTML="",d.appendChild(c),d.setAttribute("data-id",v.id),o.options.draggableAttributes,1==o.options.clickableAttributes||o.options.clickableAttributes,this.options.attributeRenderedCallback&&this.options.attributeRenderedCallback(d),a.append(d)}}(a.innerHTML.length&&(i.append(a),p.addEventListener("click",function(t){a.hidden=!a.hidden;var e=t.target,n=r+"-node-button-open";e.classList.contains(n)?e.classList.remove(n):e.className+=" "+n,t.preventDefault()})),a)&&a.querySelectorAll(".eqjs-ep-entity-attr > label > input").forEach(function(t){t.addEventListener("click",function(t){t.target.checked&&!u.checked?u.checked=!0:0===a.querySelectorAll("input:checked").length&&(u.checked=!1),t.stopPropagation()})});return u.addEventListener("click",function(t){var e=t.target;a.querySelectorAll("label input").forEach(function(t){t.checked=e.checked}),o.options.syncWithColumns,t.stopPropagation()}),e!=this.rootEntityBlock&&this.options.entityRenderedCallback&&this.options.entityRenderedCallback(i),i},t.prototype.createFilterBox=function(){var e=this,t="eqjs-ep-filter-box";e.filterBoxBlock=document.createElement("div"),e.filterBoxBlock.className=t,e.filterBoxInput=document.createElement("input"),e.filterBoxInput.className=t+"-input",e.filterBoxInput.addEventListener("keydown",function(t){return!t.keyCode||(e.filterBoxInput.value="",e.filterBoxInput.dispatchEvent(new Event("input")),t.stopPropagation(),!1)}),e.filterBoxInput.addEventListener("input",function(t){e.panel.querySelectorAll(".eqjs-ep-entity-attr").forEach(function(t){t.hidden=!e.checkFilterAttribute(t)}),e.panel.querySelectorAll(">.eqjs-ep-entity").forEach(function(t){for(var e=t.querySelectorAll(".eqjs-ep-entity-attr"),n=0,i=0;i<e.length;i++)"None"!==e[i].style.display&&n++;t.hidden=0===n}),""===e.filterBoxInput.value?e.collapseAll():e.expandAll()}),e.filterBoxBlock.append(e.filterBoxInput),e.panel.prepend(e.filterBoxBlock)},t.prototype.createToolPanel=function(){var o=this,t="eqjs-ep-tool-panel",e=document.createElement("div");e.className=t;var n=document.createElement("div");n.className=t+"-select-all",n.title="Select all";var i=document.createElement("div");i.className=t+"-deselect-all",i.title="Clear selection";var r=document.createElement("div");r.className=t+"-add-columns",r.title="Add column";var s=document.createElement("div");s.className=t+"-add-cond",s.title="Add condition";var a=document.createElement("div");a.className=t+"-left-side";var l=document.createElement("div");l.className=t+"-right-side";var u=o.context.getModel();this.options.showSelectAllButton&&(n.title=F.eqi18n.getText("ButtonSelectAll"),a.append(n),n.addEventListener("click",function(){o.selectAll()})),this.options.showClearSelectionButton&&(i.title=F.eqi18n.getText("ButtonDeselectAll"),a.append(i),i.addEventListener("click",function(){o.deselectAll()})),this.options.showAddColumnButton&&(r.title=F.eqi18n.getText("ButtonAddColumns"),l.append(r),r.addEventListener("click",function(){var e,t=o.panel.querySelectorAll(".eqjs-ep-entity-attr"),n=[],i=o.context.getQuery();i.fireProcessEvent({source:o,status:"start"}),t.forEach(function(t){t.getElementsByTagName("input")[0].checked&&(e=t.getAttribute("data-id"),u.checkAttrProperty(e,"usedInResult")&&n.push(e))}),o.options.autoClearSelection&&o.deselectAll(),i.fireProcessEvent({source:o,status:"finish"})})),this.options.showAddConditionButton&&(s.title=F.eqi18n.getText("ButtonAddConditions"),l.append(s),s.addEventListener("click",function(){var e,t=o.panel.querySelectorAll(".eqjs-ep-entity-attr"),n=[],i=o.context.getQuery();i.fireProcessEvent({source:o,status:"start"}),t.forEach(function(t){t.getElementsByTagName("input")[0].checked&&(e=t.getAttribute("data-id"),u.checkAttrProperty(e,"usedInCondition")&&n.push(e))}),o.options.autoClearSelection&&o.deselectAll(),i.fireProcessEvent({source:o,status:"finish"})})),e.append(a,l),this.panel.append(e)},t.prototype.checkFilterAttribute=function(t){if(t.querySelector("label input").checked)return!0;var e=t.querySelector("label").textContent;if(this.checkFilterText(e))return!0;var n=t.parentElement.parentElement.querySelector(".eqjs-ep-entity-node").querySelector("label").textContent;return!!this.checkFilterText(n)},t.prototype.checkFilterText=function(t){var e=this.filterBoxInput.value;return""==e||(0==this.options.filterBoxMode&&0<=t.toLowerCase().indexOf(e.toLowerCase())||1==this.options.filterBoxMode&&0==t.toLowerCase().indexOf(e.toLowerCase()))},t.prototype.refreshCheckedStateByColumns=function(){},t.prototype.expandAll=function(){this.rootEntityBlock.childNodes.forEach(function(t){t.querySelectorAll(".eqjs-ep-entity-children").forEach(function(t){t.hidden=!1})}),this.rootEntityBlock.querySelectorAll(".eqjs-ep-entity-node-button").forEach(function(t){t.className+=" eqjs-ep-entity-node-button-open"})},t.prototype.collapseAll=function(){this.rootEntityBlock.childNodes.forEach(function(t){t.querySelectorAll(".eqjs-ep-entity-children").forEach(function(t){t.hidden=!0})}),this.rootEntityBlock.querySelectorAll(".eqjs-ep-entity-node-button").forEach(function(t){t.classList.remove("eqjs-ep-entity-node-button-open")})},t.prototype.selectAll=function(){this.entityTreeBlock.querySelectorAll("input").forEach(function(t){t.checked=!0})},t.prototype.deselectAll=function(){this.entityTreeBlock.querySelectorAll("input").forEach(function(t){t.checked=!1})},t.prototype.renderProgressBlock=function(){this.progressBlock=document.createElement("div"),this.progressBlock.className+=" eqjs-progress-win8",this.progressBlock.innerHTML='<div class="wBall" id="wBall_1"><div class="wInnerBall"></div></div><div class="wBall" id="wBall_2"><div class="wInnerBall"></div></div><div class="wBall" id="wBall_3"><div class="wInnerBall"></div></div><div class="wBall" id="wBall_4"><div class="wInnerBall"></div></div><div class="wBall" id="wBall_5"><div class="wInnerBall"></div></div>'},t.prototype.clear=function(){this.panel.innerHTML=""},t}(F.Widget),w=(g=function(t,e){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}g(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),B=function(n){function t(t){var e=n.call(this,t)||this;return e.slot=t,e.group=F.WidgetGroup.Result,e}return w(t,n),t.prototype.init=function(t,e){n.prototype.init.call(this,t,e),e&&(this.beforeTableRendering=e.beforeTableRendering,this.formatColumnHeader=e.formatColumnHeader,this.formatGridCell=e.formatGridCell,this.pageItemCssClass=e.pageItemCssClass,this.maxButtonCount=e.maxButtonCount,this.tableClass=e.tableClass)},t.prototype.refreshCore=function(){this.clear(),this.context.resultSet&&0!==this.context.resultSet.getColumnId.length&&(this.render(),this.context.paging&&this.context.paging.enabled&&this.renderPageNavigator())},t.prototype.render=function(){},t.prototype.renderPageNavigator=function(){},t.prototype.clear=function(){this.slot.innerHTML=""},t}(F.Widget),E=(y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),I=function(n){function t(t){var e=n.call(this,t)||this;return e.widgetType="resultGrid",e}return E(t,n),t.prototype.init=function(t,e){n.prototype.init.call(this,t,e)},t.prototype.render=function(){this.beforeTableRendering&&this.beforeTableRendering(this.context.resultSet);var t=document.createElement("table");t.style.width="100%",this.tableClass&&(t.className=this.tableClass);for(var e=this.context.resultSet.getNumberOfColumns(),n=0;n<e;n++){var i=this.context.resultSet.getColumnLabel(n);this.formatColumnHeader&&(i=this.formatColumnHeader(this.context.resultSet,n,i));var o=document.createElement("th");o.innerHTML=i,t.appendChild(o)}var r=document.createElement("tr");r.className="eqv-result-grid-header",function(t,e){for(t.appendChild(e);t.firstChild!==e;)e.appendChild(t.firstChild)}(t,r);var s=this.context.resultSet.getNumberOfRows();for(n=0;n<s;n++){for(var a=document.createElement("tr"),l=0;l<e;l++){var u=this.context.resultSet.getFormattedValue(n,l);this.formatGridCell&&(u=this.formatGridCell(this.context.resultSet,n,l,u));var d=document.createElement("td");d.innerHTML=u,a.appendChild(d)}t.appendChild(a)}var c=document.createElement("div");c.className="eqv-grid-panel",c.appendChild(t),this.slot.appendChild(c)},t.prototype.renderPageNavigator=function(){if(1<this.context.paging.pageCount){var t=c(this.context.paging);this.slot.appendChild(t)}},t}(B),q=(v=function(t,e){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}v(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),M=function(n){function t(t){var e=n.call(this,t)||this;return e.contentElement=t,e.widgetType="HtmlContent",e.group=F.WidgetGroup.Result,e}return q(t,n),t.prototype.init=function(t,e){n.prototype.init.call(this,t,e)},t.prototype.refreshCore=function(){this.clear(),this.context.resultContent&&this.render()},t.prototype.render=function(){this.context.resultContent&&(this.contentElement.innerHTML+=this.context.resultContent)},t.prototype.clear=function(){this.contentElement.innerHTML=""},t}(F.Widget),D=(_=function(t,e){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}_(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),S=function(n){function t(t){var e=n.call(this,t)||this;return e.widgetType="eqHtmlGrid",e}return D(t,n),t.prototype.init=function(t,e){n.prototype.init.call(this,t,e),e&&(this.pageItemCssClass=e.pageItemCssClass,this.maxButtonCount=e.maxButtonCount)},t.prototype.refreshCore=function(){n.prototype.refreshCore.call(this),this.renderPageNavigator()},t.prototype.renderPageNavigator=function(){var t=document.getElementById("PageNavigator");if(t){var e=parseInt(t.getAttribute("data-pagecount")),n=parseInt(t.getAttribute("data-pageindex"));if(1<e){var i=c({pageCount:e,pageIndex:n,pageSelectedCallback:this.context.paging.pageSelectedCallback,maxButtonCount:this.context.paging.maxButtonCount,cssClass:this.context.paging.cssClass,useBootstrap:this.context.paging.useBootstrap});t.appendChild(i)}}},t}(M),A=(C=function(t,e){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}C(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),$=function(n){function t(t){var e=n.call(this,t)||this;return e.panel=t,e.group=F.WidgetGroup.Result|F.WidgetGroup.Query,"TEXTAREA"!==e.panel.tagName&&(e.panel.innerHTML='<div class="eqv-sql-panel-result"></div>',e.panel=e.panel.querySelector("div")),e}return A(t,n),t.prototype.refreshCore=function(){this.clear(),this.render()},t.prototype.render=function(){this.panel.textContent=this.context.resultStatement?this.context.resultStatement:"";var t=this.panel.innerHTML.replace(/\r\n/g,"<br />").replace(/  /g,"&nbsp;&nbsp;");this.panel.innerHTML=t},t.prototype.clear=function(){this.panel.innerHTML=""},t}(F.Widget),P=(x=function(t,e){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}x(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),V=function(n){function t(t){var e=n.call(this,t)||this;return e.element=t,e.element.style.display="none",e.widgetType="ProcessWidget",e.group=F.WidgetGroup.All,e}return P(t,n),t.prototype.onProcessStartCore=function(){this.element.style.display="block"},t.prototype.onProcessEndCore=function(){this.element.style.display="none"},t}(F.Widget),O=function(){function t(){this.chartType=s.Pie,this.googleDataView=null,this.labelColumn=-1,this.dataColumns=[]}return t.prototype.getSupportedChartTypes=function(){return[s.Column,s.Bar,s.Combo,s.Area,s.Line,s.Pie]},t.prototype.init=function(t,e,n,i){if(this.chartType=e,this.labelColumn=n,this.dataColumns=i,this.hasGoogleCharts()&&0<=this.labelColumn&&this.dataColumns&&0<this.dataColumns.length){var o=new google.visualization.DataTable(t.getObject());this.googleDataView=new google.visualization.DataView(o),this.updateChartColumns()}},t.prototype.hasGoogleCharts=function(){return"undefined"!=typeof google&&void 0!==google.charts},t.prototype.setChartType=function(t){this.chartType=t},t.prototype.setLabelColumn=function(t){this.labelColumn=t},t.prototype.setDataColumns=function(t){this.dataColumns=t},t.prototype.updateChartColumns=function(){this.googleDataView&&this.googleDataView.setColumns([].concat(this.labelColumn).concat(this.dataColumns))},t.prototype.getChartAreaWidth=function(t){return t==s.Pie?"100%":"50%"},t.prototype.draw=function(t){if(null!=this.googleDataView){var e={width:"100%",height:"100%",chartArea:{width:this.getChartAreaWidth}};this.createChart(t).draw(this.googleDataView,e)}},t.prototype.getProviderType=function(){return"google"},t.prototype.createChart=function(t){switch(this.chartType){case 3:return new google.visualization.ColumnChart(t);case 4:return new google.visualization.Histogram(t);case 5:return new google.visualization.BarChart(t);case 6:return new google.visualization.ComboChart(t);case 7:return new google.visualization.AreaChart(t);case 9:return new google.visualization.LineChart(t);case 10:return new google.visualization.PieChart(t);case 17:return new google.visualization.Gauge(t);case 18:return new google.visualization.CandlestickChart(t);default:return new google.visualization.PieChart(t)}},t.prototype.canDraw=function(){return this.hasGoogleCharts()},t}(),L=function(){function t(){this.chartType=s.Pie,this.dataTable=null,this.labelColumn=-1,this.dataColumns=[],this.chartLabels=[],this.chartColumns=[],this.colors=["#4dc9f6","#f67019","#f53794","#537bc4","#acc236","#166a8f","#00a950","#58595b","#8549ba"]}return t.prototype.getSupportedChartTypes=function(){return[s.Column,s.Bar,s.Line,s.Pie]},t.prototype.init=function(t,e,n,i){this.dataTable=t,this.chartType=e,this.labelColumn=n,this.dataColumns=i,this.hasChartJs()&&0<=this.labelColumn&&this.dataColumns&&0<this.dataColumns.length&&this.updateChartColumns()},t.prototype.hasChartJs=function(){return"undefined"!=typeof Chart},t.prototype.setChartType=function(t){this.chartType=t},t.prototype.setLabelColumn=function(t){this.labelColumn=t},t.prototype.setDataColumns=function(t){this.dataColumns=t},t.prototype.updateChartColumns=function(){if(this.dataTable){this.chartLabels=[],this.chartColumns=[];for(var t=this.dataTable.getNumberOfRows(),e=0;e<t;e++)this.chartLabels.push(this.dataTable.getFormattedValue(e,this.labelColumn)),this.chartColumns.push(this.dataTable.getFormattedValue(e,this.dataColumns[0]))}},t.prototype.draw=function(t){if(!this.hasChartJs())throw new Error("ChartJS script is not inlcuded");if(this.dataTable&&0<this.dataTable.getNumberOfRows()){var e=this.generateConfig(),n=this.getChartCanvas(t).getContext("2d");new Chart(n,e)}},t.prototype.getChartCanvas=function(t){var e=t.getElementsByTagName("canvas");return e&&0<e.length?e[0]:N(t,"canvas")},t.prototype.generateConfig=function(){var t,e=[],n=this.dataTable.getColumnLabel(this.dataColumns[0]),i=!0,o=!0;if(this.chartType==s.Pie){i=!1;for(var r=0;r<this.chartLabels.length;r++)e.push(this.colors[r%this.colors.length])}else e=[this.colors[3]];return this.chartType==s.Line&&(o=!1,t=this.colors[3]),{type:this.getChartType(),data:{datasets:[{data:this.chartColumns,backgroundColor:e,borderColor:t,label:n,fill:o}],labels:this.chartLabels},options:{legend:{display:i}}}},t.prototype.getProviderType=function(){return"chartjs"},t.prototype.randomColor=function(){var t=Math.round(10*Math.random())%this.colors.length;return this.colors[t]},t.prototype.getChartType=function(){switch(this.chartType){case s.Column:return"bar";case s.Bar:return"horizontalBar";case s.Line:return"line";case s.Pie:default:return"pie"}},t.prototype.canDraw=function(){return this.hasChartJs()},t}(),j=n(2);function z(t){var e=window.easyQuerySettings,n=window.easyQueryViewSettings,i=t;return e&&((i={broker:{}}).broker.serviceUrl=e.serviceUrl,i.broker.newQueryUrl=e.newQueryUrl,i.broker.saveQueryUrl=e.saveQueryUrl,i.broker.executeQueryUrl=e.executeQueryUrl,i.broker.removeQueryUrl=e.removeQueryUrl,i.broker.loadModelUrl=e.loadModelUrl,i.broker.loadQueryUrl=e.loadQueryUrl,i.broker.loadQueryListUrl=e.loadQueryListUrl,i.broker.syncQueryUrl=e.syncQueryUrl,i.broker.executeSqlUrl=e.executeQueryUrl,i.broker.listRequestUrl=e.listRequestUrl,i.broker.syncQueryOptions=e.syncQueryOptions,i.loadModelOnStart=e.loadModelOnStart,i.loadQueryOnStart=e.loadQueryOnStart,i.defaultModelId=e.defaultModelId,i.defaultQueryId=e.defaultQueryId,i.locale=e.locale,i.initialQuery=e.initialQuery,i.handlers={},i.handlers.onInit=e.onInit,i.handlers.onInitialModelLoad=e.onInitialModelLoad,i.handlers.onLoadModel=e.onLoadModel,i.handlers.onLoadQuery=e.onLoadQuery,i.handlers.onProcessEnd=e.onProcessEnd,i.handlers.onProcessStart=e.onProcessStart,i.handlers.listRequestHandler=e.listRequestHandler,i.widgets={},i.widgets.columnsPanel=e.columnsPanel,i.widgets.entitiesPanel=e.entitiesPanel,i.widgets.queryPanel=e.queryPanel,i.widgets.columnsBar=e.columnsBar,i.result={paging:{},showChart:!1}),n&&(void 0===n.showChart&&(i.result.showChart=n.showChart),i.result.paging=n.paging,i.result.paging&&(i.result.paging.useBootstrap=e.useBootstrap)),i}var Q,R,H=(Q=function(t,e){return(Q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Q(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),U=function(n){function t(t){var e=n.call(this,t)||this;return e.widgetType="LocaleWidget",e.group=F.WidgetGroup.None,e.refresh(),e}return H(t,n),t.prototype.refreshCore=function(){this.clear(),this.render()},t.prototype.render=function(){var t=F.eqi18n.getLocales();if(1<t.length){this.selectEl=document.createElement("select");for(var e=0,n=t;e<n.length;e++){var i=n[e],o=document.createElement("option");o.value=i.locale,o.innerHTML=this.displayLocaleName(i),this.selectEl.appendChild(o)}this.selectEl.value=F.eqi18n.getCurrentLocale(),this.selectEl.addEventListener("change",this.changeLocale.bind(this)),this.slot.appendChild(this.selectEl)}},t.prototype.displayLocaleName=function(t){return t.englishName&&t.displayName?t.englishName+" - "+t.displayName:t.englishName?t.englishName:t.displayName?t.displayName:t.locale},t.prototype.clear=function(){this.slot.innerHTML=""},t.prototype.changeLocale=function(){var t=this.selectEl.value;F.eqi18n.setLocale(t),this.context.refreshWidgets(F.WidgetGroup.All)},t}(F.Widget),G=(R=function(t,e){return(R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}R(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),J=function(n){function t(t){var e=n.call(this,t)||this;return e.isQueryModified=!1,e.group=F.WidgetGroup.Query,e}return G(t,n),t.prototype.refreshCore=function(){this.isQueryModified=this.context.query.isModified,this.render()},t.prototype.render=function(){this.slot.classList.add("eqjs-query-name"),this.nameSlot||(this.nameSlot=document.createElement("div"),this.nameSlot.classList.add("eqjs-query-name-text"),this.nameSlot.classList.add("eqjs-query-name-theme"),this.slot.appendChild(this.nameSlot)),this.asteriskSlot||(this.asteriskSlot=document.createElement("span"),this.asteriskSlot.innerHTML="*",this.asteriskSlot.classList.add("eqjs-query-name-asterisk"),this.slot.appendChild(this.asteriskSlot)),this.tooltipSlot||(this.tooltipSlot=document.createElement("span"),this.tooltipSlot.classList.add("eqjs-query-name-tooltip"),this.tooltipSlot.classList.add("eqjs-query-name-theme"),this.slot.appendChild(this.tooltipSlot)),this.nameSlot.textContent=this.context.query.getName(),this.tooltipSlot.textContent=this.context.query.getName(),this.asteriskSlot.style.visibility=this.isQueryModified?"visible":"hidden"},t.prototype.clear=function(){this.slot.innerHTML="",this.nameSlot=null,this.tooltipSlot=null,this.asteriskSlot=null},t}(F.Widget),Y=function(){function t(){this.context=new F.EqContext,this.exportButtons=[],this.dialogService=new j.a,this.defaultViewOptions={result:{showChart:!0}},this.disabledClass="eqjs-disabled",this.dropdownContainerClass="eqv-dropdown-container",this.dropdownButtonClass="eqv-drop-button",this.dropdownContentClass="eqv-dropdown-content",this.dropdownShowClass="eqv-dropdown-show",this.defaultPagingOptions={}}return t.prototype.init=function(t){var e=this,n="eqjs-export",i="QueryNameLabel",o="QueryContentJson",r="QueryPanel",s="ColumnsPanel",a="EntitiesPanel",l="ClearQueryButton",u="NewQueryButton",d="LoadQueryButton",c="SaveQueryButton",h="CopyQueryButton",p="RemoveQueryButton",m="StorageDropButton",f="ExecuteQueryButton",g="ResultPanel",y="ProcessBar",v="ResultCount",_="ChangeLocaleSelector",C=t=t?F.equtils.assignDeep({},this.defaultViewOptions,t):z(this.defaultViewOptions);this.resultOptions=t.result||{},this.resultOptions.paging?this.pagingOptions=F.equtils.assignDeep({},this.defaultPagingOptions,this.resultOptions.paging):this.pagingOptions=F.equtils.assignDeep({},this.defaultPagingOptions),t.slots&&(i=t.slots.queryNameLabelId||i,o=t.slots.queryContentInputId||o,r=t.slots.queryPanelId||r,s=t.slots.columnsPanelId||s,a=t.slots.entitiesPanelId||a,g=t.slots.resultPanelId||g,f=t.slots.executeQueryButtonId||f,l=t.slots.clearQueryButtonId||l,u=t.slots.newQueryButtonId||u,d=t.slots.loadQueryButtonId||d,c=t.slots.saveQueryButtonId||c,h=t.slots.copyQueryButtonId||h,p=t.slots.removeQueryButtonId||p,m=t.slots.storageButtonId||m,y=t.slots.processBarId||y,v=t.slots.resultCountSpanId||v,_=t.slots.changeLocaleId||_,n=t.slots.exportClass||n),this.exportButtons=F.equtils.copyArrayFrom(document.getElementsByClassName(n)),t.enableExport||this.hideExportButtons();var x=this;this.disableExportButtons(),this.exportButtons.forEach(function(t){t.addEventListener("click",function(t){if(!this.classList.contains(x.disabledClass)){var e=this.getAttribute("data-format");x.getContext().getBroker().exportResult({format:e})}})}),this.resultCountSlot=document.getElementById(v);var b=document.getElementById(a);if(b){var T=this.createEntitiesPanelWidget(b);this.context.addWidget(T)}var k=document.getElementById(s);if(k){T=this.createColumnsPanelWidget(k);this.context.addWidget(T)}var w=document.getElementById(r);if(w){T=this.createQueryPanelWidget(w);this.context.addWidget(T)}var B=document.getElementById(g);if(B){var E=N(B,"div",{cssClass:"eqv-result-grid"}),q=this.createResultGrid(E);if(this.context.addWidget(q),this.resultOptions.showChart){var I=N(B,"div",{cssClass:"eqv-chart-panel"}),M=this.resultOptions.chartProviderResolver&&this.resultOptions.chartProviderResolver()||this.createDefaultChartProvider(),D=new W(I,M);this.context.addWidget(D)}}if(this.queryNameLabel=document.getElementById(i),this.queryNameLabel){var S=new J(this.queryNameLabel);this.context.addWidget(S)}var A=document.getElementById(y);if(A){var P=new V(A);this.context.addWidget(P)}var O=document.getElementById(_);if(O){var L=this.createLocaleWidget(O);this.context.addWidget(L)}this.executeQueryButton=document.getElementById(f),this.executeQueryButton&&this.executeQueryButton.addEventListener("click",this.executeQueryButtonClick.bind(this)),this.clearQueryButton=document.getElementById(l),this.clearQueryButton&&this.clearQueryButton.addEventListener("click",this.clearQueryButtonClick.bind(this)),this.newQueryButton=document.getElementById(u),this.newQueryButton&&this.newQueryButton.addEventListener("click",this.newQueryButtonClick.bind(this)),this.queryListSelector=document.getElementById("QueryListSelector"),this.queryListSelector&&this.queryListSelector.addEventListener("change",this.queryListSelectorChange.bind(this)),this.loadQueryButton=document.getElementById(d),this.loadQueryButton&&this.loadQueryButton.addEventListener("click",this.loadQueryButtonClick.bind(this)),this.saveQueryButton=document.getElementById(c),this.saveQueryButton&&this.saveQueryButton.addEventListener("click",this.saveQueryButtonClick.bind(this)),this.copyQueryButton=document.getElementById(h),this.copyQueryButton&&this.copyQueryButton.addEventListener("click",this.copyQueryButtonClick.bind(this)),this.removeQueryButton=document.getElementById(p),this.removeQueryButton&&this.removeQueryButton.addEventListener("click",this.removeQueryButtonClick.bind(this)),this.storageDropButton=document.getElementById(m),this.storageDropButton&&this.storageDropButton.addEventListener("click",this.storageDropButtonClick.bind(this));var j=document.getElementById("StatementPanel");if(j){var Q=new $(j);this.context.addWidget(Q)}C.broker||(C.broker={}),C.broker.resolver||(C.broker.resolver=function(t){return e.createDefaultBroker(t)}),C.handlers||(C.handlers={}),!1!==t.result.clearResultOnQueryChange&&this.context.addQueryChangedCallback(function(t){t.data&&"query.all"===t.data.changeType||e.context.clearResult()}),C.handlers.onError||(C.handlers.onError=function(t){alert(t.action+": "+t.text)}),this.context.init(C),this.context.addEventListener("ready",function(){x.queryListSelector&&x.updateQuerySelector()});var R=this.context.getQuery();R.addChangedCallback(function(){e.syncQuery(),e.disableExportButtons(),e.resultCountSlot&&(e.resultCountSlot.style.display="none")}),(t.result||1==t.result.clearResultOnQueryChange)&&R.addChangedCallback(function(){return e.context.clearResult()}),window.addEventListener("click",function(t){var e=null;t.target.matches("."+x.dropdownButtonClass)?e=t.target.parentElement.querySelector("."+x.dropdownContentClass):t.target.matches("."+x.dropdownButtonClass+" > span")&&(e=t.target.parentElement.parentElement.querySelector("."+x.dropdownContentClass));for(var n=document.getElementsByClassName(x.dropdownContentClass),i=0;i<n.length;i++){var o=n[i];e!=o&&o.classList.contains(x.dropdownShowClass)&&o.classList.remove(x.dropdownShowClass)}}),this.initDone()},t.prototype.initDone=function(){},t.prototype.createDefaultChartProvider=function(){return new L},t.prototype.createResultGrid=function(t){return this.resultOptions.resultGridResolver?this.resultOptions.resultGridResolver(t):new I(t)},t.prototype.createDefaultBroker=function(t){throw new Error("Not implmeneted: createDefaultBroker")},t.prototype.createEntitiesPanelWidget=function(t){return new k(t)},t.prototype.createColumnsPanelWidget=function(t){throw new Error("Not implmeneted: createColumnsPanelWidget")},t.prototype.createQueryPanelWidget=function(t){throw new Error("Not implmeneted: createQueryPanelWidget")},t.prototype.createLocaleWidget=function(t){return new U(t)},t.prototype.executeQuery=function(t){var e=this;t=t||{page:1};var n=this;this.context.getBroker().executeQuery({options:{page:t.page,resultFormat:1},success:function(t){t&&t.paging?(n.context.paging={enabled:t.paging.enabled,pageIndex:t.paging.pageIndex,pageCount:t.paging.pageCount,pageSelectedCallback:function(t){n.executeQuery({page:t})},maxButtonCount:n.pagingOptions?n.pagingOptions.maxButtonCount:null,cssClass:n.pagingOptions?n.pagingOptions.cssClass:null},e.displayRecordsCount(t.paging.totalRecords)):e.displayRecordsCount(n.context.resultSet?n.context.resultSet.getNumberOfRows():0),n.context.resultSet&&!n.context.resultSet.isEmpty()?e.enableExportButtons():e.disableExportButtons()}})},t.prototype.syncQuery=function(){this.context.getBroker().syncQuery()},t.prototype.disableExportButtons=function(){var e=this;this.exportButtons.forEach(function(t){t.disabled=!0,t.classList.contains(e.disabledClass)||t.classList.add(e.disabledClass)})},t.prototype.enableExportButtons=function(){var e=this;this.exportButtons.forEach(function(t){t.disabled=!1,t.classList.contains(e.disabledClass)&&t.classList.remove(e.disabledClass)})},t.prototype.hideExportButtons=function(){this.exportButtons.forEach(function(t){t.style.display="none"})},t.prototype.displayRecordsCount=function(t){this.resultCountSlot&&(this.resultCountSlot.style.display="inline",this.resultCountSlot.innerHTML=F.eqi18n.getText("MsgResultCount").replace("{0}",t.toString()))},t.prototype.clearQueryButtonClick=function(){this.context.clearQuery()},t.prototype.createNewQuery=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null);var n=this.context.getQuery();n.reset(),t&&n.setId(t),e&&n.setName(e),this.context.getBroker().newQuery({queryName:e,success:function(){}})},t.prototype.loadQuery=function(t){if(t){var e=this.context.getQuery();this.context.getBroker().loadQuery({id:t,silent:!0,success:function(){e.fireChangedEvent({changeType:"query.all"},!1)}})}},t.prototype.saveQuery=function(t){this.context.getBroker().saveQuery({success:t,error:function(){alert("Error on query saving!")}})},t.prototype.saveCurrentQuery=function(t,e){var n=this;void 0===t&&(t=!1);var i=this.context.getQuery();i.isNewbie||t?this.showSaveQueryDialog(function(t){t&&(i.setId(F.equtils.generateId()),i.setName(t),n.saveQuery(e))}):this.saveQuery(e)},t.prototype.checkIfQueryModified=function(e){var n=this;this.context.query.isModified?this.showQueryChangedDialog(function(t){t?n.saveCurrentQuery(!1,e):e()}):e()},t.prototype.removeCurrentQuery=function(){var t=this.context.getQuery(),e=t.getId();this.context.getBroker().removeQuery({queryId:e,success:function(){t.reset()}})},t.prototype.showNewQueryDialog=function(t){this.dialogService.openPrompt(F.eqi18n.getText("NewQueryTitle"),F.eqi18n.getText("NewQueryContent"),F.eqi18n.getText("NewQueryDefName"),t)},t.prototype.showQueryChangedDialog=function(t){this.dialogService.openConfirm(F.eqi18n.getText("QueryChangedTitle"),F.eqi18n.getText("QueryChangedContent"),t)},t.prototype.showSaveQueryDialog=function(t){var e=this.context.getQuery(),n=e.isNewbie?e.getName():F.eqi18n.getText("SaveQueryDefName").replace("{queryName}",e.getName());this.dialogService.openPrompt(F.eqi18n.getText("SaveQueryTitle"),F.eqi18n.getText("SaveQueryContent"),n,t)},t.prototype.showRemoveQueryDialog=function(t){var e=this.context.getQuery();this.dialogService.openConfirm(F.eqi18n.getText("RemoveQueryTitle"),F.eqi18n.getText("RemoveQueryContent").replace("{queryName}",e.getName()),t)},t.prototype.newQueryButtonClick=function(){var t=this;this.checkIfQueryModified(function(){t.createNewQuery()})},t.prototype.loadQueryButtonClick=function(){var t=this.loadQueryButton.parentElement,e=t.querySelector("."+this.dropdownContentClass);if(e&&e.classList.contains(this.dropdownShowClass))e.classList.toggle(this.dropdownShowClass);else{e||((e=document.createElement("div")).className=this.dropdownContentClass,t.appendChild(e));var n=this;this.context.getBroker().loadQueryList({success:function(t){n.fillLoadQueryButtonMenu(t,function(t){n.checkIfQueryModified(function(){return n.loadQuery(t)})}),e.classList.toggle(n.dropdownShowClass)}})}},t.prototype.fillLoadQueryButtonMenu=function(t,n){var e=this.loadQueryButton.parentElement;if(e.classList.contains(this.dropdownContainerClass)){var i=e.querySelector("."+this.dropdownContentClass);i.innerHTML="",t.map(function(t){var e=document.createElement("a");e.href="#",e.text=t.name,e.setAttribute("data-id",t.id),e.addEventListener("click",function(t){n(t.target.getAttribute("data-id"))}),i.appendChild(e)})}},t.prototype.updateQuerySelector=function(){var r=this,t=this.context.getBroker();this.queryListSelector.innerHTML="";var e=document.createElement("option");e.id="",e.text=F.eqi18n.getText("UpdateQuerySelector"),this.queryListSelector.add(e),t.loadQueryList({success:function(t){for(var e=0,n=t;e<n.length;e++){var i=n[e],o=document.createElement("option");o.id=i.id,o.text=i.name,r.queryListSelector.add(o)}}})},t.prototype.queryListSelectorChange=function(){var t=this,e=this.queryListSelector.selectedIndex,n=this.queryListSelector.options[e].id;this.checkIfQueryModified({success:function(){return t.loadQuery(n)}})},t.prototype.saveQueryButtonClick=function(){this.saveCurrentQuery()},t.prototype.copyQueryButtonClick=function(){this.saveCurrentQuery(!0)},t.prototype.removeQueryButtonClick=function(){var e=this;this.showRemoveQueryDialog(function(t){t&&e.removeCurrentQuery()})},t.prototype.storageDropButtonClick=function(){var t=this.storageDropButton.parentElement.querySelector("."+this.dropdownContentClass);t&&t.classList.toggle(this.dropdownShowClass)},t.prototype.executeQueryButtonClick=function(){this.executeQuery()},t.prototype.getContext=function(){return this.context},t.prototype.setDialogService=function(t){this.dialogService=t},t}(),K=function(){function t(){this.context=new F.EqContext,this.defaultViewOptions={result:{showChart:!1}},this.defaultPagingOptions={}}return t.prototype.init=function(t){var e=this,n=(t=t?F.equtils.assignDeep({},this.defaultViewOptions,t):z(this.defaultViewOptions)).result||{};n.paging?this.pagingOptions=F.equtils.assignDeep({},this.defaultPagingOptions,n.paging):this.pagingOptions=F.equtils.assignDeep({},this.defaultPagingOptions);var i="ResultPanel",o="FilterBar",r="ProcessBar",s=t;s.widgets||(s.widgets={}),t.slots&&(i=t.slots.resultPanelId||i,o=t.slots.filterBarId||o,r=t.slots.processBarId||r);var a=document.getElementById(i);if(a){var l=this.createResultGridWidget(a);this.context.addWidget(l)}var u=document.getElementById(o);if(u){var d=this.createFilterBarWidget(u);this.context.addWidget(d),s.widgets[d.widgetType]||(s.widgets[d.widgetType]={}),s.widgets[d.widgetType].applyFilterCallback||(s.widgets[d.widgetType].applyFilterCallback=function(){e.applyQueryFilter()})}var c=document.getElementById(r);if(c){var h=new V(c);this.context.addWidget(h)}s.broker||(s.broker={}),s.broker.resolver||(s.broker.resolver=function(t){return e.createDefaultBroker(t)}),s.handlers||(s.handlers={}),s.handlers.onError||(s.handlers.onError=function(t){alert(t.action+": "+t.text)}),this.context.addEventListener("ready",this.applyQueryFilter.bind(this)),this.context.init(s)},t.prototype.applyQueryFilter=function(t){t=t||{page:1};var e=this;this.context.getBroker().executeQuery({options:{page:t.page,resultFormat:1},success:function(t){t&&(e.context.paging={enabled:t.paging?t.paging.enabled:void 0,pageIndex:t.paging?t.paging.pageIndex:void 0,pageCount:t.paging?t.paging.pageCount:void 0,pageSelectedCallback:function(t){e.applyQueryFilter({page:t})},maxButtonCount:e.pagingOptions?e.pagingOptions.maxButtonCount:null,cssClass:e.pagingOptions?e.pagingOptions.cssClass:null,useBootstrap:e.pagingOptions.useBootstrap})}})},t.prototype.createDefaultBroker=function(t){throw new Error("Not implmeneted: createDefaultBroker")},t.prototype.createFilterBarWidget=function(t){throw new Error("Not implmeneted: createFilterBarWidget")},t.prototype.createResultGridWidget=function(t){var e=N(t,"div",{cssClass:"eqv-result-grid"});return new I(e)},t.prototype.getContext=function(){return this.context},t}(),Z=function(){function t(){this.context=new F.EqContext,this.reports=[],this.reportCache=[],this.exportButtons=[],this.exportClass="eqjs-export",this.disabledClass="eqjs-disabled",this.enableExport=!1,this.useReportCache=!0,this.defaultOptions={result:{showChart:!0}},this.defaultPagingOptions={}}return t.prototype.init=function(t){var e=this,n=this,i=(t=t?F.equtils.assignDeep({},this.defaultOptions,t):z(this.defaultOptions)).result||{};i.paging?this.pagingOptions=F.equtils.assignDeep({},this.defaultPagingOptions,i.paging):this.pagingOptions=F.equtils.assignDeep({},this.defaultPagingOptions),void 0===t.syncReportOnChange&&(t.syncReportOnChange=!0),void 0!==t.useReportCache&&(this.useReportCache=t.useReportCache);var o="ProcessBar",r="QueryPanel",s="ColumnsBar",a="ResultPanel",l="ClearReportButton",u="NewReportButton",d="LoadReportButton",c="SaveReportButton",h="RemoveReportButton",p="UpdateReportButton",m="ResultCount",f="ResultExportButtons",g=this.exportClass,y=t;t.slots&&(o=t.slots.processBarId||o,r=t.slots.queryPanelId||r,s=t.slots.columnsPanelId||s,a=t.slots.resultPanelId||a,m=t.slots.resultCountSpanId||m,f=t.slots.exportButtonsId||f,l=t.slots.clearReportButtonId||l,u=t.slots.newReportButtonId||u,d=t.slots.loadReportButtonId||d,c=t.slots.saveReportButtonId||c,h=t.slots.removeReportButtonId||h,p=t.slots.updateReportButtonId||p,g=t.slots.exportClass||g),this.exportButtons=F.equtils.copyArrayFrom(document.getElementsByClassName(g)),this.enableExport=t.enableExport,this.enableExport?this.exportButtons.forEach(function(t){t.addEventListener("click",function(t){if(!this.classList.contains(n.disabledClass)){var e=this.getAttribute("data-format");n.getContext().getBroker().exportResult({format:e})}})}):this.hideExportButtons(),this.exportButtonsContainer=this.findControlById(f),this.clearReportButton=this.findControlById(l),this.clearReportButton&&this.clearReportButton.addEventListener("click",this.clearReportButtonClick.bind(this)),this.newReportButton=this.findControlById(u),this.newReportButton&&this.newReportButton.addEventListener("click",this.newReportButtonClick.bind(this)),this.loadReportButton=this.findControlById(d),this.loadReportButton&&this.loadReportButton.addEventListener("click",this.loadReportButtonClick.bind(this)),this.saveReportButton=this.findControlById(c),this.saveReportButton&&this.saveReportButton.addEventListener("click",this.saveReportButtonClick.bind(this)),this.removeReportButton=this.findControlById(h),this.removeReportButton&&this.removeReportButton.addEventListener("click",this.removeReportButtonClick.bind(this)),this.updateReportButton=this.findControlById(p),this.updateReportButton&&this.updateReportButton.addEventListener("click",this.updateReportButtonClick.bind(this)),this.reportListPlaceholder=this.findControlById("ReportList"),this.resultCountSlot=document.getElementById(m);var v=document.getElementById(s);if(v){var _=this.createColumnsBarWidget(v);this.context.addWidget(_)}var C=document.getElementById(r);if(C){_=this.createQueryPanelWidget(C);this.context.addWidget(_)}var x=document.getElementById(a);if(x){var b=N(x,"div",{cssClass:"eqv-result-grid"});_=new I(b);if(this.context.addWidget(_),i.showChart){var T=N(x,"div",{cssClass:"eqv-chart-panel"}),k=i.chartProviderResolver&&i.chartProviderResolver()||this.createDefaultChartProvider(),w=new W(T,k);this.context.addWidget(w)}}var B=document.getElementById(o);if(B){var E=new V(B);this.context.addWidget(E)}y.broker||(y.broker={}),y.broker.resolver||(y.broker.resolver=function(t){return e.createDefaultBroker(t)}),y.handlers||(y.handlers={}),y.handlers.onError||(y.handlers.onError=function(t){alert(t.action+": "+t.text)}),this.context.init(y);var q=this.context.getQuery();t.syncReportOnChange&&q.addChangedCallback(function(t){t.data&&"query.switched"!=t.data.changeType&&n.syncReport()}),(t.result||1==t.result.clearResultOnQueryChange)&&q.addChangedCallback(function(t){t.data&&"query.switched"==t.data.changeType||n.context.clearResult()}),q.addChangedCallback(function(t){t.data&&"query.switched"!=t.data.changeType&&(e.disableExportButtons(),e.resultCountSlot&&(e.resultCountSlot.style.display="none"))}),window.setTimeout(function(){n.context.getBroker().loadQueryList({success:function(t){Array.isArray(t)&&(n.reports=t,n.renderReportList())}})},100)},t.prototype.createDefaultChartProvider=function(){return new L},t.prototype.createDefaultBroker=function(t){throw new Error("Not implmeneted: createDefaultBroker")},t.prototype.createColumnsBarWidget=function(t){throw new Error("Not implmeneted: createColumnsBarWidget")},t.prototype.createQueryPanelWidget=function(t){throw new Error("Not implmeneted: createQueryPanelWidget")},t.prototype.findControlById=function(t){return document.getElementById(t)},t.prototype.newReport=function(){var n=this,t=prompt("Enter report name","New report");if(t){var e=this.context.getQuery();e.clear(!0),e.setId(null),this.context.getBroker().newQuery({queryName:t,success:function(){var t=n.context.getQuery(),e=t.getId();n.insertIntoReportList({id:e,name:t.getName()}),n.renderReportList({reportId:e})}})}},t.prototype.loadReport=function(t){var e=this;if(t){var n=this.findReportById(t);if(n){var i=this,o=i.context.getQuery(),r=this.useReportCache?this.getReportContentFromCache(n):null;r?(o.clear(!0),o.loadFromJson(r,!0),s()):this.context.getBroker().loadQuery({id:t,silent:!0,success:function(){e.saveReportContentInCache(n,o.toJSON()),s()}}),this.setActiveReport(t)}}function s(){i.renderReportProps(),o.fireChangedEvent({changeType:"query.switched"}),i.executeQuery()}},t.prototype.saveCurrentReportAs=function(){var n=this,t=this.context.getQuery(),e=prompt("Enter new report name",t.getName());if(e){var i=this.context.getQuery();i.setId(null),this.context.getBroker().newQuery({queryName:e,success:function(t){var e=n.context.getQuery().getId();n.executeQuery(),n.insertIntoReportList({id:e,name:i.getName()}),n.renderReportList({reportId:e}),n.setActiveReport(e),n.renderReportProps()},error:this.errorHandler.bind(this)})}},t.prototype.removeCurrentReport=function(){var e=this,t=this.context.getQuery();if(confirm("Remove report '"+t.getName()+"'?")){var n=t.getId();this.context.getBroker().removeQuery({queryId:n,success:function(){var t=e.removeFromReportList(n);e.renderReportList({reportIndex:t})}})}},t.prototype.executeQuery=function(t){var e=this;t=t||{page:1},this.context.getBroker().executeQuery({options:{page:t.page,resultFormat:1},beforeSend:function(){},success:function(t){t&&t.paging?(e.context.paging={enabled:t.paging.enabled,pageIndex:t.paging.pageIndex,pageCount:t.paging.pageCount,pageSelectedCallback:function(t){e.executeQuery({page:t})},maxButtonCount:e.pagingOptions?e.pagingOptions.maxButtonCount:null,cssClass:e.pagingOptions?e.pagingOptions.cssClass:null},e.displayRecordsCount(t.paging.totalRecords)):e.displayRecordsCount(e.context.resultSet?e.context.resultSet.getNumberOfRows():0),e.enableExport&&e.context.resultSet&&!e.context.resultSet.isEmpty()?e.enableExportButtons():e.disableExportButtons()},error:function(t,e,n){}})},t.prototype.syncReport=function(){if(this.useReportCache){var t=this.context.getQuery(),e=this.findReportById(t.getId());e&&(e.lastUpdated=Date.now(),this.saveReportContentInCache(e,t.toJSON()))}this.context.getBroker().syncQuery()},t.prototype.setActiveReport=function(e){var t=this.reportListPlaceholder.querySelectorAll("li");[].forEach.call(t,function(t){t.classList.remove("active"),t.getAttribute("data-rid")===e&&t.classList.add("active")})},t.prototype.renderReportProps=function(){var t=this.context.getQuery();this.findControlById("ReportTitle").innerHTML=t.getName();var e=document.querySelector(".columns-bar");if(e){e.innerHTML="<strong>Columns:</strong>";for(var n=0,i=t.getColumns();n<i.length;n++){var o=i[n];e.innerHTML+='<span class="label label-default">'+o.caption+"</span> "}}},t.prototype.renderReportList=function(t){if(this.renderReportPanels(),!this.reportListPlaceholder.matches("li")){this.reportListPlaceholder.innerHTML="",t=t||{reportId:0<this.reports.length?this.reports[0].id:null};var e=document.createElement("ul");e.className="list-group list-group-flush",this.reportListPlaceholder.appendChild(e);for(var n=0,i=this.reports;n<i.length;n++){var o=i[n];this.renderReportItemInList(o,e)}if(t.reportId&&this.loadReport(t.reportId),void 0!==t.reportIndex){var r=t.reportIndex;r>=this.reports.length&&(r=this.reports.length-1),r<0&&0<this.reports.length&&(r=0),0<=r&&this.loadReport(this.reports[r].id)}}},t.prototype.renderReportItemInList=function(t,e){e||(e=this.reportListPlaceholder.querySelector("ul"));var n=t.name||t.description||"",i=document.createElement("li");i.className="list-group-item",i.style.cursor="pointer",i.setAttribute("data-rid",t.id),i.innerText=n;var o=this;i.addEventListener("click",function(t){var e=t.target.getAttribute("data-rid");o.loadReport(e),o.setActiveReport(e)}),e.appendChild(i)},t.prototype.renderReportPanels=function(){var t=this.findControlById("ReportsContainer"),e=this.findControlById("NoReportPanel");0<this.reports.length?(e.style.visibility="hidden",t.style.visibility="visible"):(e.style.visibility="visible",t.style.visibility="hidden")},t.prototype.insertIntoReportList=function(t){this.reports.push(t)},t.prototype.removeFromReportList=function(t){var e=this.indexOfReportById(t);return 0<=e&&this.reports.splice(e,1),e},t.prototype.indexOfReportById=function(t){for(var e=0;e<this.reports.length;e++)if(this.reports[e].id===t)return e;return-1},t.prototype.clearReportButtonClick=function(){this.clearErrors(),this.context.clearQuery()},t.prototype.updateReportButtonClick=function(){this.executeQuery()},t.prototype.saveReportButtonClick=function(){this.saveCurrentReportAs()},t.prototype.loadReportButtonClick=function(){this.loadReport("LastQuery")},t.prototype.removeReportButtonClick=function(){this.removeCurrentReport()},t.prototype.newReportButtonClick=function(){this.newReport()},t.prototype.errorHandler=function(t){},t.prototype.clearErrors=function(){},t.prototype.disableExportButtons=function(){this.hideExportButtons()},t.prototype.enableExportButtons=function(){this.showExportButtons()},t.prototype.hideExportButtons=function(){this.exportButtonsContainer&&(this.exportButtonsContainer.style.display="none")},t.prototype.showExportButtons=function(){this.exportButtonsContainer&&(this.exportButtonsContainer.style.display="initial")},t.prototype.displayRecordsCount=function(t){this.resultCountSlot&&(this.resultCountSlot.style.display="inline",this.resultCountSlot.innerHTML=F.eqi18n.getText("MsgResultCount").replace("{0}",t.toString()))},t.prototype.getContext=function(){return this.context},t.prototype.saveReportContentInCache=function(t,e){var n=this.findReportCacheItem(t.id);n||(n={id:t.id},this.reportCache.push(n)),n.lastUpdated=t.lastUpdated,n.content=e},t.prototype.getReportContentFromCache=function(t){var e=this.findReportCacheItem(t.id);return e&&e.lastUpdated===t.lastUpdated?e.content:null},t.prototype.findReportById=function(t){for(var e=0,n=this.reports;e<n.length;e++){var i=n[e];if(i.id===t)return i}return null},t.prototype.findReportCacheItem=function(t){for(var e=0,n=this.reportCache;e<n.length;e++){var i=n[e];if(i.id===t)return i}return null},t}(),X=function(){function t(){this.draggableItem=null}return t.prototype.registerDraggableItem=function(n){var i=this,o=n.element;if(!o)throw Error("Element in draggle item is null or undefined");o.draggable=!0,o.addEventListener("dragstart",function(t){i.draggableItem={element:o,scope:n.scope,data:n.data},t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",null);var e={item:i.draggableItem,event:t};n.onDragStart&&n.onDragStart(e)},!1),o.addEventListener("dragend",function(t){var e={item:i.draggableItem,event:t};n.onDragEnd&&n.onDragEnd(e),i.draggableItem=null},!1)},t.prototype.registerDropContainer=function(n){var i=this,t=n.element;if(!t)throw Error("Element in drop container is null or undefined");var o={element:t,scopes:n.scopes,data:n.data};t.addEventListener("dragenter",function(t){t.preventDefault();var e={item:i.draggableItem,event:t};n.onDragEnter&&n.onDragEnter(o,e)},!1),t.addEventListener("dragover",function(t){t.preventDefault();var e={item:i.draggableItem,event:t};o.scopes.indexOf(e.item.scope)<0?t.dataTransfer.dropEffect="none":t.dataTransfer.dropEffect="move",n.onDragOver&&n.onDragOver(o,e)},!1),t.addEventListener("dragleave",function(t){t.preventDefault();var e={item:i.draggableItem,event:t};n.onDragLeave&&n.onDragLeave(o,e)},!1),t.addEventListener("drop",function(t){t.preventDefault();var e={item:i.draggableItem,event:t};n.onDrop&&n.onDrop(o,e),t.dataTransfer.clearData()},!1)},t}(),tt=new X,et=function(){function i(t,e){this.element=document.createElement(t),e&&e.appendChild(this.element)}return i.prototype.addChild=function(t,e){var n=new i(t,this.element);return e&&e(n),this},i.prototype.attr=function(t,e){return this.element.setAttribute(t,e),this},i.prototype.id=function(t){return this.attr("id",t)},i.prototype.data=function(t,e){return this.attr("data-"+t,e)},i.prototype.addClass=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0<this.element.className.length&&(this.element.className+=" "),this.element.className+=t.join(" "),this},i.prototype.on=function(t,e){return this.element.addEventListener(t,e),this},i.prototype.setStyle=function(t,e){return this.element.style.setProperty(t,e),this},i.prototype.text=function(t){return this.element.innerText+=t,this},i.prototype.html=function(t){return this.element.innerHTML+=t,this},i.prototype.toDOM=function(){return this.element},i}();function nt(t,e){return new et(t,e)}Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);var it,ot,rt,st,at,lt,ut,dt=n(8);Object(dt.a)(jQuery),function(_){function h(){return{top:_(window).scrollTop(),left:_(window).scrollLeft()}}function p(t,e){var n={x:0,y:0};if(null!==t){var i=_(t).offset();n={x:i.left,y:i.top}}return n}function m(){var t=_(window);return{width:t.innerWidth(),height:t.innerHeight()}}function a(t){this.parentMenu=t.menu||null,this.parentLevel=t.parent||null,this.parentElement=t.container||document.body,this.levelIndex=t.levelIndex||0,this.levelDiv=null,this.domWriteItemsId=t.domWriteItemsId||!1,this.menuId=t.menuId||"",this.itemRenderedCallback=t.itemRenderedCallback||null,this.applyItem=new Object,this.applyItem.itemDiv=null,this.items=t.items||[],this.activeItem=null,this.selectedItem=null,this.initialized=!1,this.updated=0,this.renderContent()}a.prototype={_turnCheckboxes:function(t){for(var e,n=t.length,i=0;i<n;i++)(e=t[i]).itemCheckbox&&(e.itemCheckbox.checked=this._isItemSelected(e)),e.items&&this._turnCheckboxes(e.items)},_isItemSelected:function(t){if(t.items){for(var e=0;e<t.items.length;e++)if(this._isItemSelected(t.items[e]))return!0;return!1}return t.selected},_setItemSelected:function(t,e){if(t.items)for(var n=0;n<t.items.length;n++)this._setItemSelected(t.items[n],e);else t.selected=e},showAt:function(t,e,n,i){if(this.items){this.initLevelDiv(),this._turnCheckboxes(this.items),this._renderItems();var o=this.levelDiv.style;i&&_(this.levelDiv).css("visibility","hidden"),o.display="block",o.left=t+"px",o.top=e+"px",this.scrollDiv.style.width="auto",this.scrollDiv.style.height="auto",n&&(e=this.adjustTopPos(e),o.top=e+"px");var r=this.parentMenu.minItemWidth;if(0<r&&this.scrollDiv.offsetWidth<r)for(var s=0;s<this.items.length;s++)this.items[s].itemDiv.style.width=r+"px";var a=this.parentMenu.maxItemWidth;if(0<a&&this.scrollDiv.offsetWidth>a)for(s=0;s<this.items.length;s++)this.items[s].itemDiv.style.width=a+"px",this.items[s].itemDiv.style.overflowX="hidden";var l=m().height-(e-h().top)-15;if(0<this.parentMenu.maxHeight&&l>this.parentMenu.maxHeight&&(l=this.parentMenu.maxHeight),null!=this.applyItem&&null!=this.applyItem.itemDiv&&(l-=this.applyItem.itemDiv.offsetHeight+5),null!=this.searchDiv&&(l-=this.searchDiv.offsetHeight),this.levelDiv.offsetHeight>l){var u=l;u<50&&(u=50),this.scrollDiv.style.height=u+"px"}else this.scrollDiv.style.height="auto";this.activeItem=null}},focus:function(){var t=this;window.setTimeout(function(){_(t.scrollDiv).focus(),null!=t.searchBox&&(t.parentMenu.options.searchBoxAutoFocus&&t.searchBox.focus(),t.searchBox.value="")},100)},hide:function(){null!==this.activeItem&&this.activeItem.subLevel&&this.activeItem.subLevel.hide(),this.levelDiv&&(this.levelDiv.style.display="none",this.initialized&&(this.parentElement.removeChild(this.levelDiv),this.initialized=!1))},adjustTopPos:function(t){var e=m(),n=t,i=t-h().top+this.levelDiv.offsetHeight;return i>e.height-5&&(n-=i-e.height+5)<h().top&&(n=h().top+10),n},initLevelDiv:function(){this.initialized||(this.parentElement.appendChild(this.levelDiv),_(this.levelDiv).addClass("eqjs-menu-levelDiv"),this.initialized=!0)},activateItem:function(t){null!=this.activeItem&&this.deactivateItem(this.activeItem);var e=(this.activeItem=t).itemDiv;if(_(e).addClass("active"),this.parentMenu.options.useDefaultStyles){this.parentMenu.style.colors.bgON,this.parentMenu.style.colors.fgON;var n=this.parentMenu.style.colors.bgOVER,i=this.parentMenu.style.colors.fgOVER||"",o=(this.parentMenu.style.itemClass,this.parentMenu.style.itemClassOver||"");e.style.color=""!=o?e.style.backgroundColor="":(e.style.backgroundColor=n,i)}t.items&&this.showSubLevel(t)},deactivateItem:function(t){var e=t.itemDiv;if(_(e).removeClass("active"),this.parentMenu.options.useDefaultStyles){var n=this.parentMenu.style.colors.bgON,i=this.parentMenu.style.colors.fgON,o=this.parentMenu.style.itemClass||"";e.style.color=""!=o?e.style.backgroundColor="":(e.style.backgroundColor=n,i)}t.subLevel&&t.subLevel.hide(),this.activeItem=null},_submitItems:function(t,e){for(var n=t.length,i=0;i<n;i++)t[i].items?this._submitItems(t[i].items,e):t[i].selected&&e.push(t[i])},submit:function(t){if(null!=t)if(t.items);else{this.parentMenu.hideMenu();var e=[];t==this.applyItem&&this._submitItems(this.items,e),this.parentMenu.submitMenu(t,e)}},showSubLevel:function(t){if(!t.subLevel){var e="";this.menuId&&(e=this.menuId+"-"+t.id),t.subLevel=new a({menu:this.parentMenu,parent:this,container:this.parentElement,items:t.items,levelIndex:this.levelIndex+1,domWriteItemsId:this.domWriteItemsId,menuId:e,itemRenderedCallback:this.itemRenderedCallback})}var n=p(t.itemDiv,this.parentElement),i=h(),o=m(),r=n.x-i.left,s=o.width-r-t.itemDiv.offsetWidth;n.x,n.x+=t.itemDiv.offsetParent.offsetWidth,n.y+=1,t.subLevel.showAt(n.x,n.y,!0,!0),t.subLevel.levelDiv.style.width="",t.subLevel.levelDiv.style.right="",s>=t.subLevel.levelDiv.offsetWidth||r<=s?s<t.subLevel.levelDiv.offsetWidth&&(t.subLevel.levelDiv.style.right=-i.left+"px"):(r<t.subLevel.levelDiv.offsetWidth?t.subLevel.levelDiv.style.left=i.left+4+"px":t.subLevel.levelDiv.style.left="",t.subLevel.levelDiv.style.right=_(window).width()-n.x+t.itemDiv.offsetWidth-6+"px"),_(t.subLevel.levelDiv).css("visibility","visible"),t.subLevel.focus()},refreshItems:function(){for(var t=this.items.length,e=0;e<t;e++){var n=this.items[e];n.itemDiv&&(n.hidden?n.itemDiv.style.display="none":n.itemDiv.style.display="block"),n.subLevel&&n.subLevel.refreshItems()}},refreshCheckboxes:function(){for(var t=this.items.length,e=0;e<t;e++){var n=this.items[e];n.itemCheckbox&&(n.itemCheckbox.checked=this._isItemSelected(n)),n.subLevel&&n.subLevel.refreshCheckboxes()}},renderContent:function(){if(this.items){var n=this,t=this.parentMenu.style.colors.bgON||"white",e=this.parentMenu.style.colors.fgON||"black",i=(this.parentMenu.style.colors.bgOVER,this.parentMenu.style.itemStyle.fontFamily||""),o=this.parentMenu.style.itemStyle.fontSize||"14px",r=this.parentMenu.options.multiselect,s=this.parentMenu.options.isSubQuery,a=document.createElement("div");this.parentMenu.options.useDefaultStyles&&(a.style.backgroundColor=t,a.style.border="1px solid",a.style.borderColor=this.parentMenu.style.colors.border,a.style.margin="-2px 2px 2px -2px",a.style.width="auto",a.style.height="auto"),a.style.zIndex=this.parentMenu.zIndex,a.style.position="absolute",a.style.display="none";var l=(a.menuLevel=this).parentMenu,u=this.applyItem;if(r&&0===this.levelIndex){var d=document.createElement("div");this.applyBtn=document.createElement("button"),_(d).addClass("eqjs-menu-applyDiv"),d.menuItem=u,this.parentMenu.options.useDefaultStyles&&(d.style.borderBottom="1px solid",d.style.padding="5px",d.style.marginBottom="5px",this.applyBtn.style.padding="0 5px",this.applyBtn.style.cursor="pointer");var c=document.createTextNode(this.parentMenu.options.buttons.submit);this.applyBtn.appendChild(c),d.appendChild(this.applyBtn);var h=document.createElement("button");_(h).addClass("eqjs-menu-cancel"),this.parentMenu.options.useDefaultStyles&&(h.style.padding="0 5px",h.style.cursor="pointer",h.style.marginLeft="15px");var p=document.createTextNode(this.parentMenu.options.buttons.cancel);h.appendChild(p),d.appendChild(h),a.appendChild(d),u.itemDiv=d,_(this.applyBtn).click(function(){n.submit(n.applyItem)}),_(h).click(function(){n.parentMenu.hideMenu()})}if(n.items.length>=l.options.showSearchBoxAfter){var m=document.createElement("div");_(m).addClass("eqjs-menu-searchDiv"),this.parentMenu.options.useDefaultStyles&&(m.style.borderBottom="1px solid #666",m.style.backgroundColor=t,m.style.borderColor=this.parentMenu.style.colors.border,""!=i&&(m.style.fontFamily=i),m.style.fontSize=o,m.style.color=e,m.style.cursor="pointer",m.style.textAlign="left",m.style.padding="5px");var f=document.createElement("input");f.name="searchBox",f.id="searchBox",_(f).addClass("eqjs-menu-searchBox"),s&&_(f).addClass("ui-dialog"),n.searchBox=f,n.searchDiv=m,f.type="text",f.size=16,this.parentMenu.options.useDefaultStyles&&(f.style.fontFamily="monospace",f.style.fontSize="8pt",f.style.width="100%"),m.appendChild(f),a.appendChild(m),_(f).on("input",function(){n._renderItems(_(this).val())})}var g=document.createElement("div");_(g).prop("tabindex",1),_(g).addClass("eqjs-menu-scrollDiv"),g.style.overflowX="hidden",g.style.overflowY="auto",g.style.position="relative",a.appendChild(g),this.levelDiv=a,this.scrollDiv=g,this.menuId&&_(this.levelDiv).attr("id",this.menuId),this._renderItems(),_(g).on("keydown",function(t){switch(t.which){case 13:n.parentMenu.options.multiselect?n.parentMenu._rootLevel.applyBtn.click():n.activeItem&&_(n.activeItem.itemDiv).click();break;case 32:n.activeItem&&_(n.activeItem.itemDiv).trigger("click",[!0]);break;case 37:n.parentLevel&&(n.deactivateItem(n.activeItem),n.parentLevel._focusScrollDiv());break;case 38:n.activeItem?0<(e=_.inArray(n.activeItem,n.items))&&n.activateItem(n.items[e-1]):n.activateItem(n.items[n.items.length-1]);break;case 39:n.activeItem&&n.activeItem.subLevel&&(n.activeItem.subLevel._focusScrollDiv(),n.activeItem.subLevel.activateItem(n.activeItem.subLevel.items[0]));break;case 40:var e;n.activeItem?(e=_.inArray(n.activeItem,n.items))<n.items.length-1&&n.activateItem(n.items[e+1]):n.activateItem(n.items[0]);break;default:return}t.preventDefault()})}},_allSubitemsAreFiltered:function(t,e){for(var n=t.length,i=0;i<n;i++)if(e(t[i]))return!1;return!0},_renderItems:function(t){var o=this,e=this.scrollDiv,r=this.parentMenu.options.multiselect,n=this.parentMenu.options.activateOnMouseOver,i=this.parentMenu.style.colors.fgON||"black",s=(this.parentMenu.style.colors.bgOVER,this.parentMenu.style.itemStyle.fontSize||"14px"),a=this.parentMenu._itemFilterCallback;_(e).empty();var l,u=t?new RegExp(t,"i"):null,d=this.items.length;for(l=0;l<d;l++){var c=this.items[l];if(c&&c.text){if(a){if(!a(c))continue;if(c.items&&o._allSubitemsAreFiltered(c.items,a))continue}if(!((u?c.text.search(u):0)<0)){c.data=function(t){return this[t]},void 0===c.selected&&(c.selected=!1),c.selected&&null==this.selectedItem&&(this.selectedItem=c);var h=document.createElement("div");if(_(h).addClass("eqjs-menu-itemDiv"),c.selected&&!r&&_(h).addClass("eqjs-menu-selected"),this.domWriteItemsId&&this.menuId&&_(h).attr("id","item-"+this.menuId+"-"+c.id),e.appendChild(h),(h.menuItem=c).itemDiv=h,this.parentMenu.options.useDefaultStyles&&(h.style.fontSize=s,h.style.color=i,h.style.paddingLeft="15px",h.style.paddingRight="6px",h.style.cursor="pointer"),"---"==c.text)h.appendChild(document.createElement("hr"));else{if(r){var p=document.createElement("input");p.type="checkbox",p.id="cb"+c.id,p.checked=this._isItemSelected(c),p.defaultChecked=this._isItemSelected(c),h.appendChild(p),c.itemCheckbox=p,this.parentMenu.options.useDefaultStyles&&(p.style.margin="4px 10px 0 0",p.style.verticalAlign="top")}else c.selected;var m=document.createTextNode(c.text);h.appendChild(m);var f=_(h);if(c.items&&0<c.items.length){f.addClass("eqjs-menu-itemDiv-hasChildren");var g=document.createElement("span");_(g).addClass("eqjs-menu-itemDiv-arrow"),h.appendChild(g);var y=document.createTextNode(">");g.appendChild(y)}var v=function(t,e){var n=this.menuItem;if(r)if(!n.items||t.target==n.itemCheckbox||e){var i=o._isItemSelected(n);o._setItemSelected(n,!i),n.itemCheckbox.checked=!i,o.parentMenu.refreshCheckboxes()}else o.activateItem(n);else o.activateItem(n),o.submit(n)};f.off("click",v),f.on("click",v),_(h).mouseenter(function(){var t=this.menuItem;o.parentMenu.isCursorInside=!0,n&&o.activateItem(t)}),_(h).mouseleave(function(){var t=this.menuItem;o.parentMenu.isCursorInside=!1,setTimeout(function(){o.parentMenu.isCursorInside||t==o.activeItem&&n&&!t.subLevel&&o.deactivateItem(t)},200)})}this.itemRenderedCallback&&this.itemRenderedCallback(this.menuId,_(h))}}}},remove:function(){for(var t=this.items.length,e=0;e<t;e++){var n=this.items[e];n.subLevel&&n.subLevel.remove()}if(this.levelDiv){this.levelDiv.innerHtml="";var i=this.levelDiv.parentNode;null!=i&&i.removeChild(this.levelDiv)}this.levelDiv=null},update:function(t){this.remove(),this.items=t,this.activeItem=null,this.selectedItem=null,this.applyItem.itemDiv=null,this.initialized=!1,this.updated++,this.renderContent()},findItem:function(t){for(var e=t.toLowerCase(),n=this.items.length,i=0;i<n;i++){var o=this.items[i];if(0==o.text.toLowerCase().indexOf(e))return o}return null}};var t=1;_.widget("eqjs.PopupMenu",{_mouseIsOverBlock:!1,_mouseIsOverLink:!1,_toId:null,_itemSelectedCallback:null,_menuClosedCallback:null,_itemFilterCallback:null,_rootLevel:null,options:{items:[],buttons:{submit:F.eqi18n.getText("ButtonApply"),cancel:F.eqi18n.getText("ButtonCancel")},itemFilterCallback:null,useDefaultStyles:!1,multiselect:!1,adjustHeight:!0,showSearchBoxAfter:30,activateOnMouseOver:!0,container:document.body,zIndex:1e5,domWriteItemsId:!1,itemRenderedCallback:null},_create:function(){this.menuId=t++,this._updateProps(),this._rootLevel=new a({menu:this,items:this.options.items,levelIndex:0,container:this.options.container,domWriteItemsId:this.options.domWriteItemsId,menuId:this.options.id,itemRenderedCallback:this.options.itemRenderedCallback}),_(this._rootLevel.levelDiv).addClass("eqjs-menu-rootLevel"),_(this._rootLevel.levelDiv).css("z-index",this.options.zIndex);var i=this;this._menuKeyUpHandler=function(t){27==t.which&&(i.hideMenu(),t.stopImmediatePropagation())},this._globalMouseDownHandler=function(){if(!i.active)return!0;for(var t=window.event||arguments[0],e=t.srcElement||t.target,n=!0;e;){if(e.tagName&&"div"==e.tagName.toLowerCase()&&e.menuLevel&&e.menuLevel.parentMenu==i){n=!1;break}e=e.parentNode||e.parentElement}return n&&i.hideMenu(),!0},this._render()},_clearItemMenuProps:function(t){t.subLevel&&t.subLevel.parentMenu==this||(t.subLevel&&(t.subLevel.remove(),t.subLevel=null),t.itemDiv&&(t.itemDiv=null),t.items&&this._clearItemsMenuProps(t.items))},_clearItemsMenuProps:function(t){if(t)for(var e=0;e<t.length;e++)this._clearItemMenuProps(t[e])},_render:function(){},_updateProps:function(){this.style={},this.style.colors={border:"#666666",shadow:"#888888",bgON:"white",fgON:"black",bgOVER:"#B6BDD2",fgOVER:"black"},this.style.itemStyle={fontSize:"14px"},this.minItemWidth=0,this.maxItemWidth=0,this.maxHeight=0,this.zIndex=this.options.zIndex,this.commandTemplate="",this.parentElement=null,this.args=[],this.active=!1},_setOption:function(t,e){return 2==arguments.length?(this.options[t]=e,this):this.options[t]},_setSelectedItems:function(t,e){for(var n,i=t?t.length:0,o=0;o<i;o++)(n=t[o]).items?this._setSelectedItems(n.items,e):n.selected=0<=_.inArray(n.id,e)},showMenu:function(t){var e=this;this._clearItemsMenuProps(this.options.items),e._itemSelectedCallback=t.itemSelectedCallback||null,e._menuClosedCallback=t.menuClosedCallback||null,e._itemFilterCallback=t.itemFilterCallback||null,t.items&&(this.options.items=t.items,this._rootLevel.items=t.items),t.onMenuItemSelected&&(this.options.onMenuItemSelected=t.onMenuItemSelected);var n=t.selectedIds||null;n?"string"==typeof n&&(n=n.split(",")):n=[],this.active=!0,this._setSelectedItems(e.options.items,n);var i=_(t.anchor||document.documentElement),o=p(i.get(0),this.options.container),r=i.outerHeight(!1),s=i.outerWidth(!1),a={x:o.x,y:o.y+r+2},l=h(),u=m(),d=a.x+s-l.left,c=u.width-d+s;a.x,a.x+=2,e._rootLevel.showAt(a.x,a.y,!0,!0),e._rootLevel.levelDiv.style.width="",e._rootLevel.levelDiv.style.right="",c>=e._rootLevel.levelDiv.offsetWidth||d<=c?c<e._rootLevel.levelDiv.offsetWidth&&(e._rootLevel.levelDiv.style.right=-l.left+"px"):(d<e._rootLevel.levelDiv.offsetWidth?e._rootLevel.levelDiv.style.left=l.left+4+"px":e._rootLevel.levelDiv.style.left="",e._rootLevel.levelDiv.style.right=_(window).width()-a.x-s+"px"),_(e._rootLevel.levelDiv).css("visibility","visible"),e._rootLevel.focus(),_(document).on("keyup",this._menuKeyUpHandler),_(document).on("mousedown",this._globalMouseDownHandler)},hideMenu:function(){_(document).off("mousedown",this._globalMouseDownHandler),_(document).off("keyup",this._menuKeyUpHandler),this._rootLevel.hide(),this._menuClosedCallback&&this._menuClosedCallback.call()},submitMenu:function(t,e){var n={widget:this,menuItem:t,selectedItems:e};this._itemSelectedCallback?this._itemSelectedCallback.apply(this,[null,n]):this._trigger("onMenuItemSelected",null,n)},knockMenuStyle:function(t){t.removeAttr("style");var e=t.find("ul").first().prop("style");"undefined"!==e&&!1!==e&&t.find("ul").first().prop("style","")},refreshItems:function(){this._rootLevel.refreshItems()},refreshCheckboxes:function(){this._rootLevel.refreshCheckboxes()}})}(jQuery),(it=jQuery).widget("eqjs.ValueEditor",{_expr:{value:"",text:""},_linkElement:null,options:{model:null,parentWidget:null,editor:null,onChange:null,emptyText:null},getModel:function(){return this.options.parentWidget?this.options.parentWidget.getModel():null},getQuery:function(){return this.options.parentWidget?this.options.parentWidget.getQuery():null},getContext:function(){return this.options.parentWidget?this.options.parentWidget.getContext():null},getCondition:function(){return this.options.parentWidget&&this.options.parentWidget.getCondition?this.options.parentWidget.getCondition():null},getQueryPanel:function(){return this.options.parentWidget&&this.options.parentWidget.getQueryPanel?this.options.parentWidget.getQueryPanel():null},init:function(t){this._expr=t,this._adjustValueExpr(),this._adjustExprText(),this.refresh()},getResText:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return F.eqi18n.getText.apply(this.getQueryPanel(),t)},_getEmptyText:function(){return this.options.emptyText||this.getResText("MsgEmptyScalarValue")},_render:function(){if(this.clear(),this.getModel()&&this._expr){this._renderCommonPart(),this._renderEditor();var t=this.getQueryPanel();t&&t.options&&t.options.spreadValueElement&&(this._linkElement.css("width","100%"),this._linkElement.css("max-width","100%"));var e=this._getDisplayText();this._linkElement.text(e),this._linkElement.attr("title",e)}},_getClassesToAdd:function(){return"eqjs-qp-condelement eqjs-qp-valueelement"},_renderCommonPart:function(){var t=this;t.element.addClass(t._getClassesToAdd());var e=this.getCondition();!e||!1!==e.enabled&&!e.readOnly?(t._linkElement=it("<a></a>",{href:"javascript:void(0)",text:"-"}).appendTo(t.element),t._linkElement.click(function(){return t.showEditor(),!1})):t._linkElement=it("<span></span>",{text:"-"}).appendTo(t.element)},showEditor:function(){this._beforeShowEditor()&&(this._showEditor(),this.options.parentWidget&&this.options.parentWidget.makeActive())},_renderEditor:function(){},refresh:function(){this._render()},_beforeShowEditor:function(){return!0},_showEditor:function(){},_setOption:function(t,e){return 2==arguments.length?(this.options[t]=e,this._render(),this):this.options[t]},clear:function(){this._linkElement&&this._linkElement.unbind(),this.element.removeClass(),this.element.empty()},_setValueSilent:function(t){var e=this._getValue(),n=this._adjustNewValue(t),i=n!=e?this._validate(n):{result:!0};if(i&&i.result){this._expr.value=n,this._expr.text=t,this._adjustExprText();var o=this._getDisplayText();return this._linkElement.text(o),this._linkElement.html(this._linkElement.html().replace(/ /g,"&nbsp")),this._linkElement.attr("title",o),!0}return this._validationError(i),!1},_setValue:function(t){var e=this._setValueSilent(t);return e&&this.options.onChange&&this.options.onChange(this._expr.value),e},_validate:function(t){return{result:!0,message:""}},_validationError:function(t){this.getContext().throwError({action:"ui.validation",text:t.message})},_getValue:function(){return this._expr.value},_getText:function(){return this._expr.text},_isEmptyValue:function(){var t=this._getValue();return null==t||!t},_adjustValueExpr:function(){var t=this._expr;t.value&&(t.value=this._adjustNewValue(t.value)),t.tag==F.ExprTag.EntityAttribute&&(t.kind=F.DataKind.Attribute,t.value=this._expr.id)},_adjustExprText:function(){var t=this._expr.value;t&&!F.equtils.isObject(t)&&""!=t?this._expr.text=t:this._expr.text=""},_adjustNewValue:function(t){return t},_getDisplayText:function(){return this._adjustExprText(),this._expr.text&&""!=this._expr.text?this._expr.text:this._expr.value&&""!=this._expr.value?this._expr.value:this._getEmptyText()}}),it.widget("eqjs.ValueEditor_EDIT",it.eqjs.ValueEditor,{_numberDecimalSeparatorValue:".",_numberListSeparatorValue:",",_numberDecimalSeparatorDisplay:".",_numberListSeparators:[",",";"],_editBox:null,_editBoxClass:"eqjs-qp-ve-editbox",_create:function(){var t=this.getQueryPanel();t&&(t.options.numberDecimalSeparatorDisplay&&(this._numberDecimalSeparatorDisplay=t.options.numberDecimalSeparatorDisplay||F.eqi18n.getLocaleSetting("decimalSeparator")),t.options.numberListSeparators&&(this._numberListSeparators=t.options.numberListSeparators))},_adjustNewValue:function(t){if(0<t.length&&"List"==this._expr.kind){for(var e=new RegExp("\\s*["+this._numberListSeparators.join("")+"]\\s*","i"),n=t.split(e),i=n.length,o=0;o<i;o++)n[o]=this._adjustScalarValue(n[o]);return n.join(this._numberListSeparatorValue)}return this._adjustScalarValue(t)},_adjustScalarValue:function(t){return t.split(this._numberDecimalSeparatorDisplay).join(this._numberDecimalSeparatorValue)},_renderEditor:function(){var e=this;e.dontProcessBlur=!1,e._editBox=it("<input />",{type:"text",class:e._editBoxClass,blur:function(t){if(e._editBox.is(":visible")&&!e.dontProcessBlur)return e._setValue(e._editBox.val())?(e._editBox.hide(),e._linkElement.show()):(e.dontProcessBlur=!0,e._editBox.focus(),setTimeout(function(){e.dontProcessBlur=!1},200)),t.stopPropagation(),!1},keydown:function(t){return 13==t.keyCode&&e._editBox.is(":visible")?(e.dontProcessBlur=!0,e._setValue(e._editBox.val())?(e._editBox.hide(),e._linkElement.show(),e.dontProcessBlur=!1):(e._editBox.focus(),setTimeout(function(){e.dontProcessBlur=!1},200)),t.stopPropagation(),!1):27==t.keyCode?(e._editBox.hide(),e._linkElement.show(),t.stopPropagation(),!1):void 0}}).appendTo(this.element).hide()},_checkScalarValue:function(t){var e=+t,n=this._expr;return isNaN(e)||F.equtils.isNumericType(n.dataType)&&it.trim(t)!=t?{result:!1,message:'"'+t+'"'+this.getResText("ErrNotNumber")}:F.equtils.isIntType(n.dataType)&&e!=parseInt(t,10)?{result:!1,message:t+" - "+this.getResText("ErrIncorrectInteger")}:{result:!0,message:""}},_validate:function(t){var e,n=this._expr;if(F.equtils.isNumericType(n.dataType)){if(0<t.length&&n.kind===F.DataKind.List){for(var i=t.split(/\s*,\s*/),o=i.length,r=0;r<o;r++)if(!(e=this._checkScalarValue(i[r]))||!e.result)return{result:!1,message:this.getResText("ErrIncorrectNumberList")};return{result:!0}}return this._checkScalarValue(t)}return{result:!0}},_getZIndex:function(){var t=this.getQueryPanel();return t&&t.options.isSubQuery?t.options.dialogZIndex+1e3:1e5},_showEditor:function(){var t=this.element.width();this._linkElement.hide(),this._editBox.val(this._getText()).css("min-width",t).show().focus()}}),it.widget("eqjs.ValueEditor_DATETIME",it.eqjs.ValueEditor_EDIT,{_dateFormatInternal:"yy-mm-dd",_dateFormatValue:"mm/dd/yy",_dateFormatDisplay:"d mm, yy",_dateValue:"",_timeFormatInternal:"HH:mm",_timeFormatValue:"HH:mm",_timeFormatDisplay:"HH:mm",_yearRange:"c-10:c+10",_create:function(){var t=this.getQueryPanel(),e=t?t.options:{};this._dateFormatValue=this.options.dateFormatValue||e.dateFormatValue||this._dateFormatValue,this._dateFormatDisplay=this.options.dateFormatDisplay||e.dateFormatDisplay||F.eqi18n.getLocaleSetting("dateFormat"),this._timeFormatValue=this.options.timeFormatValue||e.timeFormatValue||this._timeFormatValue,this._timeFormatDisplay=this.options.timeFormatDisplay||e.timeFormatDisplay||this._timeFormatDisplay,this._yearRange=this.options.yearRange||e.yearRange||this._yearRange,it.datepicker.setDefaults(it.datepicker.regional[F.eqi18n.getCurrentLocale()]),it.timepicker.setDefaults(it.timepicker.regional[F.eqi18n.getCurrentLocale()])},_renderEditor:function(){var c=this;c._editBox=it("<input />",{type:"text",class:"eqjs-qp-ve-editbox"}).appendTo(c.element).hide(),c._editBox.on("keydown",function(t){27==t.keyCode&&c._editBox.val(c.lastValue)}),c._expr.dataType===F.DataType.Time?(c._editBox.timepicker({onClose:function(t,e){if(""!=t){c.getModel();var n=c._editBox.datepicker("getDate"),i=c._convertTime(n,c._timeFormatInternal);t!=c.lastValue&&c._setValue(i),c._editBox.hide()}else c._editBox.hide(),c._editBox.timepicker("hide")}}),c._timeFormatValue?c._editBox.timepicker("option","timeFormat",c._timeFormatValue):c._timeFormatValue=c._editBox.datepicker("option","timeFormat")):c._expr.dataType===F.DataType.Date?(this.getModel(),c._editBox.datepicker({changeMonth:!0,changeYear:!0,beforeShow:function(){c._editBox.show()},onClose:function(t,e){if(""!=t){c.getModel();var n=c._editBox.datepicker("getDate"),i=c._convertDate(n,c._dateFormatInternal);t!=c.lastValue&&c._setValue(i),c._editBox.hide()}else c._editBox.hide(),c._editBox.datepicker("hide")}}),c._dateFormatValue?c._editBox.datepicker("option","dateFormat",c._dateFormatValue):c._dateFormatValue=c._editBox.datepicker("option","dateFormat"),c._yearRange?c._editBox.datepicker("option","yearRange",c._yearRange):c._yearRange=c._editBox.datepicker("option","yearRange")):c._expr.dataType===F.DataType.DateTime&&(c._editBox.datetimepicker({changeMonth:!0,changeYear:!0,beforeShow:function(){c._editBox.show()},onClose:function(t,e){if(""!=t){var n,i=c.lastValue.split(" "),o="";n=i[0],1<i.length&&(o=i[1]);var r=c._editBox.datepicker("getDate"),s=c._convertDate(r,c._dateFormatInternal),a=c._convertTime(r,c._timeFormatInternal),l="",u="",d=c._expr.value.split(" ");l=s!=c._convertDateString(n,c._dateFormatValue,c._dateFormatInternal)?s:d[0],a!=c._convertTimeString(o,c._timeFormatValue,c._timeFormatInternal)?u=a:1<d.length&&(u=d[1]),t!=c.lastValue&&c._setValue(it.trim(l+" "+u)),c._editBox.hide()}else c._editBox.hide(),c._editBox.datepicker("hide")}}),c._dateFormatValue?c._editBox.datepicker("option","dateFormat",c._dateFormatValue):c._dateFormatValue=c._editBox.datepicker("option","dateFormat"),c._yearRange?c._editBox.datepicker("option","yearRange",c._yearRange):c._yearRange=c._editBox.datepicker("option","yearRange"),c._timeFormatValue?c._editBox.timepicker("option","timeFormat",c._timeFormatValue):c._timeFormatValue=c._editBox.datepicker("option","timeFormat"))},_showEditor:function(){var t=this,e=this.getModel();if(t._expr.dataType===F.DataType.Time){var n=this._expr.value;(r=e.getTimeMacroValue(n))&&(n=this._convertTime(r,this._timeFormatInternal)),t._editBox.val(this._convertTimeString(n,this._timeFormatInternal,this._timeFormatValue))}else if(t._expr.dataType===F.DataType.Date){var i=this._expr.value;(o=e.getDateMacroValue(i))&&(i=this._convertDate(o,this._dateFormatInternal)),t._editBox.val(this._convertDateString(i,this._dateFormatInternal,this._dateFormatValue))}else if(t._expr.dataType===F.DataType.DateTime){var o,r,s=this._expr.value.split(" ");this._expr.value,n=i="",i=s[0],1<s.length&&(n=s[1]),(o=e.getDateMacroValue(i))&&(i=this._convertDate(o,this._dateFormatInternal)),(r=e.getTimeMacroValue(n))&&(n=this._convertTime(r,this._timeFormatInternal)),t._editBox.val(this._convertDateString(i,this._dateFormatInternal,this._dateFormatValue)+" "+this._convertTimeString(n,this._timeFormatInternal,this._timeFormatValue))}t.lastValue=t._editBox.val();var a=this.getQueryPanel(),l=a&&a.options.isSubQuery?a.options.dialogZIndex+1e3:1e5,u=t._linkElement.position().left,d=t._linkElement.position().top;t._editBox.css({left:u,top:d,width:t._expr.dataType===F.DataType.DateTime?"150px":"115px","min-width":t._linkElement.width(),position:"absolute",zIndex:l}).show().focus()},_adjustNewValue:function(t){var e=this.getModel();if(this._expr.dataType===F.DataType.Date)return e&&e.isDateMacro(t)?t:this._convertDateValueString(t,this._dateFormatInternal,this._dateFormatInternal);if(this._expr.dataType!==F.DataType.DateTime)return this._expr.dataType===F.DataType.Time?e&&e.isTimeMacro(t)?t:this._convertTimeValueString(t,this._timeFormatInternal,this._timeFormatInternal):void 0;var n=t.split(" "),i="",o="";return i=n[0],1<n.length&&(o=n[1]),e&&!e.isDateMacro(i)&&(i=this._convertDateValueString(i,this._dateFormatInternal,this._dateFormatInternal)),""==o?it.trim(i):(e&&!e.isTimeMacro(o)&&(o=this._convertTimeValueString(o,this._timeFormatInternal,this._timeFormatInternal)),it.trim(i+" "+o))},_adjustExprText:function(){try{if(this._expr.value&&""!=this._expr.value)if(this._expr.dataType===F.DataType.Date)this._expr.text=this._convertDateValueString(this._expr.value,this._dateFormatInternal,this._dateFormatDisplay);else if(this._expr.dataType===F.DataType.DateTime){var t=this._expr.value.split(" "),e=this._expr.value,n="";1<t.length&&(e=t[0],n=t[1]);try{e=this._convertDateValueString(e,this._dateFormatInternal,this._dateFormatDisplay)}catch(t){e=""}try{n=this._convertTimeValueString(n,this._timeFormatInternal,this._timeFormatDisplay)}catch(t){n=""}this._expr.text=""==e||""==n?e+n:e+" "+n}else this._expr.dataType===F.DataType.Time&&(this._expr.text=this._convertTimeValueString(this._expr.value,this._timeFormatInternal,this._timeFormatDisplay));else this._expr.text=""}catch(t){this._expr.text=""}},_validate:function(t){return{result:!0,message:""}},_convertDateValueString:function(t,e,n){var i=this.getModel();if(i&&i.isDateMacro(t)){var o=t.substring(2,t.length-1);return this.getResText(o)||"${Today}"}return this._convertDateString(t,e,n)||"${Today}"},_convertDateString:function(t,e,n){try{var i=it.datepicker.parseDate(e,t);return this._convertDate(i,n)}catch(t){return""}},_convertDate:function(t,e){return it.datepicker.formatDate(e,t)},_convertTime:function(t,e){var n={hour:t.getHours(),minute:t.getMinutes(),second:t.getSeconds(),millisec:t.getMilliseconds(),microsec:t.getMicroseconds(),timezone:-1*t.getTimezoneOffset()};return it.datepicker.formatTime(e,n)},_convertTimeValueString:function(t,e,n){var i=this.getModel();if(i&&0<=it.inArray(t,i.timeMacroList)){var o=t.substring(2,t.length-1);return this.getResText(o)||""}return this._convertTimeString(t,e,n)||""},_convertTimeString:function(t,e,n){try{var i=it.datepicker.parseTime(e,t);return i?it.datepicker.formatTime(n,i):""}catch(t){return""}}}),it.widget("eqjs.ValueEditor_LIST",it.eqjs.ValueEditor,{_menuBlock:null,_menuItemsList:null,_emptyListText:"<empty list>",_showWhenReady:!1,_getEmptyText:function(){return this._menuItemsList&&0<this._menuItemsList.length?this.options.emptyText||this.getResText("MsgEmptyListValue"):this.options.emptyText||this._emptyListText},_getListName:function(){return this.options.editor.name},_renderEditor:function(){this._fillMenuItemsList(),this._renderMenuBlock()},_renderMenuBlock:function(){var r=this,s=!1;this._expr&&(s=this._expr.kind===F.DataKind.List);var t=this.getQueryPanel(),e={items:r._menuItemsList,multiselect:s,container:t?t.options.menuContainer:null,onMenuItemSelected:function(t,e){if(s){if(e.selectedItems){for(var n=[],i=e.selectedItems.length,o=0;o<i;o++)n.push(e.selectedItems[o].id);r._setValue(n)}}else r._setValue(e.menuItem.id);return!1}};t&&it.extend(e,t.options.menuOptions),t&&t.options.isSubQuery&&(e.zIndex=t.options.dialogZIndex+1e3);var n=r.options.parentWidget.element.attr("id");n&&(e.id=n+"-EditorMenu"),t&&(e.domWriteItemsId=t.options.domWriteItemsId),e.buttons={submit:F.eqi18n.getText("ButtonApply"),cancel:F.eqi18n.getText("ButtonCancel")},r._menuBlock=it("<div></div>").hide().appendTo(r.element).PopupMenu(e)},_beforeShowEditor:function(){var t=this._getListName();return!t||!t.match(/{{.+?}}/)||(this._showWhenReady=!0,this._renderEditor(),!1)},_showEditor:function(){this._menuBlock?this._menuBlock.PopupMenu("showMenu",{anchor:this._linkElement,selectedIds:this._getValueAsArray()}):this._showWhenReady=!0},_getValueAsArray:function(){if(this._expr.kind!==F.DataKind.List)return[this._expr.value];var t=this._expr.value.match(/"[^"\\]*(?:\\.[^"\\]*)*"|[^,]+/g);return t?it.map(t,function(t){return'"'==t.charAt(0)&&'"'==t.charAt(t.length-1)?(t=t.substring(1,t.length-1)).replace(/\"/g,'"'):t}):[]},_adjustNewValue:function(t){return it.isArray(t)?it.map(t,function(t){return 0<=t.indexOf(",")?'"'+(t=t.replace(/"/g,'"'))+'"':t}).join(","):t},_adjustExprText:function(){var i,o=[];if(this._expr.value&&this._menuItemsList){i=this._getValueAsArray(),this._expr.text="",i.length;var r=function(t){for(var e,n=0;n<t.length;n++)(e=t[n]).items?r(e.items):0<it.grep(i,function(t){return e.id==t}).length&&o.push(e.text)};r(this._menuItemsList),this._expr.text=o.join(",")}else this._expr.text=""},_takeFirstItemInList:function(){this._menuItemsList&&0<this._menuItemsList.length&&this._setValueSilent(this._menuItemsList[0].id)},_takeDefaultValue:function(){if(this._menuItemsList)for(var t=this._menuItemsList.length,e=0;e<t;e++){var n=this._menuItemsList[e];if(n.isDefault){this._setValueSilent(n.id);break}}},_fillMenuItemsList:function(){this._menuItemsList=this.options.editor.values}}),it.widget("eqjs.ValueEditor_CUSTOMLIST",it.eqjs.ValueEditor_LIST,{_loaderElement:null,_renderEditor:function(){var e=this;this._linkElement.hide(),this._loaderElement||(this._loaderElement=it("<div></div>",{class:"eqjs-qp-ve-loader"}).appendTo(e.element)),this._loaderElement.show(),this._loading||(this._loading=!0,this._fillMenuItemsList(function(){e._loading=!1;var t=e._getDisplayText();e._linkElement.text(t),e._linkElement.attr("title",t),e._loaderElement.hide(),e._linkElement.show(),e._renderMenuBlock(),e._isEmptyValue()&&e._takeDefaultValue(),e._showWhenReady&&(e._showWhenReady=!1,e._showEditor())}))},_fillMenuItemsList:function(e){var n=this,t=this.options.editor,i=this._getListName(),o=this.getContext().getListRequestHandler(),r=this.getQueryPanel();F.eqconsts.constLists[i]?(n._menuItemsList=F.eqconsts.constLists[i],e&&e()):"EntityTree"===i?(n._menuItemsList=r.options.entitiesList,e&&e()):o&&o({listName:i,editorId:t.id,value:n._getValue()},function(t){n._menuItemsList=t,e&&e()})}}),it.widget("eqjs.ValueEditor_SQLLIST",it.eqjs.ValueEditor_CUSTOMLIST,{_fillMenuItemsList:function(e){var n=this,t=this.getContext(),i=this.options.editor,o=t.getListRequestHandler();o&&o({listName:"SQL",editorId:i.id,value:n._getValue()},function(t){n._menuItemsList=t,e&&e()})}}),it.widget("eqjs.ValueEditor_SUBQUERY",it.eqjs.ValueEditor,{_dialogBlock:null,_queryPanelBlock:null,_columnElement:null,_colEntitiesList:null,_getEmptyText:function(){return this.getResText("MsgSubQueryValue")},_renderEditor:function(){var n=this;this._dialogBlock=it("<div></div>",{class:"eqjs-qp-ve-subquery"}).hide().appendTo(n.element);var t=this.getQueryPanel(),e=this.getModel(),i=this._expr.dataType;this._colEntitiesList=e.getEntitiesTreeWithFilter(function(t){return!(!t.attributes||!t.useInConditions)||t.usedInCondition&&t.dataType===i});var o=it("<div></div>").hide().appendTo(n._dialogBlock),r=n.options.parentWidget.element.attr("id");r&&(r+="-SubColumnMenu");var s=it.extend({id:r,items:n._colEntitiesList,zIndex:t.options.dialogZIndex+1e3,domWriteItemsId:t.options.domWriteItemsId,isSubQuery:!0},t.options.menuOptions);o.PopupMenu(s);var a=it("<div></div>").addClass("eqjs-qp-ve-subquery-column").appendTo(n._dialogBlock),l=(it("<div></div>").addClass("eqjs-qp-ve-subquery-column-title").text(n.getResText("SubQueryColumnTitle")).appendTo(a),it("<div></div>").addClass("eqjs-qp-ve-subquery-column-element").appendTo(a));n._columnElement=it("<a></a>").attr("href","javascript:void(0)").appendTo(l),n._columnElement.click(function(t){o.PopupMenu("showMenu",{anchor:n._columnElement,selectedIds:null,itemSelectedCallback:function(t,e){return n._columnElementMenuClick(t,e)}})}),it("<div></div>").addClass("eqjs-qp-ve-subquery-qp-caption").text(n.getResText("SubQueryQueryPanelCaption")).appendTo(n._dialogBlock),n._queryPanelBlock=it('<div class="eqjs-qp-ve-subquery-qp"></div>').appendTo(n._dialogBlock);var u=n.options.parentWidget.element.attr("id");u&&n._queryPanelBlock.attr("id",u+"-SubQueryPanel"),n._dialogBlock.dialog({autoOpen:!1,draggable:!1,resizable:!1,title:n.getResText("SubQueryDialogTitle"),dialogClass:"eq-js-dialog",closeText:"X",modal:!0,width:t.options.subQueryDialogWidth,minHeight:t.options.subQueryDialogHeight,zIndex:t.options.dialogZIndex,buttons:[{name:"eqjs-subquery-button-ok",text:n.getResText("ButtonOK"),click:function(){it(this).dialog("close"),n.getQuery().fireChangedEvent({author:n.getQueryPanel(),changeType:"condition.changed",condition:n.getCondition(),what:"value"})}},{name:"eqjs-subquery-button-cancel",text:n.getResText("ButtonCancel"),click:function(){it(this).dialog("close")}}],open:function(){it(".ui-widget-overlay").addClass("eq-js-dialog-overlay"),it("body").css("overflow","hidden")},beforeClose:function(){it(".ui-widget-overlay").removeClass("eq-js-dialog-overlay"),it("body").css("overflow","auto")},close:function(t,e){n._queryPanelBlock.QueryPanel("destroy")}})},_columnElementMenuClick:function(t,e){var n=e.menuItem.data("id");return this._setResultAttributeId(n),!1},_setResultAttributeId:function(t){var e=this.getModel().getAttributeById(t);if(e){var n=this.getSubQuery().getColumns(),i=void 0;if(0<n.length)(i=n[0]).expr.id=t,i.expr.dataType=e.dataType;else{(i=new F.Column).sorting=F.SortDirection.None,i.sortIndex=-1;var o=new F.Expression;o.id=t,o.tag=F.ExprTag.EntityAttribute,o.kind=F.DataKind.Attribute,o.dataType=e.dataType,i.expr=o,n.push(i)}var r=this.getQuery(),s=this.getQueryPanel();r.fireChangedEvent({author:s,changeType:"subQuery.column.change",column:i}),this._columnElement.text(this._getAttributeText(e)),this._okButtonEnable(!0)}},_getAttributeText:function(t){if(!t)return this.getResText("SubQueryEmptyColumn");var e=F.eqi18n.getText("Attributes",t.id);e||(e=t.caption);var n=this.getQueryPanel().options.attrElementFormat;if(!n)return e;var i=n.replace(new RegExp("{attr}","g"),e),o=this.getModel().getFullEntityPathByAttr(t.id,".");return i=i.replace(new RegExp("{entity}","g"),o)},_showEditor:function(){var n=this.getQuery(),i=this.getQueryPanel();this._queryPanelBlock.empty();var t=this._expr.query;t||(t=new F.Query(n.getModel()),this._expr.query=t),t.addChangedCallback(function(t){var e=it.extend({},t.data);e.author=i,e.changeType="subQuery."+e.changeType,n.fireChangedEvent(e)});var e=it.extend({},i.options);e.isSubQuery=!0,e.showAddRow=!0,e.menuContainer=document.body,e.menuOptions.isSubQuery=!0,e.entitiesListFilter=function(t,e){if(i.options.entitiesListFilter){var n=e||{};n.isSubQuery=!0,i.options.entitiesListFilter(t,n)}},this._queryPanelBlock.QueryPanel(e),this._queryPanelBlock.QueryPanel("setContext",this.getContext()),this._queryPanelBlock.QueryPanel("setQuery",t);var o=null,r=t.getColumns();if(0==r.length){var s=this.getCondition();if(0<s.expressions.length){var a=s.expressions[0];o=a.tag==F.ExprTag.EntityAttribute||a.kind==F.DataKind.Attribute?a.id:null}}else o=r[0].expr.id;o?this._setResultAttributeId(o):this._columnElement.text(this.getResText("SubQueryEmptyColumn")),this._dialogBlock.dialog("open")},getSubQuery:function(){return this._queryPanelBlock.QueryPanel("getQuery")},_okButtonEnable:function(t){var e=this._dialogBlock.next(".ui-dialog-buttonpane").find("[name='eqjs-subquery-button-ok']");e&&(t?e.button("enable"):e.button("disable"))},_getDisplayText:function(){return this._getEmptyText()}}),it.widget("eqjs.PredicateLinkType",it.eqjs.ValueEditor_LIST,{_predicate:null,options:{queryPanel:null},getCondition:function(){return this._predicate},init:function(t){this._predicate=t,this.refresh()},_render:function(){this.clear(),this._predicate&&(this._renderCommonPart(),!1===this._predicate.enabled||this._predicate.readOnly||this._renderEditor(),this._linkElement.text(this._getDisplayText()))},_showEditor:function(){this._menuBlock.PopupMenu("showMenu",{anchor:this._linkElement})},_fillMenuItemsList:function(){this._menuItemsList=F.eqconsts.predicateLinkTypeList},_setValue:function(t){return this._predicate.linkType=F.equtils.strToLinkType(t),this._linkElement.text(this._getDisplayText()),this.options.onChange&&this.options.onChange(t),!0},_beforeShowEditor:function(){return!0},_getClassesToAdd:function(){return"eqjs-qp-predelement eqjs-qp-predvalueelement"},_getDisplayText:function(){var t=this,e=this._getEmptyText();return void 0!==this._predicate.linkType&&it.each(F.eqconsts.predicateLinkTypeList,function(){this.id===F.equtils.linkTypeToStr(t._predicate.linkType)&&(e=this.text)}),e}}),jQuery.widget("eqjs.TimePicker",{options:{internalFormat:"hh:mm",onChange:function(){},setValue:function(t){}},_convertToInternalFormat:function(t){return t},_raiseOnChange:function(){this.options&&this.options.onChange&&this.options.onChange(this.time())},_create:function(){var o=this;this.element.attr("maxLength",5),this.time(""),this.element.bind({focus:function(){},change:function(){},blur:function(){},keypress:function(t){var e=t.charCode||t.which,n=String.fromCharCode(e),i=o.element.val().replace("_",n);o._isValidValue(i)&&o.element.val(i),t.preventDefault()},keydown:function(t){if(8==t.which||46==t.which){var e=o.element.val(),n=e.indexOf("_");n<0&&(n=e.length),0<n&&(n--,":"==e.charAt(n)&&n--,e=o._setCharAt(e,n,"_"),o.element.val(e)),t.preventDefault()}else 13==t.which?o._raiseOnChange():27==t.which&&o.element.hide()},focusout:function(){o.element.is(":visible")&&o._raiseOnChange()}}),this._render()},_setCharAt:function(t,e,n){return e>t.length-1?t:t.substr(0,e)+n+t.substr(e+1)},_render:function(){},_toEditFormat:function(t){if(this._isValidTime(t)){var e=t.match(/^\d\d:\d\d/);return 0<e.length&&(t=e[0]),t}return this._getInitEditValue()},_getInitEditValue:function(){return"__:__"},_fixValue:function(t){return t=t.replace(/\_/g,"0")},_isValidValue:function(t){var e=this._fixValue(t);return this._isValidTime(e)},_isValidTime:function(t){return/^(([0-1]?[0-9])|([2][0-4])):([0-5]?[0-9])(:([0-5]?[0-9]))?$/i.test(t)},time:function(){if(0<arguments.length){var t=arguments[0];return t=this._toEditFormat(t),this.element.val(t),this._render(),this}return this._fixValue(this.element.val())}}),(ot=jQuery).widget("eqjs.EntitiesPanel",{_rootEntityBlock:null,_entityTreeBlock:null,_query:null,_progressBlock:null,_queryObserverId:null,options:{queryPanelId:"QueryPanel",columnsPanelId:"ColumnsPanel",showToolbar:!0,showSelectAllButton:!1,showClearSelectionButton:!0,showAddColumnButton:!0,showAddConditionButton:!0,showCheckboxes:!0,showTooltips:!0,clickableAttributes:0,draggableAttributes:!0,showAttributes:{usedInConditions:!0,usedInColumns:!0,usedInSorting:!1},showFilterBox:!1,filterBoxMode:0,showIndicatorOnLoad:!0,attrPlacement:0,sortEntities:!1,autoClearSelection:!0,syncWithColumns:!1,entityRenderedCallback:null,attributeRenderedCallback:null},getSelf:function(){return this},getModel:function(){var t=this.getQuery();return t?t.getModel():null},getQuery:function(){return this._query},setQuery:function(t){this._setQueryObserver(!0),this._query=t,this._setQueryObserver(),this.refresh()},_setQueryObserver:function(t){var e=this,n=this.getQuery();n&&(t&&e._queryObserverId?n.removeChangedCallback(e._queryObserverId):e._queryObserverId=n.addChangedCallback(function(t){e.options.syncWithColumns&&t.data&&t.data.author!==e&&t.data.changeType&&t.data.changeType.indexOf("condition")<0&&e.refreshCheckedStateByColumns()}))},refreshCheckedStateByColumns:function(){var t,e,n,i=this.getQuery().getColumns(),o=i.length,r=0;for(this._deselectAll();r<o;r++)(e=i[r]).expr.tag==F.ExprTag.EntityAttribute&&((t=this._rootEntityBlock.find('.eqjs-ep-entity-attr[data-id="'+e.expr.id+'"]')).find("input").prop("checked",!0),(n=t.parent()).show(),n.prev().find("input").prop("checked",!0))},_create:function(){},_renderProgressBlock:function(){this._progressBlock=ot('<div class="eqjs-progress-win8"><div class="wBall" id="wBall_1"><div class="wInnerBall"></div></div><div class="wBall" id="wBall_2"><div class="wInnerBall"></div></div><div class="wBall" id="wBall_3"><div class="wInnerBall"></div></div><div class="wBall" id="wBall_4"><div class="wInnerBall"></div></div><div class="wBall" id="wBall_5"><div class="wInnerBall"></div></div></div>')},_render:function(){var t=this;this._clear();var e=this.getModel();if(this.element.addClass("eqjs-ep-panel"),this._dragParentDiv=ot("<div></div>").appendTo(this.element).css("height","0"),this._rootEntityBlock=ot("<div></div>"),null!=e&&!e.isEmpty()){var n=e.getEntitiesTree({addUIC:t.options.showAttributes.usedInConditions,addUIR:t.options.showAttributes.usedInColumns,addUIS:t.options.showAttributes.usedInSorting,attrPlacement:t.options.attrPlacement,sortEntities:t.options.sortEntities,includeRootData:!0});this._entityTreeBlock=this.element.append(this._renderEntity(n,this._rootEntityBlock,0))}this.options.showFilterBox?this._createFilterBox():this._rootEntityBlock.css("top","0"),this.options.showToolbar&&!this.options.syncWithColumns?this._createToolPanel():this._rootEntityBlock.css("bottom","0"),this._renderProgressBlock()},_renderEntity:function(t,e,n){var i,o,r,s,a=this,l="eqjs-ep-entity",u=ot("<div></div>",{class:l+"-node"}),d=ot("<div></div>",{class:l+"-children"}),c=ot("<label></label>",{class:l+"-node-label"}),h=ot("<input />",{type:"checkbox"}),p=ot("<a></a>",{href:"javascript:void(0)",class:l+"-node-button"}),m=(ot("<div></div>"),n),f=function(t,e){return 0<e.find("."+l+'-attr[data-id="'+t+'"]').length};if(e?(i=e).html("").addClass(l):i=ot("<div></div>",{class:l}),t.id&&""!=t.id){c.text(t.text).appendTo(u),a.options.showCheckboxes&&c.prepend(h),p.prependTo(u),a.options.showTooltips&&t.description&&c.attr("title",t.description);for(var g=0;g<m;g++)u.prepend(ot("<div></div>",{class:l+"-offset"}));i.append(u),d.hide(),m++}for(var y=t.items?t.items.length:0,v=0;v<y;v++){var _=t.items[v];if(_.isEntity)d.append(a._renderEntity(_,null,m));else if(!_.lookupAttr||!f(_.lookupAttr,d)&&!f(_.lookupAttr,this._rootEntityBlock)){r=ot("<label></label>",{text:_.text,class:l+"-attr-label"}),a.options.showCheckboxes&&(s=ot("<input />",{type:"checkbox"}),r.prepend(s),s.change(function(){if(a.options.syncWithColumns){var t=ot("#"+a.options.columnsPanelId),e=ot(this).prop("checked"),n=ot(this).parent().parent().data("id");e?t.ColumnsPanel("addNewColumn",n):t.ColumnsPanel("removeColumnByAttrId",n)}})),a.options.showTooltips&&_.description&&r.attr("title",_.description);for(var C=0;C<m+1;C++)r.prepend(ot("<div></div>",{class:l+"-offset"}));o=ot("<div></div>").attr("class",function(){var t=l+"-attr ";return 0==u.html().length&&(t+=l+"-attr-root"),t}).html(r).attr("data-id",_.id),a.options.draggableAttributes&&(o.addClass("draggable"),o.draggable({containment:"document",cursor:"auto",helper:"clone",scope:"entityAttr",revert:"invalid",distance:10,connectToSortable:".ui-sortable",cursorAt:{bottom:20,left:10},start:function(t,e){e.helper.find("input").hide(),e.helper.find("label").css("max-width","400px").css("overflow","hidden").css("text-overflow","ellipsis")},appendTo:a._dragParentDiv})),1==a.options.clickableAttributes?o.click(function(){ot("#"+a.options.queryPanelId).QueryPanel("addNewConditionIntoActivePredicate",ot(this).data("id"))}):2==a.options.clickableAttributes&&o.click(function(){ot("#"+a.options.columnsPanelId).ColumnsPanel("addNewColumn",ot(this).data("id"))}),this.options.attributeRenderedCallback&&this.options.attributeRenderedCallback(o),d.append(o)}}return d.html().length&&(i.append(d),p.click(function(t){d.toggle(),ot(this).toggleClass(l+"-node-button-open"),t.preventDefault()})),d&&d.find("> .eqjs-ep-entity-attr > label > input").click(function(t){ot(this).prop("checked")&&!h.prop("checked")?h.prop("checked",!0):0==d.find("input:checked").length&&h.prop("checked",!1),t.stopPropagation()}),h.click(function(t){var e=ot(this).prop("checked");if(e?d.find("label input").prop("checked",!0):d.find("label input").prop("checked",!1),a.options.syncWithColumns){var n=[];d.find("div.eqjs-ep-entity-attr").each(function(){n.push(ot(this).data("id"))});var i=ot("#"+a.options.columnsPanelId);e?i.ColumnsPanel("addNewColumn",n):i.ColumnsPanel("removeColumnByAttrId",n)}t.stopPropagation()}),e!=this._rootEntityBlock&&this.options.entityRenderedCallback&&this.options.entityRenderedCallback(i),i},expandAll:function(){this._rootEntityBlock.children().find(".eqjs-ep-entity-children").show(),this._rootEntityBlock.find(".eqjs-ep-entity-node-button").addClass("eqjs-ep-entity-node-button-open")},collapseAll:function(){this._rootEntityBlock.children().find(".eqjs-ep-entity-children").hide(),this._rootEntityBlock.find(".eqjs-ep-entity-node-button").removeClass("eqjs-ep-entity-node-button-open")},_checkFilterText:function(t){var e=this.filterBoxInput.val();return""==e||0==this.options.filterBoxMode&&0<=t.toLowerCase().indexOf(e.toLowerCase())||1==this.options.filterBoxMode&&0==t.toLowerCase().indexOf(e.toLowerCase())},_checkFilterAttribute:function(t){if(ot(t).find("label input").prop("checked"))return!0;var e=ot(t).find("label").text();if(this._checkFilterText(e))return!0;var n=ot(t).parent().parent().find(".eqjs-ep-entity-node").find("label").text();return!!this._checkFilterText(n)},_createFilterBox:function(){var n=this,t="eqjs-ep-filter-box";n.filterBoxBlock=ot("<div></div>",{class:t}),n.filterBoxInput=ot("<input></input>",{class:t+"-input"}),n.filterBoxInput.keydown(function(t){if(27==t.keyCode)return n.filterBoxInput.val(""),n.filterBoxInput.trigger("input",null),t.stopPropagation(),!1}),n.filterBoxInput.on("input",function(t){var e=n.element.find(".eqjs-ep-entity-attr");ot.each(e,function(t,e){n._checkFilterAttribute(e)?ot(e).show():ot(e).hide()}),n.element.find(">.eqjs-ep-entity").find(".eqjs-ep-entity").forEach(function(t){0==ot(t).find(".eqjs-ep-entity-attr").filter(function(t,e){return"none"!==ot(e).css("display")}).length?ot(t).hide():ot(t).show()}),""==n.filterBoxInput.val()?n.collapseAll():n.expandAll()}),n.filterBoxBlock.append(n.filterBoxInput),n.element.prepend(n.filterBoxBlock)},_createToolPanel:function(){var s=this,t="eqjs-ep-tool-panel",e=ot("<div></div>",{class:t}),n=ot("<div></div>",{class:t+"-select-all",title:"Select all"}),i=ot("<div></div>",{class:t+"-deselect-all",title:"Clear selection"}),o=ot("<div></div>",{class:t+"-add-columns",title:"Add column"}),r=ot("<div></div>",{class:t+"-add-cond",title:"Add condition"}),a=ot("<div></div>",{class:t+"-left-side"}),l=ot("<div></div>",{class:t+"-right-side"}),u=s.getModel();this.options.showSelectAllButton&&(n.attr("title",F.eqi18n.getText("ButtonSelectAll")),a.append(n),n.click(function(){s._selectAll()})),this.options.showClearSelectionButton&&(i.attr("title",F.eqi18n.getText("ButtonDeselectAll")),a.append(i),i.click(function(){s._deselectAll()})),this.options.showAddColumnButton&&(o.attr("title",F.eqi18n.getText("ButtonAddColumns")),l.append(o),o.click(function(){var t,e=s.element.find(".eqjs-ep-entity-attr"),n=[],i=s.getQuery();i.fireProcessEvent({source:s,status:"start"});for(var o=0;o<e.length;o++){var r=ot(e[o]);r.find("input").first().prop("checked")&&(t=r.data("id"),u.checkAttrProperty(t,"usedInResult")&&n.push(t))}ot("#"+s.options.columnsPanelId).ColumnsPanel("addNewColumn",n),s.options.autoClearSelection&&s._deselectAll(),i.fireProcessEvent({source:s,status:"finish"})})),this.options.showAddConditionButton&&(r.attr("title",F.eqi18n.getText("ButtonAddConditions")),l.append(r),r.click(function(){var t,e=s.element.find(".eqjs-ep-entity-attr"),n=[],i=s.getQuery();i.fireProcessEvent({source:s,status:"start"});for(var o=0;o<e.length;o++){var r=ot(e[o]);r.find("input").first().prop("checked")&&(t=r.data("id"),u.checkAttrProperty(t,"usedInCondition")&&n.push(t))}ot("#"+s.options.queryPanelId).QueryPanel("addNewCondition",n),s.options.autoClearSelection&&s._deselectAll(),i.fireProcessEvent({source:s,status:"finish"})})),e.append(a,l),this.element.append(e)},_selectAll:function(){this._entityTreeBlock.find("input").prop("checked",!0)},_deselectAll:function(){this._entityTreeBlock.find("input").prop("checked",!1)},_setOption:function(t,e){return 2==arguments.length?(this.options[t]=e,this._render(),this):this.options[t]},_clear:function(){this.element.html("")},refresh:function(){this._render(),this.options.syncWithColumns&&this.refreshCheckedStateByColumns()},resize:function(){this._render()},startLoading:function(){this.options.showIndicatorOnLoad&&this.element.append(this._progressBlock)},finishLoading:function(){this.options.showIndicatorOnLoad&&this.element.find(this._progressBlock).remove()}}),(rt=jQuery).widget("eqjs.ColumnRow",{_column:null,_baseExprBlock:null,_captionEditorBlock:null,_buttonsBlock:null,_columnTypeButton:null,_deleteButton:null,_keepShowingButtons:!1,_isMouseOverBlock:!1,_sortingButton:null,_panelCssPrefix:"eqjs-qc",_classesToAdd:"",_active:!1,options:{columnsPanel:null},getColumnsPanel:function(){return this.options.columnsPanel},getQuery:function(){return this.options.columnsPanel?this.options.columnsPanel.getQuery():null},getModel:function(){var t=this.getQuery();return t?t.getModel():null},getColumn:function(){return this._column},isModelNullOrEmpty:function(){var t=this.getModel();return!t||t.isEmpty()},_initCssPrefixes:function(){},init:function(t){this._initCssPrefixes(),this._column=t,this.element.get(0).column=t,this.refresh()},_render:function(){this._clear(),!this.isModelNullOrEmpty()&&this._column&&(this._refreshByColumn(),this._initButtons(),this.options.columnsPanel.options.activeColumn==this._column&&this.makeActive())},_fireColumnChange:function(t,e){e=e||this._column,this.getQuery().fireChangedEvent({author:this.options.columnsPanel,changeType:"column."+t,column:e})},refresh:function(){this._render()},_setOption:function(t,e){return 2==arguments.length?(this.options[t]=e,"disabled"===t&&(this._column.enabled=!e),this._render(),this):"disabled"===t?!1===this._column.enabled:this.options[t]},_clear:function(){this.element.unbind(),this.element.html(""),this.element.removeClass()},_refreshByColumn:function(){},remove:function(){this.options.columnsPanel&&this.options.columnsPanel.removeColumn(this._column)},_getButtonsContainer:function(){return this.element},_getUIS:function(){return this.getModel().checkAttrProperty(this._column.expr.id,"usedInSorting")},_initButtons:function(){var i=this,o=this.getQuery(),r=this.getColumnsPanel(),t=rt("<div></div>").addClass("eqjs-button-placeholder").addClass(i._panelCssPrefix+"-button-placeholder").addClass(i._panelCssPrefix+"-colelement").addClass(i._panelCssPrefix+"-sortbutton-placeholder"),e=rt("<div></div>").addClass(i._panelCssPrefix+"-colelement").addClass(i._panelCssPrefix+"-sortimage-placeholder");i._sortingImage=rt("<div></div>").addClass(i._panelCssPrefix+"-img-sorting").appendTo(e),r.options.isColumnsBar?e.prependTo(i.element):t.prependTo(i.element),i._sortingButton=rt("<div></div>").addClass("eqjs-column-sortbutton").appendTo(t);var n=i._getButtonsContainer();if(n&&!i._column.readOnly){i._buttonsBlock=rt("<div></div>").addClass("eqjs-column-buttonsBlock").addClass(i._panelCssPrefix+"-buttonsBlock").appendTo(n),r.options.isColumnsBar&&t.appendTo(i._buttonsBlock);var s=rt("<div></div>").addClass("eqjs-button-placeholder").addClass(i._panelCssPrefix+"-button-placeholder").addClass(i._panelCssPrefix+"-typebutton-placeholder").appendTo(i._buttonsBlock);i._columnTypeButton=rt("<div></div>").addClass("eqjs-button").addClass("eqjs-column-button").addClass("eqjs-column-button-type").attr("title",F.eqi18n.getText("ButtonToAggr")).appendTo(s),s=rt("<div></div>").addClass("eqjs-button-placeholder").addClass(i._panelCssPrefix+"-button-placeholder").addClass(i._panelCssPrefix+"-deletebutton-placeholder").appendTo(i._buttonsBlock),i._deleteButton=rt("<div></div>").addClass("eqjs-button").addClass("eqjs-column-button").addClass("eqjs-column-button-delete").attr("title",F.eqi18n.getText("ButtonDelete")).appendTo(s).click(function(){return i.remove(),!1}),i._sortingButton.attr("title",F.eqi18n.getText("ButtonSorting")).click(function(t){return i._keepShowingButtons=!0,(i._getUIS()?i.options.columnsPanel.options.sortMenu:i.options.columnsPanel.options.moveMenu).PopupMenu("showMenu",{anchor:i._sortingButton,selectedIds:null,itemSelectedCallback:function(t,e){var n;"None"==e.menuItem.id||"Ascending"==e.menuItem.id||"Descending"==e.menuItem.id?(i._column.sorting="None"==(n=e.menuItem.id)?F.SortDirection.None:"Ascending"==n?F.SortDirection.Ascending:"Descending"==n?F.SortDirection.Descending:void 0,i._column.sortIndex=o.getColumnSortIndex(i._column),r.refresh(),i._fireColumnChange("change")):i.options.columnsPanel.moveColumn(i._column,e.menuItem.id)},menuClosedCallback:function(){i._keepShowingButtons=!1,i._isMouseOverBlock||i._sortingButton.trigger("mouseleave")}}),!1});var a="eqjs-column-sortbutton";i._sortingButton.addClass("eqjs-button"),i._column.sorting===F.SortDirection.None&&(i._sortingButton.addClass(a+"-none"),i._sortingImage.addClass(a+"-none")),r.options.isColumnsBar&&i._sortingButton.addClass(a+"-none"),i._sortingButton.hover(function(t){rt(t.target).addClass(a+"-active")},function(t){rt(t.target).removeClass(a+"-active")}),i._column.sorting===F.SortDirection.Ascending?(r.options.isColumnsBar||i._sortingButton.addClass(a+"-asc").attr("title",F.eqi18n.getText("ButtonSorting")),i._sortingImage.addClass(a+"-asc")):i._column.sorting===F.SortDirection.Descending&&(r.options.isColumnsBar||i._sortingButton.addClass(a+"-desc").attr("title",F.eqi18n.getText("ButtonSorting")),i._sortingImage.addClass(a+"-desc"));var l=this._panelCssPrefix+"-button";n.find("[class*="+l+"]").hover(function(t){rt(t.target).addClass(l+"-active")},function(t){rt(t.target).removeClass(l+"-active")}),n.bind("mouseenter",function(t){return i._isMouseOverBlock=!0,i._enterButtonBlock(),t.stopPropagation(),!1}).bind("mouseleave",function(t){return i._isMouseOverBlock=!1,i._keepShowingButtons||i._leaveButtonBlock(),t.stopPropagation(),!1}),i._setupButtonListeners(),i._hideButtons(),i._adjustButtonsVisibility()}},_setupButtonListeners:function(){},_adjustButtonsVisibility:function(){},_enterButtonBlock:function(){this._showButtons()},_leaveButtonBlock:function(){1==this.options.columnsPanel.options.alwaysShowButtons||this._active&&1==this.options.columnsPanel.options.accentActiveColumn||this._hideButtons()},_showButtons:function(){},_hideButtons:function(){this._columnTypeButton.hide(),this._deleteButton.hide(),this._column.sorting===F.SortDirection.None&&this._sortingButton.hide(),this.getColumnsPanel().options.isColumnsBar&&this._buttonsBlock.hide()},internalActivate:function(){this._active=!0,this.adjustActiveClass(),this._hideButtons(),this._adjustButtonsVisibility()},internalDeactivate:function(){this._active=!1,this.adjustActiveClass(),this._hideButtons(),this._adjustButtonsVisibility()},adjustActiveClass:function(){this._active&&this.options.columnsPanel.options.accentActiveColumn?this.element.addClass("active"):this.element.removeClass("active")},isActive:function(){return this._active},makeActive:function(){var t=this.getColumnsPanel();t&&t.setActiveColumnWidget(this)},makeInactive:function(){var t=this.getColumnsPanel();t&&t.deactivateColumnWidget()}}),rt.widget("eqjs.ColumnRow_"+F.ExprTag.EntityAttribute,rt.eqjs.ColumnRow,{_baseAttr:null,_menuFunctionsBlock:null,_paramsBlock:null,_initCssPrefixes:function(){this._panelCssPrefix=this.options.columnsPanel._getCssPrefix(),this._classesToAdd=this._panelCssPrefix+"-row "+this._panelCssPrefix+"-row-column-entattr"},_baseExprMenuClick:function(t,e){var n=this,i=e.menuItem.data("id");return n.getModel().getAttributeById(i),n._column.expr.id=i,n._column.caption="",n.refresh(),n._fireColumnChange("change"),!1},_getBaseExpr:function(){var n=this,e=null;return e=!1===n._column.enabled||n._column.readOnly?rt("<span></span>").text(n._getAttributeText(n._baseAttr)).attr("title",n._getAttributeText(n._baseAttr)):rt("<a></a>").attr("href","javascript:void(0)").text(n._getAttributeText(n._baseAttr)).attr("title",n._getAttributeText(n._baseAttr)).click(function(t){t.preventDefault(),n.options.columnsPanel.options.entitiesMenu.PopupMenu("showMenu",{anchor:e,selectedIds:null,itemSelectedCallback:function(t,e){return n._baseExprMenuClick(t,e)}})})},_fillBaseBlock:function(t){var e=this;t.addClass(this._panelCssPrefix+"-expr-block"),e._baseExprBlock=rt("<div></div>").addClass(this._panelCssPrefix+"-colelement").addClass(this._panelCssPrefix+"-attrelement").appendTo(t),e._getBaseExpr().appendTo(e._baseExprBlock),e._column.params&&0<e._column.params.length&&(e._paramsBlock=rt("<div></div>").addClass(this._panelCssPrefix+"-params-block").appendTo(t),e._fillParamsBlock(e._paramsBlock)),e._column.readOnly||e._createFunctionMenu()},_fillParamsBlock:function(o){var r=this;rt("<span>(</span>").addClass("eqjs-qc-colelement").addClass("eqjs-qp-valueelement").appendTo(o),r._column.params.forEach(function(t,e,n){var i=rt("<div></div>");i.appendTo(o),r._createParamEditor(i,t),e<n.length-1&&rt("<span>,&nbsp</span>").addClass("eqjs-qc-colelement").addClass("eqjs-qp-valueelement").appendTo(o)}),rt("<span>)</span>").addClass("eqjs-qc-colelement").addClass("eqjs-qp-valueelement").appendTo(o)},_getParamEditor:function(t){this.getModel(),this._getAttribute();var e={};return t&&t.editor&&t.editor.type!==F.DataType.Unknown?e=rt.extend({},t.editor):!t||t.dataType!=F.DataType.Date&&t.dataType!=F.DataType.DateTime&&t.dataType!=F.DataType.Time?e.type="EDIT":e.type="DATETIME",e},_createParamEditor:function(t,e){var n=this,i=n._getParamEditor(e);if(e.kind=F.DataKind.Scalar,i){var o="element.ValueEditor_"+i.type+"({parentWidget:self, editor: editorObj, onChange:paramChangedCallback, emptyText: emptyTxt}); element.ValueEditor_"+i.type+"('init', expr);";new Function("self, element, expr, editorObj, paramChangedCallback, emptyTxt",o)(this,t,e,i,function(){n._fireColumnChange("change",n._column)},"<"+e.caption+">")}},_refreshByColumn:function(){if(this._column&&!this.isModelNullOrEmpty()){var t=this;t._baseAttr=t._getAttribute(),t.element.addClass(t._classesToAdd),t._column.readOnly&&this.element.addClass("eqjs-qp-readonly");var e=rt("<div></div>").appendTo(t.element);t._fillBaseBlock(e),t.options.columnsPanel.options.accentActiveColumn&&t.element.click(function(){t._active?t.makeInactive():t.makeActive()}),t._column.caption&&""!=t._column.caption||(t._column.caption=t._getDefaultCaption()),t.options.columnsPanel.options.showColumnCaptions&&(t._column.readOnly?rt("<span></span>").addClass(this._panelCssPrefix+"-colelement").addClass(this._panelCssPrefix+"-captionelement").text(t._column.caption).attr("title",t._column.caption).appendTo(this.element):(this._captionEditorBlock=rt("<div></div>"),this._captionEditorBlock.appendTo(this.element),this._captionEditorBlock.ColumnRow_CaptionEditor({parentWidget:t,cssClassPrefix:this._panelCssPrefix}),this._captionEditorBlock.ColumnRow_CaptionEditor("init",t._column,t._column.caption,function(){t._column.captionChanged=!0,t._fireColumnChange("change")}))),t.adjustActiveClass()}},_getDefaultTitleText:function(t){var e=this.options.columnsPanel,n=e.options.titleElementFormat||e.options.attrElementFormat;return this.getModel().getAttributeText(t,n)},_getDefaultCaption:function(){return this._getDefaultTitleText(this._baseAttr)},_getAttribute:function(){return this.getModel().getAttributeById(this._column.expr.id)},_getAttributeText:function(t){if(!t)return"";var e=this.getModel(),n=this.options.columnsPanel.options.attrElementFormat;return e.getAttributeText(t,n)},_adjustButtonsVisibility:function(){this._columnTypeButton.removeClass("aggregated").attr("title",F.eqi18n.getText("ButtonToAggr")),(this.options.columnsPanel.options.alwaysShowButtons||this.options.columnsPanel.options.accentActiveColumn&&this._active)&&this._showButtons()},_changeTypeToAggr:function(t){var e=this;t||(t=e._menuFunctionsBlock.PopupMenu("option","items")[0].id);var n=e._column.expr.id;e._column.caption="";var i=new F.Expression;i.tag=F.ExprTag.AggregateFunction,i.func=t,i.distinct=!1;var o=new F.Expression;o.id=n,o.tag=F.ExprTag.EntityAttribute,i.args.push(o),e._column.expr=i;var r=e._column,s=e._active;e.destroy(),e._clear(),e.element["ColumnRow_"+F.ExprTag.AggregateFunction]({columnsPanel:e.options.columnsPanel}),e.element["ColumnRow_"+F.ExprTag.AggregateFunction]("init",r),e._fireColumnChange("change"),s&&(e.options.columnsPanel._activeColumn=null,e.element["ColumnRow_"+F.ExprTag.AggregateFunction]("makeActive"))},_changeTypeToCustomSql:function(){var t=this,e=t._column.expr.id,n=t._column.caption="",i=t.getModel();i&&(n=i.getAttributeById(e).sqlExpr);var o=new F.Expression;o.tag=F.ExprTag.CustomSql,o.sql=n,o.baseAttrId=e,this._column.expr=o;var r=t._column,s=t._active;t.destroy(),t._clear(),t.element["ColumnRow_"+F.ExprTag.CustomSql]({columnsPanel:t.options.columnsPanel}),t.element["ColumnRow_"+F.ExprTag.CustomSql]("init",r),t._fireColumnChange("change"),s&&(t.options.columnsPanel._activeColumn=null,t.element["ColumnRow_"+F.ExprTag.CustomSql]("makeActive")),t.element["ColumnRow_"+F.ExprTag.CustomSql]("showSqlEditor")},_createFunctionMenu:function(){for(var t,e=this,n=[],i=e.getModel().getAggrFunctions(),o=!0,r=!0,s=null,a=e._getAttribute(),l=i.length,u=0;u<l;u++)i[u]&&(o=!0,"SUM"===i[u].id||"AVG"===i[u].id?o=0<=rt.inArray(a.dataType,[F.DataType.Autoinc,F.DataType.Byte,F.DataType.Currency,F.DataType.Float,F.DataType.Int32,F.DataType.Int64,F.DataType.Word]):"MIN"!==i[u].id&&"MAX"!==i[u].id||(o=0<=rt.inArray(a.dataType,[F.DataType.Autoinc,F.DataType.BCD,F.DataType.Byte,F.DataType.Currency,F.DataType.Date,F.DataType.DateTime,F.DataType.Time,F.DataType.Float,F.DataType.Int32,F.DataType.Int64,F.DataType.Word])),e._column.expr.func!==i[u].id||o||(r=!1),o&&(t=e.getModel().getAggrFunctionCaption(i[u].id),s={id:i[u].id,text:t},n.push(s)));r||(e._column.expr.func=n[0].id),e.options.columnsPanel.areCustomExpressionsAllowed()&&(s={id:"CustomSqlDivider",text:"---"},n.push(s),s={id:"CUSTOMSQL",text:t=F.eqi18n.getText("CustomExpression")},n.push(s)),e._menuFunctionsBlock=rt("<div></div>").hide().appendTo(e.element);var d=e.element.attr("id");d&&(d+="-FunctionsMenu");var c={items:n,id:d,domWriteItemsId:e.options.columnsPanel.options.domWriteItemsId};return F.equtils.assign(c,e.options.columnsPanel.options.menuOptions),e._menuFunctionsBlock.PopupMenu(c),e._menuFunctionsBlock},_showButtons:function(){0!=this.options.columnsPanel.options.allowAggrColumns?this._columnTypeButton.show():this._columnTypeButton.attr("title",""),this._deleteButton.show(),this._sortingButton.show(),this.getColumnsPanel().options.isColumnsBar&&!this.element.hasClass("ui-sortable-helper")&&this._buttonsBlock.show()},_setupButtonListeners:function(){var n=this;n._columnTypeButton&&n._columnTypeButton.click(function(t){return!1!==n.options.columnsPanel.options.allowAggrColumns&&!1!==n._column.enabled&&(n._keepShowingButtons=!0,n._menuFunctionsBlock.PopupMenu("showMenu",{anchor:n._columnTypeButton,selectedIds:null,itemSelectedCallback:function(t,e){return"CUSTOMSQL"==e.menuItem.id?n._changeTypeToCustomSql():n._changeTypeToAggr(e.menuItem.id),!1},menuClosedCallback:function(){n._keepShowingButtons=!1,n._isMouseOverBlock||n._columnTypeButton.trigger("mouseleave")}})),!1})}}),rt.widget("eqjs.ColumnRow_"+F.ExprTag.AggregateFunction,rt.eqjs["ColumnRow_"+F.ExprTag.EntityAttribute],{_displayFormatParser:{formatStr:"",pos:0,token:"text",tokenText:"",start:function(t){this.formatStr=t,this.pos=0,this.tokenText=""},skipSpaces:function(){for(;this.pos<this.formatStr.length&&" "===this.formatStr.charAt(this.pos);)this.pos++},next:function(){if(this.skipSpaces(),this.pos>=this.formatStr.length)return!1;var t=0;if("{"===this.formatStr.charAt(this.pos)){if((t=this.formatStr.indexOf("}",this.pos))<0)return!1;this.tokenText=this.formatStr.substring(this.pos,t+1),0!==this.tokenText.indexOf("{expr")&&0!==this.tokenText.indexOf("{attr")||(this.token="expression"),this.pos=t+1}else if("["===this.formatStr.charAt(this.pos)&&this.pos<this.formatStr.length-1&&"["===this.formatStr.charAt(this.pos+1))this.pos+=2,t=this.formatStr.indexOf("]]",this.pos),this.token="function",this.tokenText=this.formatStr.substring(this.pos,t),this.pos=t+2;else{this.token="text";var e=this.formatStr.indexOf("{",this.pos);e<0&&(e=this.formatStr.length);var n=this.formatStr.indexOf("[[",this.pos);n<0&&(n=this.formatStr.length),t=Math.min(e,n),this.tokenText=rt.trim(this.formatStr.substring(this.pos,t)),this.pos=t}return!0}},_initCssPrefixes:function(){this._panelCssPrefix=this.options.columnsPanel._getCssPrefix(),this._classesToAdd=this._panelCssPrefix+"-row "+this._panelCssPrefix+"-row-column-aggr"},_parseDisplayFormat:function(t){if(!t)return[];var e=[],n=this._displayFormatParser;for(n.start(t);n.next();)"function"===n.token?e.push({type:1,text:n.tokenText}):"expression"===n.token?e.push({type:2}):"text"===n.token&&e.push({type:3,text:n.tokenText});return e},_baseExprMenuClick:function(t,e){var n=this,i=e.menuItem.data("id");return n.getModel().getAttributeById(i),n._column.expr.args[0].id=i,n._column.caption="",n.refresh(),n._fireColumnChange("change"),!1},_fillBaseBlock:function(t){var e,n,i=this;t.addClass(this._panelCssPrefix+"-expr-block "+this._panelCssPrefix+"-expr-block-aggr");var o=rt("<div></div>").addClass(this._panelCssPrefix+"-colelement").addClass(this._panelCssPrefix+"-aggrfuncelement");!1===i._column.enabled||i._column.readOnly?n=rt("<span></span>").appendTo(o):(n=rt("<a></a>",{href:"javascript:void(0)"}).appendTo(o),i._createFunctionMenu());var r=i.getModel().getAggrFunctionFormat(i._column.expr.func);if(r&&""!==r){var s=i._parseDisplayFormat(r);if(0!==s.length)for(var a=null,l=s.length,u=0;u<l;u++)1===(a=s[u]).type?(n.text(a.text),o.appendTo(t),!1!==i._column.enabled&&n.click(function(t){return i._menuFunctionsBlock.PopupMenu("showMenu",{anchor:n,selectedIds:null,itemSelectedCallback:function(t,e){return i._column.expr.func=e.menuItem.id,i._column.caption="",i.refresh(),i._fireColumnChange("change"),!1}}),!1})):2===a.type?(i._baseAttr=i._getAttribute(),e=this._getBaseExpr(),i._baseExprBlock=rt("<div></div>").addClass(this._panelCssPrefix+"-colelement").addClass(this._panelCssPrefix+"-attrelement").appendTo(t),e.appendTo(i._baseExprBlock)):3===a.type&&rt("<span></span>").addClass(this._panelCssPrefix+"-colelement").text(a.text).attr("title",a.text).appendTo(t)}},_getDefaultCaption:function(){return this._getDefaultTitleText(this._baseAttr)+" "+this.getModel().getAggrFunctionCaption(this._column.expr.func)},_getAttribute:function(){return this.getModel().getAttributeById(this._column.expr.args[0].id)},_setupButtonListeners:function(){var t=this;t._columnTypeButton.click(function(){return!1!==t._column.enabled&&t._changeTypeToSimple(),!1})},_adjustButtonsVisibility:function(){this._columnTypeButton.addClass("aggregated").attr("title",F.eqi18n.getText("ButtonToSimple")),(this.options.columnsPanel.options.alwaysShowButtons||this.options.columnsPanel.options.accentActiveColumn&&this._active)&&this._showButtons()},_changeTypeToSimple:function(){var t=this,e=t._column.expr.args[0].id;t._column.caption="";var n=new F.Expression;n.tag=F.ExprTag.EntityAttribute,n.id=e,this._column.expr=n;var i=t._column,o=t._active;t.destroy(),t._clear(),t.element["ColumnRow_"+F.ExprTag.EntityAttribute]({columnsPanel:t.options.columnsPanel}),t.element["ColumnRow_"+F.ExprTag.EntityAttribute]("init",i),t._fireColumnChange("change"),o&&(t.options.columnsPanel._activeColumn=null,t.element["ColumnRow_"+F.ExprTag.EntityAttribute]("makeActive"))},_getUIS:function(){var t=this._column.expr.args[0];return!t||this.getModel().checkAttrProperty(t.id,"usedInSorting")}}),rt.widget("eqjs.ColumnRow_"+F.ExprTag.CustomSql,rt.eqjs["ColumnRow_"+F.ExprTag.EntityAttribute],{_fillBaseBlock:function(t){var e=this;t.addClass(this._panelCssPrefix+"-expr-block"),e._baseExprBlock=rt("<div></div>").addClass(this._panelCssPrefix+"-colelement").addClass(this._panelCssPrefix+"-attrelement").appendTo(t),e._column.captionChanged=!1,e._baseExprBlock.ColumnRow_CustomSqlExprEditor({parentWidget:e,cssClassPrefix:this._panelCssPrefix}),e._baseExprBlock.ColumnRow_CustomSqlExprEditor("init",e._column,e._getDefaultValue(),function(){e._fireColumnChange("change")})},showSqlEditor:function(){this._baseExprBlock.ColumnRow_CustomSqlExprEditor("showEditor")},_getDefaultValue:function(){return this._column.expr.sql},_getDefaultCaption:function(){return"Custom SQL Column"},_adjustButtonsVisibility:function(){this._columnTypeButton.addClass("aggregated").attr("title",F.eqi18n.getText("ButtonToSimple")),(this.options.columnsPanel.options.alwaysShowButtons||this.options.columnsPanel.options.accentActiveColumn&&this._active)&&this._showButtons()},_setupButtonListeners:function(){var t=this;t._columnTypeButton.click(function(){return!1!==t._column.enabled&&t._changeTypeToSimple(),!1})},_changeTypeToSimple:function(){var t=this,e=t._column.expr.baseAttrId;t._column.caption="";var n=new F.Expression;n.tag=F.ExprTag.EntityAttribute,n.id=e,t._column.expr=n;var i=t._column,o=t._active;t.destroy(),t._clear(),t.element["ColumnRow_"+F.ExprTag.EntityAttribute]({columnsPanel:t.options.columnsPanel}),t.element["ColumnRow_"+F.ExprTag.EntityAttribute]("init",i),t._fireColumnChange("change"),o&&(t.options.columnsPanel._activeColumn=null,t.element["ColumnRow_"+F.ExprTag.EntityAttribute]("makeActive"))},_getUIS:function(){return!0}}),rt.widget("eqjs.ColumnRow_CaptionEditor",rt.eqjs.ValueEditor_EDIT,{_column:null,_defaultValue:"",_editBoxClass:"eqjs-qc-ce-editbox",_onChange:null,options:{cssClassPrefix:"eqjs-qc"},init:function(t,e,n){this._editBoxClass=this.options.cssClassPrefix+"-ce-editbox",this._expr.value=t.caption,this._expr.text=t.caption,this._column=t,this._defaultValue=e,this._onChange=n,this.refresh()},_render:function(){this.clear(),this._column&&(this._renderCommonPart(),this._renderEditor(),this._linkElement.text(this._getDisplayText()),this._linkElement.attr("title",this._getDisplayText()))},_renderCommonPart:function(){var t=this;t.element.addClass(t._getClassesToAdd()),t._linkElement=rt("<a></a>",{href:"javascript:void(0)",text:"-"}).appendTo(t.element),t._linkElement.click(function(){return t._showEditor(),!1})},_getClassesToAdd:function(){return this.options.cssClassPrefix+"-colelement "+this.options.cssClassPrefix+"-captionelement"},_setValue:function(t){return this._column.caption=t&&""!=t?t:this._defaultValue,this.updateLink(),this._onChange&&this._onChange(t),!0},updateLink:function(){this._linkElement.text(this._column.caption),this._linkElement.attr("title",this._column.caption)},_getValue:function(){return this._column.caption},_getText:function(){return this._column.caption},_getDisplayText:function(){return this._column.caption},_getZIndex:function(){return 1e5}}),rt.widget("eqjs.ColumnRow_CustomSqlExprEditor",rt.eqjs.ValueEditor_EDIT,{_column:null,_defaultValue:"",_editBoxClass:"eqjs-qc-ce-editbox",_onChange:null,options:{cssClassPrefix:"eqjs-qc",parentWidget:null},getColumnsPanel:function(){return null!=this.options.parentWidget?this.options.parentWidget.getColumnsPanel():null},init:function(t,e,n){this._editBoxClass=this.options.cssClassPrefix+"-ce-editbox",this._expr.value=t.expr.sql,this._expr.text=t.expr.sql,this._column=t,this._defaultValue=e,this._onChange=n,this.refresh()},_render:function(){this.clear(),this._column&&(this._renderCommonPart(),this._renderEditor(),this._linkElement.text(this._getDisplayText()),this._linkElement.attr("title",this._getDisplayText()))},_renderCommonPart:function(){var t=this;t.element.addClass(t._getClassesToAdd()),t._linkElement=rt("<a></a>",{href:"javascript:void(0)",text:"-"}).appendTo(t.element),t._linkElement.click(function(){return t._showEditor(),!1})},_getClassesToAdd:function(){return this.options.cssClassPrefix+"-colelement "+this.options.cssClassPrefix+"-attrelement"},_setValue:function(t){return this._column.expr.sql=t&&""!=t?t:this._defaultValue,this._linkElement.text(this._getDisplayText()),this._linkElement.attr("title",this._column.expr.sql),this._onChange&&this._onChange(t),!0},_getValue:function(){return this._column.expr.sql},_getText:function(){return this._column.expr.sql},_getDisplayText:function(){var t=this.getColumnsPanel(),e=null!=t?t.options.customExpressionText:0;return 1==e?F.eqi18n.getText("MsgCustomSql"):2==e?this._column.caption:""!=this._column.expr.sql?this._column.expr.sql:F.eqi18n.getText("MsgEmptyCustomSql")},_getZIndex:function(){return 1e5}}),(st=jQuery).widget("eqjs.ColumnsContainer",{_activeColumnWidget:null,_globalColCounter:0,_defaultMenuOptions:{showSearchBoxAfter:30,searchBoxAutoFocus:!0,activateOnMouseOver:!0},_query:null,_queryObserverId:null,options:{isSubQuery:!1,activeColumn:null,showAddRow:!0,showHeader:!0,showColumnCaptions:!0,allowAggrColumns:!0,allowDuplicates:!0,allowCustomExpressions:!1,allowSorting:!0,attrElementFormat:"{entity} {attr}",titleElementFormat:null,alwaysShowButtons:!1,accentActiveColumn:!0,menuSearchBoxAfter:30,allowDragDrop:!0,menuOptions:{showSearchBoxAfter:30,searchBoxAutoFocus:!0,activateOnMouseOver:!0,adjustHeight:!0,itemRenderedCallback:null},attrPlacement:0,sortEntities:!1,columnRenderedCallback:null,customExpressionText:0},_create:function(){},getQuery:function(){return this._query},setQuery:function(t){this._setQueryObserver(!0),this._query=t,this._setQueryObserver(),this.refresh()},getModel:function(){var t=this.getQuery();return t?t.getModel():null},getColumns:function(){var t=this.getQuery();return t?t.getColumns():null},_getCssPrefix:function(){return""},_customExpressionsPermitted:!0,areCustomExpressionsAllowed:function(){return this.options.allowCustomExpressions&&this._customExpressionsPermitted},_render:function(){var i=this;i._clear();var o=this.getModel();i._updateLists();var t=this._getCssPrefix();if(i.element.addClass(t+"-panel"),o&&!o.isEmpty()){i.options.entitiesList=o.getEntitiesTree({addUIC:!1,addUIR:!0,addUIS:!1,attrPlacement:i.options.attrPlacement,sortEntities:i.options.sortEntities}),i.options.entitiesMenu=i._createEntitiesMenu(),0!=i.options.allowSorting?i.options.sortMenuList=[{id:"None",text:F.eqi18n.getText("CmdNotSorted")},{id:"Ascending",text:F.eqi18n.getText("CmdAscending")},{id:"Descending",text:F.eqi18n.getText("CmdDescending")},{id:"---",text:"---"}]:i.options.sortMenuList=[],i.options.moveMenuList=[{id:"MoveTop",text:F.eqi18n.getText("CmdMoveToFirst")},{id:"MoveUp",text:F.eqi18n.getText("CmdMoveToPrev")},{id:"MoveDown",text:F.eqi18n.getText("CmdMoveToNext")},{id:"MoveBottom",text:F.eqi18n.getText("CmdMoveToLast")}],Array.prototype.push.apply(i.options.sortMenuList,i.options.moveMenuList),i.options.sortMenu=i._createSortMenu(),i.options.moveMenu=i._createSortMenu(!0);var e=0,n=i.getColumns(),r=t+"-header";if(0!=i.options.showHeader){var s=st('<div class="'+r+'"></div>').appendTo(this.element);st('<div class="'+r+'-expression"></div>').text(F.eqi18n.getText("HeaderExpression")).appendTo(s),i.options.showColumnCaptions&&st('<div class="'+r+'-title"></div>').text(F.eqi18n.getText("HeaderTitle")).appendTo(s),e+=s.outerHeight()+5,this._headerBlock=s}this._updateHeaderBlock();var a=i._refreshByQuery(!0);if(i.options.showAddRow){var l=st('<div class="eqjs-addrow '+t+'-addrow"></div>');l.appendTo(this.element),n&&0!==n.length||l.addClass("eqjs-addrow-empty");var u=st('<a href="javascript:void(0)">'+F.eqi18n.getText("CmdClickToAddColumn")+"</a>");u.appendTo(l),u.click(function(t){t.preventDefault(),i.showEntitiesMenu({anchor:u,selectedIds:null,itemSelectedCallback:function(t,e){var n=e.menuItem.id;return o.getAttributeById(n),i.addNewColumn(n),!1}},{})}),e+=l.outerHeight()+9}a&&(a.show(),a.css({"max-height":i.element.innerHeight()-e+5+"px"}))}},_updateHeaderBlock:function(){if(this._headerBlock){var t=this.getColumns();t&&0<t.length?this._headerBlock.show():this._headerBlock.hide()}},_updateLists:function(){},_setOption:function(t,e){if("menuOptions"==t)this.options.menuOptions=st.extend({},this._defaultMenuOptions,e);else if("searchBoxAfter"==t)this.options[t]=e,this.options.menuOptions.showSearchBoxAfter=e;else{if("query"!=t)return 2==arguments.length?(this.options[t]=e,this.refresh(),this):this.options[t];this.setQuery(e)}},_setQueryObserver:function(t){var e=this,n=this.getQuery();n&&(t&&e._queryObserverId?n.removeChangedCallback(e._queryObserverId):e._queryObserverId=n.addChangedCallback(function(t){t.data&&t.data.author!==e&&t.data.changeType&&t.data.changeType.indexOf("condition")<0&&e._render()}))},_clear:function(){this.element.html("")},_addColumnElement:function(t,e,n){var i=st("<div></div>"),o=t.find("[class*="+this._getCssPrefix()+"-row]");0==n?i.prependTo(t):0<n&&n<o.length?i.insertAfter(o[n-1]):i.appendTo(t),e.blockId||this.trySetBlockId(e),e.blockId&&i.attr("id",e.blockId);var r="element.ColumnRow_"+e.expr.tag+"({columnsPanel: self}); element.ColumnRow_"+e.expr.tag+"('init', column);";new Function("self, element, column",r)(this,i,e),this.options.columnRenderedCallback&&this.options.columnRenderedCallback(i)},_refreshByQuery:function(t){var i=this;if(this.getQuery()){var e=st("<div></div>"),n=st("<div></div>"),o=this._getCssPrefix();e.addClass(o+"-columns"),e.appendTo(n),n.appendTo(i.element),t&&e.hide();for(var r=i.getColumns(),s=r.length,a=0;a<s;a++)i._addColumnElement(e,r[a]);var l,u,d=!1,c=null,h=!1,p=i.getModel();return i.options.allowDragDrop&&(e.sortable({containment:n,tolerance:"pointer",axis:i.options.isColumnsBar?null:"y",placeholder:"ui-state-highlight eqjs-highlight",scrollSpeed:3,delay:100,distance:13,cursorAt:{top:10},forceHelperSize:!1,handle:"div, a",start:function(t,e){l=e.item.index(),e.item.addClass(o+"-column-sort"),h=!0},update:function(t,e){h=!1,d||e.item.hasClass(o+"-row")?(u=e.item.index(),d?(i.addNewColumn(c,u),e.item.remove(),d=!1):l!=u&&i.getQuery().moveColumn(l,u,i)):e.item.remove()},over:function(t,e){h=!0},out:function(t,e){h=!1},stop:function(t,e){return h=!1,e.item.removeClass(o+"-column-sort"),!0}}),i.element.droppable({hoverClass:"eqjs-drophover",scope:"entityAttr",drop:function(t,e){var n=e.draggable.attr("data-id");p.checkAttrProperty(n,"usedInResult")&&(h?d=!0:(i.addNewColumn(n),i.refresh()))},over:function(t,e){e.helper.addClass(o+"-column-drag");var n=e.draggable.attr("data-id");p.checkAttrProperty(n,"usedInResult")||e.helper.addClass(o+"-column-drag-forbidden")},out:function(t,e){e.helper.removeClass(o+"-column-drag"),e.helper.removeClass(o+"-column-drag-forbidden")},activate:function(t,e){c=e.draggable.attr("data-id")}})),e}},clearColumns:function(t){var e=this.getQuery();e&&(e.clearColumns(),!1!==t&&this.refresh())},_createEntitiesMenu:function(){var t=this.getModel();if(!t||t.isEmpty())return null;var e=st("<div></div>").hide().appendTo(this.element),n=this.element.attr("id");n&&(n+="-EntitiesMenu");var i={items:this.options.entitiesList,adjustHeight:this.options.adjustEntitiesMenuHeight,id:n,domWriteItemsId:this.options.domWriteItemsId};return F.equtils.assign(i,this.options.menuOptions),e.PopupMenu(i),e},showEntitiesMenu:function(t,e){this.options.entitiesMenu.PopupMenu("showMenu",t)},_createSortMenu:function(t){var e=this.getModel();if(!e||e.isEmpty())return null;var n=st("<div></div>").hide().appendTo(this.element),i=this.element.attr("id");i&&(i+="-SortMenu");var o={items:t?this.options.moveMenuList:this.options.sortMenuList,id:i,domWriteItemsId:this.options.domWriteItemsId};return F.equtils.assign(o,this.options.menuOptions),n.PopupMenu(o),n},_fireColumnChange:function(t,e){e=e||this._column,this.getQuery().fireChangedEvent({author:this,changeType:"column."+t,column:e})},_getDefaultColumnCaption:function(t){var e=this.options.titleElementFormat||this.options.attrElementFormat;return this.getModel().getAttributeText(t,e)},addNewColumn:function(t,e){var i=this,o=this.getModel(),n=function(t){var e=o.getAttributeById(t);if(!e)return null;if(!e.usedInResult){if(!e.lookupAttr)return null;if(t=e.lookupAttr,!(e=o.getAttributeById(t))||!e.usedInResult)return null}var n=new F.Column;return n.caption=i._getDefaultColumnCaption(e),n.sorting=F.SortDirection.None,n.sortIndex=-1,n.expr.tag=F.ExprTag.EntityAttribute,n.expr.id=t,n.params.concat(e.params),n};if(this.getQuery()){var r,s;if(Array.isArray(t)){r=[];for(var a=t.length,l=0;l<a;l++)(s=n(t[l]))&&r.push(s)}else r=n(t);return i.addColumn(r,e),r}},_checkColumn:function(t){if(!this.options.allowDuplicates)for(var e=this.getQuery().getColumns(),n=e.length,i=JSON.stringify(t.expr),o=0;o<n;o++)if(JSON.stringify(e[o].expr)===i)return null;return t},_checkColumnsArray:function(t){for(var e=0,n=t.length,i=[];e<n;e++)this._checkColumn(t[e])&&i.push(t[e]);return i},addColumn:function(t,e){var n=this,i=this.getQuery();if(i&&(t=Array.isArray(t)?this._checkColumnsArray(t):this._checkColumn(t))&&(!Array.isArray(t)||0!=t.length)){i.addColumnObj(t,e,n);var o=n.element.find("[class*="+n._getCssPrefix()+"-columns]");if(0<o.length){var r,s=t;if(s.length)for(r=0;r<s.length;++r)n._addColumnElement(o,s[r],e+r);else n._addColumnElement(o,t,e);this._updateHeaderBlock()}else n.refresh()}},trySetBlockId:function(t){var e=this.getNewColId();e&&(t.blockId=e)},removeColumn:function(t){var e=this.getQuery();if(e&&t){var n=t;if(n.length){var i;for(i=0;i<n.length;++i)this._removeColumnElement(n[i]);e.removeColumns(n,this)}else this._removeColumnElement(t),e.removeColumn(t,this)}},_removeColumnElement:function(e){var t=this._getCssPrefix();if(0<=this.getQuery().getColumns().indexOf(e)){var n=this.element.find("[class*="+t+"-row]").filter(function(t){return this.column==e});n&&(n.detach(),n.remove())}},removeColumnByAttrId:function(i){var t;t=Array.isArray(i)?function(t){for(var e=i.length,n=0;n<e;n++)if(i[n]==t)return!0;return!1}:function(t){return i==t};var e=this.getQuery();if(e){for(var n=[],o=0,r=e.getColumns(),s=r.length;o<s;){var a=r[o];a.expr.tag==F.ExprTag.EntityAttribute&&t(a.expr.id)&&n.push(r[o]),o++}this.removeColumn(n)}},_moveColumn:function(t,e){var n=this.getQuery();if(n){var i=this.element.find("[class*="+this._getCssPrefix()+"-columns]"),o=i.find("[class*="+this._getCssPrefix()+"-row]"),r=st(o[t]);0==e?r.prependTo(i):0<e&&e<o.length-1?t<e?r.insertAfter(o[e]):r.insertAfter(o[e-1]):r.appendTo(i),n.moveColumn(t,e,this)}},moveColumn:function(t,e){var n=this.getQuery().getColumns(),i=n.indexOf(t);if(0<=i)switch(e){case"MoveTop":if(0==i)return;this._moveColumn(i,0);break;case"MoveUp":if(0==i)return;this._moveColumn(i,i-1);break;case"MoveDown":if(i==n.length-1)return;this._moveColumn(i,i+1);break;case"MoveBottom":if(i==n.length-1)return;this._moveColumn(i,n.length-1)}},refresh:function(){this._render()},resize:function(){this._render()},setActiveColumnWidget:function(t){this.deactivateColumnWidget(),this._activeColumnWidget=t,this._activeColumnWidget&&(this._activeColumnWidget.internalActivate(),this.options.activeColumn=this._activeColumnWidget.getColumn())},deactivateColumnWidget:function(){this._activeColumnWidget&&(this._activeColumnWidget.internalDeactivate(),this.options.activeColumn=null)},getNewColId:function(){if(this.element.attr("id"))return this.element.attr("id")+"-col-"+ ++this._globalColCounter}}),st.widget("eqjs.ColumnsPanel",st.eqjs.ColumnsContainer,{_getCssPrefix:function(){return"eqjs-qc"}}),st.widget("eqjs.ColumnsBar",st.eqjs.ColumnsContainer,{_create:function(){this.options.showHeader=!1,this.options.isColumnsBar=!0},_getCssPrefix:function(){return"eqjs-cb"},_customExpressionsPermitted:!1}),st.widget("eqjs.SortingBar",st.eqjs.ColumnsContainer,{_create:function(){this.options.allowDragDrop=!1,this.options.showHeader=!1,this.options.accentActiveColumn=!1},moveColumn:function(t,e){var n=this.getQuery(),i=n.getSortedColumns(),o=st.inArray(t,i);if(0<=o){switch(e){case"MoveTop":if(0==o)return;F.equtils.moveArrayItem(i,o,0);break;case"MoveUp":if(0==o)return;F.equtils.moveArrayItem(i,o,o-1);break;case"MoveDown":if(o==i.length-1)return;this._moveColumn(o,o+1),F.equtils.moveArrayItem(i,o,o+1);break;case"MoveBottom":if(o==i.length-1)return;F.equtils.moveArrayItem(i,o,i.length-1)}i.forEach(function(t,e,n){t.sortIndex=e}),n.fireChangedEvent("query.column.sorting",100),this.refresh()}},getColumns:function(){return this.getQuery().getSortedColumns()},_getCssPrefix:function(){return"eqjs-srtb"},_customExpressionsPermitted:!1}),(at=jQuery).widget("eqjs.ConditionRow",{_condition:null,_parentPredicate:null,_parentPredicateWidget:null,_buttonsBlock:null,_enableButton:null,_deleteButton:null,_addConditionButton:null,_addPredicateButton:null,_checkBox:null,_keepShowingButtons:!1,_isMouseOverBlock:!1,_active:!1,options:{queryPanel:null},getQuery:function(){return this.options.queryPanel.getQuery()},getContext:function(){return this.options.queryPanel.getContext()},getModel:function(){var t=this.getQuery();return t?t.getModel():null},getCondition:function(){return this._condition},getQueryPanel:function(){return this.options.queryPanel},makeActive:function(){var t=this.getQueryPanel();t&&t.setActiveConditionWidget(this)},makeInactive:function(){var t=this.getQueryPanel();t&&t.deactivateConditionWidget()},activateByCondition:function(t){this._condition==t&&this.makeActive()},init:function(t,e,n){this.element.get(0).condition=t,this._condition=t,this._parentPredicate=e,this._parentPredicateWidget=n,this.isPredicate()?this._buttonsToShow=this.options.queryPanel&&this.options.queryPanel.options.buttons&&this.options.queryPanel.options.buttons.predicate&&at.isArray(this.options.queryPanel.options.buttons.predicate)?this.options.queryPanel.options.buttons.predicate:["addCondition","addPredicate","enable","delete"]:this._buttonsToShow=this.options.queryPanel&&this.options.queryPanel.options.buttons&&this.options.queryPanel.options.buttons.condition&&at.isArray(this.options.queryPanel.options.buttons.condition)?this.options.queryPanel.options.buttons.condition:["enable","delete"],this.refresh(),this._condition.initAsActive&&(this.makeActive(),delete this._condition.initAsActive)},_render:function(){this._clear(),this.getModel()&&this._condition&&(this._refreshByCondition(),this._condition.readOnly||(this._initButtons(),this._initCheckbox(),this.getQueryPanel().options.activeCondition==this._condition&&this.makeActive()),this._postRender())},_postRender:function(){},refresh:function(){this._render()},_isDisabled:function(){return!1===this._condition.enabled},_isParameterized:function(){return this._condition.parameterized},_isInJoin:function(){return this._condition.inJoin},_setOption:function(t,e){return 2==arguments.length?("disabled"===t?this._setConditionEnable(!e):("parameterized"===t?this._setConditionParameterized(e):"inJoin"===t?this._setConditionAsInJoin(e):this.options[t]=e,this._render()),this):"disabled"===t?this._isDisabled():"parameterized"===t?this._isParameterized():"joinOnly"===t?this._isInJoin():this.options[t]},_setConditionEnable:function(t,e){this._parentPredicate&&(t&&"enabled"in this._parentPredicate&&!this._parentPredicate.enabled||(this._setConditionEnableCore(this._condition,t,e),this._enableButton&&(t?this._enableButton.addClass("enabled"):this._enableButton.removeClass("enabled")),this._render(),this._fireConditionChange({type:"change"})))},_setConditionEnableCore:function(t,e,n){if(t.enabled=e,t.conditions&&!n)for(var i=t.conditions.length,o=0;o<i;o++)this._setConditionEnableCore(t.conditions[o],e);this._parentPredicateWidget&&this._parentPredicateWidget._checkAllDisabled()},_setConditionParameterized:function(t){this._condition.parameterized=t,this._fireConditionChange({type:"change"})},_setConditionAsInJoin:function(t){this._condition.inJoin=t,this._fireConditionChange({type:"change"})},_clear:function(){this.element.html(""),this.element.removeClass()},_refreshByCondition:function(){},_fireConditionChange:function(t){t=t||{},this.getQuery().fireChangedEvent({author:this.getQueryPanel(),changeType:"condition."+t.type||!1,what:t.what||"",condition:t.condition||this._condition,element:t.element||this.element})},remove:function(){this._parentPredicateWidget&&this._parentPredicateWidget.removeCondition(this._condition)},isPredicate:function(){return!1},_getButtonsContainer:function(){return this.element},_conditionMenuEventHandler:function(t,e){var i=this;switch(t){case"addCondition":if(e.fromMenu){if(!("addNewCondition"in i))return;var n=i.getModel().getFirstUICAttr(),o=n?n.id:-1,r=n?n.operators[0]:-1,s=this.getQuery(),a=new F.Condition;a.tag=F.CondTag.Simple,a.blockId=i.getQueryPanel().getNewCondId(),a.justAdded=!0,a.enabled=!0,a.operatorID=r;var l=new F.Expression;l.tag=s.attrClassName,l.id=o,l.kind=F.DataKind.Attribute,a.expressions.push(l),i.addCondition(a)}else i._keepShowingButtons=!0,i.options.queryPanel.showEntitiesMenu({anchor:e.target,selectedIds:null,itemSelectedCallback:function(t,e){var n=e.menuItem.data("id");i.getModel().getAttributeById(n),"addNewCondition"in i&&i.addNewCondition(n)},menuClosedCallback:function(){i._keepShowingButtons=!1,i._isMouseOverBlock||i._leaveButtonBlock()}});break;case"addPredicate":"addNewPredicate"in i&&i.addNewPredicate();break;case"param":i.option("parameterized",!i._isParameterized());break;case"inJoin":i.option("inJoin",!i._isInJoin());break;case"enable":i.option("disabled",!i._isDisabled()),i._enableButton&&i._isMouseOverBlock&&i._enableButton.trigger("mouseover");break;case"delete":i.remove();break;case"menu":var u=i._getConditionMenuOptions();if(!u.menu)return;i._keepShowingButtons=!0,u.menu.PopupMenu("showMenu",{anchor:i._menuButton,selectedIds:u.selectedItems,itemSelectedCallback:function(t,e){var n=e.menuItem.data("id");(t=t||{}).fromMenu=!0,i._conditionMenuEventHandler(n,t)},menuClosedCallback:function(){i._keepShowingButtons=!1,i._isMouseOverBlock||i._leaveButtonBlock()}})}},_getConditionMenuOptions:function(){return{menu:this.options.queryPanel.options.conditionMenu,selectedItems:[]}},_initButtons:function(){var t,e=this,n=e._getButtonsContainer();n&&(e._buttonsBlock=at("<div></div>").addClass("eqjs-qp-condition-buttonsBlock").appendTo(n),0<=e._buttonsToShow.indexOf("addCondition")&&(t=at("<div></div>").addClass("eqjs-qp-button-placeholder").appendTo(e._buttonsBlock),e._addConditionButton=at("<div></div>").addClass("eqjs-qp-condition-button eqjs-qp-condition-button-addCondition").attr("title",F.eqi18n.getText("ButtonAddCondition")).appendTo(t).click(function(t){e._conditionMenuEventHandler("addCondition",t)})),0<=e._buttonsToShow.indexOf("addPredicate")&&(t=at("<div></div>").addClass("eqjs-qp-button-placeholder").appendTo(e._buttonsBlock),e._addPredicateButton=at("<div></div>").addClass("eqjs-qp-condition-button eqjs-qp-condition-button-addPredicate").attr("title",F.eqi18n.getText("ButtonAddPredicate")).appendTo(t).click(function(){e._conditionMenuEventHandler("addPredicate")})),0<=e._buttonsToShow.indexOf("enable")&&(t=at("<div></div>").addClass("eqjs-qp-button-placeholder").appendTo(e._buttonsBlock),e._enableButton=at("<div></div>").addClass("eqjs-qp-condition-button eqjs-qp-condition-button-enable").attr("title",F.eqi18n.getText("ButtonEnable")).appendTo(t).click(function(){e._conditionMenuEventHandler("enable")})),0<=e._buttonsToShow.indexOf("delete")&&(t=at("<div></div>").addClass("eqjs-qp-button-placeholder").appendTo(e._buttonsBlock),e._deleteButton=at("<div></div>").addClass("eqjs-qp-condition-button eqjs-qp-condition-button-delete").attr("title",F.eqi18n.getText("ButtonDelete")).appendTo(t).click(function(){e._conditionMenuEventHandler("delete")})),0<=e._buttonsToShow.indexOf("menu")&&(t=at("<div></div>").addClass("eqjs-qp-button-placeholder").appendTo(e._buttonsBlock),e._menuButton=at("<div></div>").addClass("eqjs-qp-condition-button eqjs-qp-condition-button-menu").attr("title",F.eqi18n.getText("ButtonMenu")).appendTo(t).click(function(){e._conditionMenuEventHandler("menu")})),e._enableButton&&(e._isDisabled()?e._enableButton.removeClass("enabled"):e._enableButton.addClass("enabled")),n.find("[class*=eqjs-qp-condition-button]").hover(function(){at(this).addClass("eqjs-qp-condition-button-active")},function(){at(this).removeClass("eqjs-qp-condition-button-active")}),n.bind("mouseenter",function(t){return e._isMouseOverBlock=!0,e._enterButtonBlock(),t.stopPropagation(),!1}).bind("mouseleave",function(t){return e._isMouseOverBlock=!1,!e._keepShowingButtons&&e._buttonsBlock.is(":visible")&&e._leaveButtonBlock(),t.stopPropagation(),!1}),e._hideButtons(),e._adjustButtonsVisibility())},_initCheckbox:function(){var t=this,e=t._getButtonsContainer();e&&t.options.queryPanel.options.showCheckboxes&&(t._checkBox=at("<div></div>").addClass("eqjs-qp-condelement eqjs-qp-condition-checkbox").attr("title",F.eqi18n.getText("ButtonEnable")).prependTo(e).click(function(){t.option("disabled",!t._isDisabled()),t._adjustCheckbox(),t._checkBox.trigger("mouseover")}),t._adjustCheckbox())},_isFirstConditionInGroup:function(){return 0==(this._parentPredicate?at.inArray(this._condition,this._parentPredicate.conditions):0)},_renderConjunction:function(){var t=this._getButtonsContainer();if(t&&this.options.queryPanel.options.showConjunctions&&!this._isFirstConditionInGroup()){var e=F.equtils.linkTypeToStr(this._parentPredicate.linkType),n=F.eqi18n.getText("Conj"+e);n&&(this._conjuction=at("<span>"+n+"</span>").addClass("eqjs-qp-condelement eqjs-qp-condition-conjuction").prependTo(t))}},_adjustCheckbox:function(){this._checkBox&&(!1===this._condition.enabled?this._checkBox.removeClass("enabled"):this._checkBox.addClass("enabled"))},_adjustButtonsVisibility:function(){},_enterButtonBlock:function(){this._showButtons()},_leaveButtonBlock:function(){},_showButtons:function(){},_hideButtons:function(){this._addConditionButton&&this._addConditionButton.parent().hide(),this._addPredicateButton&&this._addPredicateButton.parent().hide(),this._enableButton&&this._enableButton.parent().hide(),this._deleteButton&&this._deleteButton.parent().hide(),this._menuButton&&this._menuButton.parent().hide()},internalActivate:function(){this._active=!0,this.adjustActiveClass(),this._hideButtons(),this._adjustButtonsVisibility()},internalDeactivate:function(){this._active=!1,this.adjustActiveClass(),this._hideButtons(),this._adjustButtonsVisibility()},adjustActiveClass:function(){this._active&&this.options.queryPanel.options.accentActiveCondition?this.element.addClass("active"):this.element.removeClass("active")},isActive:function(){return this._active},getLevel:function(){return this._parentPredicateWidget?this._parentPredicateWidget.getLevel()+1:0},_renderLevelOffset:function(){for(var t=this.getLevel(),e=0;e<t-1;e++)at("<div></div>").addClass("eqjs-qp-level-offset").prependTo(this._getButtonsContainer())}}),at.widget("eqjs.ConditionRow_"+F.CondTag.Simple,at.eqjs.ConditionRow,{_postRender:function(){if(this.options.queryPanel.options.spreadValueElement){var t=this.element.find(".eqjs-qp-valueelement");if(0==t.length)return;for(var e=this.element.find(".eqjs-qp-condelement"),n=0,i=0;i<e.length;i++)at(e[i]).hasClass("eqjs-qp-valueelement")||(n+=at(e[i]).outerWidth(!0));var o=at(t[0]).outerWidth(!0)-at(t[0]).width();n=n+this._buttonsBlock.width()+t.length*o;var r=this.element.width()-n;for(i=0;i<t.length;i++)at(t[i]).css("max-width",(r/t.length>>0)+"px")}},_refreshByCondition:function(){var t=this.getModel();if(this._condition&&t){var o=this;o.options.disabled=!o._condition.enabled||o._condition.readOnly,this.element.addClass("eqjs-qp-row eqjs-qp-row-condition"),!1===this._condition.enabled&&this.element.addClass("eqjs-qp-disabled"),this._condition.readOnly&&this.element.addClass("eqjs-qp-readonly"),this._condition.justAdded&&(this._updateValueExpressions(),this._condition.justAdded=!1),o._isInJoin()&&this.element.addClass("eqjs-qp-condition-injoin"),o._isParameterized()&&this.element.addClass("eqjs-qp-condition-parameterized");for(var e=t.getOperatorById(o._condition.operatorID),n=F.equtils.parseOperatorFormat(e),i=null,r=n.length,s=0;s<r;s++){var a;if("operator"===(i=n[s]).type){a=!1===this._condition.enabled||this._condition.readOnly?at("<span></span>",{text:i.text}):at("<a></a>",{href:"javascript:void(0)",text:i.text});var l=at("<div></div>");if(l.addClass("eqjs-qp-condelement eqjs-qp-operelement"),a.appendTo(l),l.appendTo(this.element),!1!==this._condition.enabled&&!this._condition.readOnly){var u=o._createOperatorsMenu(a);a.click(function(t){t.preventDefault(),u.PopupMenu("showMenu",{anchor:a})})}}else if("expression"===i.type)if(0===i.index)this._createAttrElement(this._condition.expressions[0],function(t,e){var n=t.operators[0],i=o._condition.operatorID;o._condition.operatorID=n,o._updateValueExpressions(i,e)}).appendTo(this.element);else{var d,c=this._condition.expressions[i.index];c.dataType===F.DataType.Unknown&&o._updateExprDataType(c,i.index),c.kind===F.DataKind.Attribute?(d=this._createAttrElement(c)).appendTo(this.element):((d=at("<div></div>")).appendTo(this.element),this._createValueEditor(d,c,i.index))}else"text"===i.type&&at("<span></span>").addClass("eqjs-qp-condelement").text(i.text).attr("title",i.text).appendTo(this.element)}o.options.queryPanel.options.accentActiveCondition&&o.element.click(function(){o._active?o.makeInactive():o.makeActive()}),o.adjustActiveClass(),o._adjustCheckbox(),this._renderConjunction(),this._renderLevelOffset();var h=this.getQueryPanel();h&&h.options.conditionRenderedCallback&&h.options.conditionRenderedCallback(this.element)}},_updateExprDataType:function(t,e){var n=this.getModel(),i=this._condition.expressions[0].id,o=n.getAttributeById(i);if(o){var r=this._condition.operatorID,s=n.getOperatorById(r),a=n.getOperand(o,s,e);t.dataType=a.dataType}},_createAttrElement:function(o,r){var e,s=this,t=this.getModel(),n=at("<div></div>"),a=o.id,i=a?this.getModel().getAttributeById(a):null,l=s.options.queryPanel.options.attrElementFormat;if(!1===this._condition.enabled||this._condition.readOnly)e=at("<span>"+t.getAttributeText(i,l)+"</span>");else{var u=i?t.getAttributeText(i,l):F.eqi18n.getText("MsgEmptyAttrValue");(e=at('<a href="javascript:void(0)">'+u+"</a>")).attr("title",u),e.click(function(t){t.preventDefault(),s.options.queryPanel.showEntitiesMenu({anchor:e,selectedIds:null,itemSelectedCallback:function(t,e){var n=e.menuItem.data("id"),i=s.getModel().getAttributeById(n);return o.id=n,r&&r(i,a),s.refresh(),s._fireConditionChange({type:"change",what:"attribute"}),!1},itemFilterCallback:function(t){return!0}})})}return n.addClass("eqjs-qp-condelement eqjs-qp-attrelement"),e.appendTo(n),n},_getOperatorCaption:function(t){var e=F.eqi18n.getText("Operators",t.id,"caption");return e||(e=t.caption),e},_operatorChanged:function(t,e){this._updateValueExpressions(t),this.refresh(),this._fireConditionChange({type:"change",what:"operator"})},_areCompatibleTypes:function(t,e){return void 0===t.dataType||t.dataType==e.dataType&&t.kind==e.kind},_areCompatibleEditors:function(t,e){if(!t||!e)return t==e;if(t==e)return!0;if(t.tag==e.tag){if(t.tag==F.EditorTag.Edit||t.tag==F.EditorTag.DateTime)return!0;if(t.tag==F.EditorTag.CustomList&&t.name==e.name)return!0;if(t.id==e.id)return!0}return!1},_updateValueExpressions:function(t,e){var n=this,i=this.getModel(),o=n._condition.expressions[0].id,r=i.getAttributeById(o);if(r){var s=n._condition.operatorID,a=i.getOperatorById(s);if(a){var l,u,d,c=n._condition.expressions.length;t&&(u=i.getOperatorById(t));for(var h=1;h<a.paramCount;){if(l=i.getOperand(r,a,h),u&&(d=i.getOperand(r,u,h)),l.dataType===F.DataType.Unknown&&(l.dataType=r.dataType),c<=h){var p=n._createValueExpression(l);n._condition.expressions.push(p)}else{var m,f=at.extend({},n._condition.expressions[h]),g=n._createValueExpression(l);d&&(m=n._createValueExpression(d).value),n._condition.expressions[h]=g;var y=n._getExprEditor(f,h,t,e),v=n._getExprEditor(g,h);m&&m==f.value||!n._areCompatibleEditors(y,v)||n._tryToAssignExprValue(g,f)}h++}h<c&&n._condition.expressions.splice(h,c-h)}}},_tryToAssignExprValue:function(t,e){e.value&&""!=e.value&&this._areCompatibleTypes(e,t)&&(t.value=e.value)},_createValueExpression:function(e){var t=new F.Expression;if(e.kind===F.DataKind.Query)t.tag=F.ExprTag.Query,t.dataType=e.dataType,t.kind=e.kind,t.query=this.getModel().createQuery();else if(e.kind===F.DataKind.Attribute){var n=this.getModel().getFirstAttributeByFilter(function(t){return 1==t.usedInCondition&&(!e.dataType||t.dataType==e.dataType)}),i=n?n.id:null;t.tag=F.ExprTag.EntityAttribute,t.dataType=e.dataType,t.kind=e.kind,t.id=i,t.value=i}else{var o;o=e.defValue&&""!=e.defValue?e.defValue:e.editor&&e.editor.defValue?e.editor.defValue:"",t.tag=F.ExprTag.Constant,t.dataType=e.dataType,t.kind=e.kind,t.value=o}return t},_createOperatorsMenu:function(i){var o=this;if(o._condition&&o.getModel()){var t=[],e=o.getModel().getAttributeById(o._condition.expressions[0].id);if(e)for(var n=null,r=e.operators.length,s=0;s<r;s++)if((n=o.getModel().findOperatorById(e.operators[s]))&&(!o.options.queryPanel.options.isSubQuery||n.kind!==F.DataKind.Query)){var a=o._getOperatorCaption(n);t.push({id:n.id,text:a})}var l=at("<div></div>").appendTo(i.parent()).hide(),u=o.element.attr("id");u&&(u+="-OperatorsMenu");var d={items:t,id:u,domWriteItemsId:o.options.queryPanel.options.domWriteItemsId,onMenuItemSelected:function(t,e){i.text(e.menuItem.text);var n=o._condition.operatorID;return o._condition.operatorID=e.menuItem.id,o._operatorChanged(n,o._condition.operatorID),!1}};return at.extend(d,o.options.queryPanel.options.menuOptions),l.PopupMenu(d),l}},_getExprEditor:function(t,e,n,i){var o=this.getModel(),r=i||this._condition.expressions[0].id,s=o.getAttributeById(r);n=n||this._condition.operatorID;var a=o.getOperatorById(n),l=o.getOperand(s,a,e),u=new F.ValueEditor;return l&&l.editor&&"Unknown"!==l.editor.tag?u=at.extend({},l.editor):s&&s.defaultEditor&&(u=at.extend({},s.defaultEditor)),t&&t.kind===F.DataKind.Query&&(u.tag=F.EditorTag.SubQuery),u.tag&&u.tag!=F.EditorTag.Unknown||(u.tag=F.EditorTag.Edit),u},_createValueEditor:function(t,n,e){var i=this,o=i._getExprEditor(n,e);if(o){var r="element.ValueEditor_"+o.tag+"({parentWidget:self, editor: editorObj, onChange:exprChangedCallback}); element.ValueEditor_"+o.tag+"('init', expr);";new Function("self, element, expr, editorObj, exprChangedCallback",r)(this,t,n,o,function(){if(i.getModel().getOperatorById(i._condition.operatorID).isRange){var t=i._condition.expressions[1],e=i._condition.expressions[2];0<i._compareExpressions(t,e)&&(t==n?i._copyExpr(t,e):i._copyExpr(e,t),i.refresh())}i._fireConditionChange({type:"change",what:"value"})})}},_compareExpressions:function(t,e){var n,i=t.dataType,o=this.getModel();return i===F.DataType.Date||i===F.DataType.DateTime?(n=o.getDateOrMacroValue(t.value),o.getDateOrMacroValue(e.value)<=n?1:-1):i===F.DataType.Time?(n=o.getTimeOrMacroValue(t.value),o.getTimeOrMacroValue(e.value)<=n?1:-1):i===F.DataType.Int32||i===F.DataType.Int64||i===F.DataType.Byte||i===F.DataType.Word?(n=""!==t.value?parseInt(t.value):0)-(""!==e.value?parseInt(e.value):0):i===F.DataType.Float||i===F.DataType.Currency?(n=""!==t.value?parseFloat(t.value):0)-(""!==e.value?parseFloat(e.value):0):0},_copyExpr:function(t,e){e.value=t.value,e.text=t.text},_showButtons:function(){!this.options.queryPanel.options.showCheckboxes&&this._enableButton&&this._enableButton.parent().show(),this._deleteButton&&this._deleteButton.parent().show(),this._menuButton&&this._menuButton.parent().show()},_adjustButtonsVisibility:function(){(this.options.queryPanel.options.alwaysShowButtonsInConditions||this.options.queryPanel.options.accentActiveCondition&&this._active)&&this._showButtons()},_leaveButtonBlock:function(){1==this.options.queryPanel.options.alwaysShowButtonsInConditions||this._active&&1==this.options.queryPanel.options.accentActiveCondition||this._hideButtons()},_getConditionMenuOptions:function(){var t=[];return this._isDisabled()||t.push("enable"),this._isParameterized()&&t.push("param"),this._isInJoin()&&t.push("inJoin"),{menu:this.options.queryPanel.options.conditionMenu,selectedItems:t}}}),at.widget("eqjs.ConditionRow_"+F.CondTag.Predicate,at.eqjs.ConditionRow,{_predicateRowBlock:null,_getButtonsContainer:function(){return this._predicateRowBlock},_parsePredicateText:function(t,e){var n=this,i=F.eqi18n.getText(e),o=i.indexOf("{lt}");if(o<0)t.text(F.eqi18n.getText("ErrIncorrectPredicateTitleFormat")),t.addClass("eqjs-qp-error");else{0<o&&at("<span></span>").addClass("eqjs-qp-predelement").text(i.substring(0,o)).appendTo(t);var r=at("<div></div>");r.PredicateLinkType({queryPanel:n.options.queryPanel,parentWidget:n,onChange:function(){n.refresh(),n._fireConditionChange({type:"change",what:"link"})}}),r.PredicateLinkType("init",n._condition),r.appendTo(t),at("<span></span>").addClass("eqjs-qp-predelement").text(i.substring(o+4)).appendTo(t)}},_refreshPredicateRow:function(){var t=this;t._predicateRowBlock&&(t._predicateRowBlock.html(""),t._predicateRowBlock.addClass("eqjs-qp-row eqjs-qp-row-predicate"),!1===t._condition.enabled&&t._predicateRowBlock.addClass("eqjs-qp-disabled"),t._parsePredicateText(t._predicateRowBlock,"PredicateTitle"),t.options.queryPanel.options.accentActiveCondition&&t._predicateRowBlock.click(function(){t._active?t.makeInactive():t.makeActive()}),t.adjustActiveClass(),this._renderConjunction(),this._renderLevelOffset())},_refreshByCondition:function(){this.element.addClass("eqjs-qp-predicate"),this._predicateRowBlock=at("<div></div>"),this._predicateRowBlock.appendTo(this.element),this._refreshPredicateRow(),this._addConditions(this.element);var t=this.getQueryPanel();t&&t.options.predicateRenderedCallback&&t.options.predicateRenderedCallback(this._predicateRowBlock)},_addConditions:function(t){var e=at("<div></div>");e.addClass("eqjs-qp-conditions"),e.appendTo(t);for(var n=this._condition.conditions.length,i=0;i<n;i++){var o=this._condition.conditions[i],r=at("<div></div>");o.blockId||this.trySetBlockId(o),o.blockId&&r.attr("id",o.blockId),r.appendTo(e);var s="element.ConditionRow_"+o.tag+"({queryPanel: self.options.queryPanel, model: self.getModel()}); element.ConditionRow_"+o.tag+"('init', self._condition.conditions[idx], self._condition, self);";new Function("self, element, idx",s)(this,r,i)}return e},_checkAllDisabled:function(){if(this._parentPredicate){for(var t=!0,e=this._condition.conditions.length,n=0;n<e;n++)if(this._condition.conditions[n].enabled){t=!1;break}t&&this._setConditionEnable(!1,!0)}},_moveDraggedItem:function(t,e,n){},isPredicate:function(){return!0},_containsActiveCondition:function(t){var e=t||this._condition,n=this.options.queryPanel._activeConditionWidget;return n&&(n=n.getCondition()),this.options.queryPanel.predicateContainsCondition(e,n)},removeCondition:function(t){var e=at.inArray(t,this._condition.conditions);0<=e&&(1==this._condition.conditions.length&&this._parentPredicate?this.remove():(t==this.options.queryPanel.options.activeCondition&&this.makeActive(),this._condition.conditions.splice(e,1),this.refresh(),this._fireConditionChange({type:"delete",condition:t})))},addCondition:function(t,e){if(t&&(!at.isArray(t)||0!=t.length)){var n=this;"number"==typeof e?n._condition.conditions.push.apply(n._condition.conditions,[e,0].concat(t)):n._condition.conditions.push.apply(n._condition.conditions,[].concat(t));var i=[].concat(t);at.each(i,function(t,e){n.trySetBlockId(e)}),t.initAsActive=!0,n.refresh(),n._fireConditionChange({type:"add",condition:t})}},trySetBlockId:function(t){var e=this.getQueryPanel(),n=t.tag==F.CondTag.Predicate?e.getNewPredId():e.getNewCondId();n&&(t.blockId=n)},addNewCondition:function(t,e,n){var i,o,r,s=this.getQuery(),a=s.getModel(),l=function(t){var e;return t&&!t.usedInCondition&&(t.lookupAttr?(e=t.lookupAttr,(t=a.getAttributeById(e))&&t.usedInCondition||(t=null)):t=null),t},u=function(t,e){var n=new F.Condition;n.tag=F.CondTag.Simple,n.enabled=!0,n.justAdded=!0,n.operatorID=e;var i=new F.Expression;return i.kind=F.DataKind.Attribute,i.tag=s.attrClassName,i.id=t.id,n.expressions.push(i),n};if(Array.isArray(t)){o=[];for(var d=t.length,c=0;c<d;c++)(i=l(i=a.getAttributeById(t[c])))&&(r=u(i,e||a.getDefaultOperatorIdForAttr(i)))&&o.push(r)}else{if(!(i=l(i=a.getAttributeById(t))))return;o=u(i,e||a.getDefaultOperatorIdForAttr(i))}return this.addCondition(o,n),o},addNewPredicate:function(){var t=this.getModel().getFirstUICAttr(),e=t?t.id:-1,n=t?t.operators[0]:-1,i=this.getQuery(),o=new F.Condition;o.blockId=this.getQueryPanel().getNewCondId(),o.tag=F.CondTag.Simple,o.enabled=!0,o.justAdded=!0,o.operatorID=n;var r=new F.Expression;r.kind=F.DataKind.Attribute,r.tag=i.attrClassName,r.id=e,o.expressions.push(r);var s=this._condition.linkType===F.LinkType.All?F.LinkType.Any:F.LinkType.All,a=new F.Condition;a.tag=F.CondTag.Predicate,a.linkType=s,a.conditions.push(o),this.addCondition(a)},_showButtons:function(){0!=this._condition.enabled&&(this._addConditionButton&&this._addConditionButton.parent().show(),this._addPredicateButton&&this._addPredicateButton.parent().show()),!this.options.queryPanel.options.showCheckboxes&&this._enableButton&&this._enableButton.parent().show(),this._deleteButton&&this._deleteButton.parent().show(),this._menuButton&&this._menuButton.parent().show()},_adjustButtonsVisibility:function(){(this.options.queryPanel.options.alwaysShowButtonsInPredicates||this.options.queryPanel.options.accentActiveCondition&&this._active)&&this._showButtons()},_leaveButtonBlock:function(){1==this.options.queryPanel.options.alwaysShowButtonsInPredicates||this._active&&1==this.options.queryPanel.options.accentActiveCondition||this._hideButtons()},internalActivate:function(){this._active=!0,this.adjustActiveClass(),this._hideButtons(),this._adjustButtonsVisibility()},internalDeactivate:function(){this._active=!1,this.adjustActiveClass(),this._hideButtons(),this._adjustButtonsVisibility()},adjustActiveClass:function(){this._active&&this.options.queryPanel.options.accentActiveCondition?this._predicateRowBlock.addClass("active"):this._predicateRowBlock.removeClass("active")},_getConditionMenuOptions:function(){var t=[];return this._isDisabled()||t.push("enable"),{menu:this.options.queryPanel.options.predicateMenu,selectedItems:t}}}),at.widget("eqjs.RootPredicate",at.eqjs["ConditionRow_"+F.CondTag.Predicate],{_showButtons:function(){this._addConditionButton&&this._addConditionButton.parent().show(),this._addPredicateButton&&this._addPredicateButton.parent().show(),this._menuButton&&this._menuButton.parent().show()},_initCheckbox:function(){},_renderConjunction:function(){},_refreshPredicateRow:function(){var t=this;t._predicateRowBlock&&(t._predicateRowBlock.html(""),t._predicateRowBlock.addClass("eqjs-qp-row eqjs-qp-row-predicate eqjs-qp-row-predicate-root"),t._parsePredicateText(t._predicateRowBlock,"RootPredicateTitle"),t.options.queryPanel.options.accentActiveCondition&&t._predicateRowBlock.click(function(){t._active?t.makeInactive():t.makeActive()}),t.adjustActiveClass())},_refreshByCondition:function(){this.element.addClass("eqjs-qp-predicate eqjs-qp-predicate-root"),this.options.queryPanel&&this.options.queryPanel.options.showRootRow&&(this._predicateRowBlock=at("<div></div>"),this._predicateRowBlock.appendTo(this.element),this._refreshPredicateRow()),this._addConditions(this.element).addClass("eqjs-qp-conditions-root")},_getConditionMenuOptions:function(){return{menu:this.options.queryPanel.options.rootPredicateMenu,selectedItems:[]}}}),(lt=jQuery).widget("eqjs.QueryPanel",{_activeConditionWidget:null,_rootPredicateWidget:null,_query:null,_context:null,_globalCondCounter:0,_globalPredCounter:0,_defaultMenuOptions:{showSearchBoxAfter:30,searchBoxAutoFocus:!0,activateOnMouseOver:!0},_queryObserverId:null,options:{isSubQuery:!1,activeCondition:null,listRequestHandler:null,entitiesPopupHandler:null,entitiesListFilter:null,menuContainer:document.body,showRootRow:!0,showAddRow:!0,showCheckboxes:!1,allowParameterization:!1,allowInJoinConditions:!1,showPoweredBy:!1,buttons:{condition:null,predicate:null},alwaysShowButtonsInPredicates:!1,alwaysShowButtonsInConditions:!1,showConjunctions:!0,accentActiveCondition:!0,activateRootOnStart:!0,dateFormatValue:"",yearRange:"c-10:c+10",attrElementFormat:"{entity} {attr}",menuOptions:{showSearchBoxAfter:30,searchBoxAutoFocus:!0,activateOnMouseOver:!0,itemRenderedCallback:null},allowDragDrop:!0,attrPlacement:0,sortEntities:!1,subQueryDialogWidth:600,subQueryDialogHeight:300,dialogZIndex:1e5,numberListSeparators:[",",";"],autoEditNewCondition:!1,conditionRenderedCallback:null,predicateRenderedCallback:null},addRowHeight:0,getSelf:function(){return this},getQuery:function(){return this._query},setQuery:function(t){this._setQueryObserver(!0),(this._query=t)&&(this._setQueryObserver(),this.refresh())},setContext:function(t){this._context=t},getContext:function(){return this._context},isQueryNullOrEmpty:function(){var t=this.getQuery();return!t||t.isEmptyConditions()},getModel:function(){var t=this.getQuery();return t?t.getModel():null},isModelNullOrEmpty:function(){var t=this.getModel();return!t||t.isEmpty()},_updateLists:function(){var t=F.eqconsts.constLists;for(var e in t)t.hasOwnProperty(e)&&this._updateList(t[e]);this._updateList(F.eqconsts.predicateLinkTypeList)},_updateList:function(t){if(t)for(var e=t.length,n=0;n<e;n++)t[n].text=F.eqi18n.getText(t[n].key),t[n].text||(t[n].text=t[n].key)},_create:function(){},_render:function(t){void 0===t&&(t=!1);var i=this,o=this.getModel();if(i._clear(t),i._updateLists(),i.element.addClass("eqjs-qp-panel"),!i.isModelNullOrEmpty()){i.options.entitiesList=i.getEntitiesList({addUIC:!0,addUIR:!1,addUIS:!1,attrPlacement:i.options.attrPlacement,sortEntities:i.options.sortEntities}),i.options.entitiesMenu=i._createEntitiesMenu(),i.options.rootPredicateMenu=i._createPredicateMenu(!0),i.options.predicateMenu=i._createPredicateMenu(),i.options.conditionMenu=i._createConditionMenu();var e=lt("<div></div>");if(i.element.attr("id")&&e.attr("id",i.element.attr("id")+"-pred-root"),e.appendTo(i.element),i.options.showAddRow){var n=lt('<div class="eqjs-addrow eqjs-qp-addrow"></div>');n.appendTo(i.element),i.options.showRootRow||i.isQueryNullOrEmpty()||n.addClass("eqjs-addrow-empty");var r=lt('<a href="javascript:void(0)">'+F.eqi18n.getText("CmdClickToAddCondition")+"</a>");r.appendTo(n),r.click(function(t){t.preventDefault(),i.showEntitiesMenu({anchor:r,selectedIds:null,itemSelectedCallback:function(t,e){var n=e.menuItem.data("id");return i.addNewCondition(n),!1}})}),i.addRowHeight=n.outerHeight()}i._refreshByQuery(e)}i.options.allowDragDrop&&i.element.droppable({hoverClass:"eqjs-drophover",scope:"entityAttr",drop:function(t,e){i.addNewCondition(e.draggable.data("id"))},over:function(t,e){e.helper.addClass("eqjs-qc-column-drag");var n=e.draggable.data("id");o.checkAttrProperty(n,"useInCondition")||e.helper.addClass("eqjs-qc-column-drag-forbidden")},out:function(t,e){e.helper.removeClass("eqjs-qc-column-drag"),e.helper.removeClass("eqjs-qc-column-drag-forbidden")}})},_cssPwby:function(t){t.css({color:"#4676AE",font:"11px Calibri",position:"absolute",top:"-16px",right:"3px"})},_updPwby:function(){var t=this.getModel(),e=this.options.showPoweredBy;if(this._pwdbylnk&&this._pwdbylnk.remove(),e||!t||t.eqlcns&&!t.rgdlce()){this._pwdbylnk=lt("<a></a>",{id:"PWDBY",text:"Powered by EasyQuery",href:"https://korzh.com/easyquery",target:"_blank"}).hide().appendTo(this.element);var n=this;n._cssPwby(n._pwdbylnk),0===n._pwdbylnk.parents("div[class*=ui-dialog]").length&&n._pwdbylnk.show()}},_checkActivateRootPredicate:function(){this.options.activateRootOnStart&&this._activateRootPredicate()},_activateRootPredicate:function(){this.options.showRootRow&&this._rootPredicateWidget&&this.setActiveConditionWidget(this._rootPredicateWidget)},_setOption:function(t,e){return 2==arguments.length?("model"==t?(this.clearQuery(!1),this.options[t]=e,this._render(),this._checkActivateRootPredicate()):"query"==t?this.setQuery(e):"menuOptions"==t?this.options.menuOptions=lt.extend({},this._defaultMenuOptions,e):"searchBoxAfter"==t?(this.options[t]=e,this.options.menuOptions.showSearchBoxAfter=e):(this.options[t]=e,this._render()),this):this.options[t]},_setQueryObserver:function(t){var n=this,e=this.getQuery();e&&(t&&n._queryObserverId?e.removeChangedCallback(n._queryObserverId):n._queryObserverId=e.addChangedCallback(function(t){if(t.data){var e=t.data;e.author!==n&&t.data.changeType&&t.data.changeType.indexOf("column")<0&&n.refresh(),!n.options.autoEditNewCondition||"condition.add"!=e.changeType&&("condition.change"!=e.changeType||"attribute"!=e.what&&"operator"!=e.what)||window.setTimeout(function(){n.editConditionValue(e.condition)},800)}}))},_clear:function(t){void 0===t&&(t=!1),t||this.setActiveConditionWidget(null),this.element.html("")},_refreshByQuery:function(t){var e=this.getQuery().getRootCondition();return t.RootPredicate({queryPanel:this,model:this.getModel()}),t.RootPredicate("init",e,null,null),this._rootPredicateWidget=t.data("RootPredicate"),this._rootPredicateWidget||(this._rootPredicateWidget=t.data("eqjs-RootPredicate")),t},clearConditions:function(t){this.getQuery().clearConditions(),!1!==t&&this.refresh()},clearQuery:function(t){this.getQuery().clear(),!1!==t&&this.refresh()},_fireQueryChange:function(t){this.getQuery().fireChangedEvent({source:this,changeType:"query."+t},!0)},_fireEntitiesPopup:function(t){return!!this.options.entitiesPopupHandler&&this.options.entitiesPopupHandler({query:this.getQuery(),items:t.items})},showEntitiesMenu:function(t){var e=this.options.entitiesMenu.PopupMenu("option","items");this._fireEntitiesPopup({items:e})&&this.options.entitiesMenu.PopupMenu("refreshItems",e),this.options.entitiesMenu.PopupMenu("showMenu",t)},getEntitiesList:function(t){var e=this.getModel().getEntitiesTree(t);return this.options.entitiesListFilter&&this.options.entitiesListFilter(e,t),e},editConditionValue:function(e){if(e||this.isQueryNullOrEmpty()||(e=this.getQuery().getRootCondition().conditions[0]),e){var t=this.element.find("[class*=eqjs-qp-row-condition]").filter(function(t){return this.condition==e}).find("[class*=eqjs-qp-valueelement]").first();if(0!=t.length){var n=lt(t).data();for(var i in n)0<=i.indexOf("ValueEditor_")&&n[i].showEditor()}}},_createMenu:function(t,e,n){if(this.isModelNullOrEmpty())return null;var i=lt("<div></div>").hide().appendTo(this.element),o={items:e,id:t,domWriteItemsId:this.options.domWriteItemsId,isSubQuery:!1,zIndex:1e5};return lt.extend(o,this.options.menuOptions),lt.extend(o,n),this.options.isSubQuery&&(o.zIndex=this.options.dialogZIndex+1e3,o.isSubQuery=!0),i.PopupMenu(o),i},_createEntitiesMenu:function(){var t=this.element.attr("id")||"eq-querypanel";return t+="-EntitiesMenu",this._createMenu(t,this.options.entitiesList)},_createPredicateMenu:function(t){var e=this.element.attr("id")||"eq-querypanel";t&&(e+="-Root"),e+="-PredicateMenu";var n=[{id:"addCondition",text:F.eqi18n.getText("ButtonAddCondition")},{id:"addPredicate",text:F.eqi18n.getText("ButtonAddPredicate")}];return t||(n.push({id:"enable",text:F.eqi18n.getText("MenuEnable")}),n.push({id:"delete",text:F.eqi18n.getText("ButtonDelete")})),this._createMenu(e,n,{showSearchBoxAfter:100})},_createConditionMenu:function(){var t=this.element.attr("id")||"eq-querypanel";t+="-ConditionMenu";var e=[{id:"enable",text:F.eqi18n.getText("MenuEnable")},{id:"delete",text:F.eqi18n.getText("ButtonDelete")}];return(this.options.allowParameterization||this.options.allowInJoinConditions)&&e.push({id:"delimiter",text:"---"}),this.options.allowParameterization&&e.push({id:"param",text:F.eqi18n.getText("MenuParameterization")}),this.options.allowInJoinConditions&&e.push({id:"inJoin",text:F.eqi18n.getText("MenuJoinCond")}),this._createMenu(t,e,{showSearchBoxAfter:100})},addNewCondition:function(t,e){return this._rootPredicateWidget?this._rootPredicateWidget.addNewCondition(t,e):null},addNewConditionIntoActivePredicate:function(t,e){return this._activeConditionWidget?(this._activeConditionWidget.isPredicate()?this._activeConditionWidget:this._activeConditionWidget._parentPredicateWidget).addNewCondition(t,e):this.addNewCondition(t,e)},refresh:function(){var t=this.options.activeCondition;this._render(!0),this._updPwby();var e=this.getQuery();t&&!e.isEmptyConditions()||this._checkActivateRootPredicate()},resize:function(){this.refresh()},setActiveConditionWidget:function(t){this.deactivateConditionWidget(),this._activeConditionWidget=t,this._activeConditionWidget&&(this._activeConditionWidget.internalActivate(),this.options.activeCondition=this._activeConditionWidget.getCondition())},deactivateConditionWidget:function(){this._activeConditionWidget&&(this._activeConditionWidget.internalDeactivate(),this.options.activeCondition=null)},predicateContainsCondition:function(t,e){if(!t||!e)return!1;if(t.conditions)for(var n=t.conditions.length,i=0;i<n;i++){if(t.conditions[i]==e)return!0;if(this.predicateContainsCondition(t.conditions[i],e))return!0}return!1},getNewPredId:function(){if(this.element.attr("id"))return this.element.attr("id")+"-pred-"+ ++this._globalPredCounter},getNewCondId:function(){if(this.element.attr("id"))return this.element.attr("id")+"-cond-"+ ++this._globalCondCounter}}),(ut=jQuery).widget("eqjs.FilterBar",{_queryPanelWidget:null,_query:null,_queryIsChanged:!1,_headerElement:null,_headerIconElement:null,_headerTextBlock:null,_headerTextElement:null,_headerLinkElement:null,_headerArrowBlock:null,_headerArrowElement:null,_qpBlock:null,_qpElement:null,_buttonsBlock:null,_btnApply:null,_btnClear:null,_context:null,options:{applyOnClose:!0,showApplyButton:!0,showClearButton:!0,applyFilterCallback:null,queryPanel:{showAddRow:!0,showCheckboxes:!0,alwaysShowButtonsInPredicates:!0}},getQuery:function(){return this._query},setQuery:function(t){this._query&&this._query.removeChangedCallback(ut.proxy(this._queryChangedHandler,this)),this._query=t,this._query.addChangedCallback(ut.proxy(this._queryChangedHandler,this)),this._queryIsChanged=!0,this._qpElement.QueryPanel("setQuery",this._query),this._updateHeader()},setContext:function(t){this._context=t,this._qpElement.QueryPanel("setContext",this._context)},getContext:function(){return this._context},_showQueryPanel:function(t){var e=this;e._qpBlock.slideDown(400,function(){e._updateHeader(),t&&t()})},_hideQueryPanel:function(){var t=this;t._qpBlock.slideUp(400,function(){t._qpBlock.hide(),t._updateHeader(),t.options.applyOnClose&&t.applyFilter()})},applyFilter:function(t){(this._queryIsChanged||1==t)&&this.options.applyFilterCallback&&(this.options.applyFilterCallback(),this._queryIsChanged=!1)},clearFilter:function(){this._query&&this._query.clearConditions()},_queryChangedHandler:function(t){this._updateHeader(),this._queryIsChanged=!0,t.data&&"condition.add"==t.data.changeType&&this.options.autoEditNewCondition&&this._queryPanelWidget.editConditionValue(t.data.condition)},_headerClickHandler:function(){this._qpBlock.is(":visible")?this._hideQueryPanel():this._showQueryPanel()},_cssPwby:function(t){t.css({color:"white",font:"11px Calibri",position:"absolute",top:"-16px",right:"31px"})},_create:function(){var i=this;this.element.addClass("eqjs-fb-container"),this._headerElement=ut("<div></div>").addClass("eqjs-fb-header"),this.element.append(this._headerElement),this._headerIconElement=ut("<div></div>").addClass("eqjs-fb-header-icon"),this._headerElement.append(this._headerIconElement),this._headerTextBlock=ut("<div></div>").addClass("eqjs-fb-header-textblock"),this._headerElement.append(this._headerTextBlock),this._headerTextElement=ut("<span></span>").addClass("eqjs-fb-header-text"),this._headerTextBlock.append(this._headerTextElement),this._headerLinkElement=ut('<a href="javascript:void(0)">'+F.eqi18n.getText("StrNoFilterClickToAdd")+"</a>").addClass("eqjs-fb-header-link").hide().click(function(){i._context.getBroker().getModelPromise().then(function(t){i._queryPanelWidget.showEntitiesMenu({anchor:i._headerLinkElement,selectedIds:null,itemSelectedCallback:function(t,e){var n=e.menuItem.data("id");i._showQueryPanel(function(){i._queryPanelWidget.addNewCondition(n)})}})})}),this._headerTextBlock.append(this._headerLinkElement),this._headerArrowBlock=ut("<div></div>").addClass("eqjs-fb-header-arrowblock"),this._headerElement.append(this._headerArrowBlock),this._headerArrowElement=ut("<div></div>").addClass("eqjs-fb-header-arrow"),this._headerArrowBlock.append(this._headerArrowElement),this._qpBlock=ut("<div></div>").hide(),this._qpBlock.addClass("eqjs-fb-querypanelblock"),this.element.append(this._qpBlock),this._qpElement=ut("<div></div>"),this._qpElement.addClass("query-panel eqjs-fb-querypanel"),this._qpElement.QueryPanel(this.options.queryPanel),this._qpElement.QueryPanel("setQuery",this._query),this._qpBlock.append(this._qpElement),this._queryPanelWidget=this._qpElement.data("QueryPanel"),this._queryPanelWidget||(this._queryPanelWidget=this._qpElement.data("eqjs-QueryPanel")),this._queryPanelWidget._cssPwby=this._cssPwby,(this.options.showApplyButton||this.options.showClearButton)&&(this._buttonsBlock=ut("<div></div>").addClass("eqjs-fb-buttonsblock"),this._qpBlock.append(this._buttonsBlock)),this.options.showApplyButton&&(this._btnApply=ut('<a href="javascript:void(0)"></a>').addClass("eqjs-fb-button eqjs-fb-button-apply").text(F.eqi18n.getText("ButtonApply")).on("click",ut.proxy(this.applyFilter,this)),this._buttonsBlock.append(this._btnApply)),this.options.showClearButton&&(this._btnClear=ut('<a href="javascript:void(0)"></a>').addClass("eqjs-fb-button eqjs-fb-button-clear").text(F.eqi18n.getText("ButtonClear")).on("click",ut.proxy(this.clearFilter,this)),this._buttonsBlock.append(this._btnClear)),ut(window).resize(function(){i.textResize(i)}),setTimeout(function(){i.textResize(i)},500),this._render()},textResize:function(t){t||(t=this),t._headerTextBlock.css("width",t.element.width()-t._headerIconElement.outerWidth(!0)-(t._headerArrowBlock.is(":visible")?t._headerArrowBlock.outerWidth(!0):0)+"px")},_render:function(){this._headerIconElement.empty(),this._updateHeader(),this._qpElement.QueryPanel("refresh"),this.textResize(this)},refresh:function(){this._render()},_updateHeader:function(){var t="";this._query&&(t=this._query.getConditionsText()),""==t&&(t=F.eqi18n.getText("StrNoFilterDefined")),this._headerTextElement.text(t).attr("title",t),!this._query||this._query.isEmptyConditions()?(this._headerTextElement.hide(),this._headerLinkElement.show(),this._qpBlock.is(":visible")||(this._headerArrowBlock.hide(),this._headerElement.off("click.FilterBar").css("cursor",""))):(this._headerElement.off("click.FilterBar").on("click.FilterBar",ut.proxy(this._headerClickHandler,this)).css("cursor","pointer"),this._headerTextElement.show(),this._headerLinkElement.hide(),this._headerArrowBlock.show()),this._qpBlock.is(":visible")?this._headerArrowElement.addClass("eqjs-fb-header-arrowUp"):this._headerArrowElement.removeClass("eqjs-fb-header-arrowUp"),this.textResize(this)}}),function(v){var _=function(t,e,n){if(e!==n){var i=t[e];t[e]=t[n],t[n]=i}};v.widget("eqjs.ColumnsBarOld",{_query:null,_activeColumn:null,_activeColumnIndex:null,_contentBlockClass:"eqjs-cb-inner-wrapper",_colsBlockClass:"eqjs-cb-inner",_width:0,_leftBtn:null,_rightBtn:null,_uiUpdaterId:null,options:{showAddButton:!0,addButtonSide:"left",addButtonHTML:"+",innerPaddingCompensation:{right:38,left:35},allowAggrColumns:!0,allowSorting:!0,sortByList:["None","Ascending","Descending"],placeholderHeight:22,adjustEntitiesMenuHeight:!0,attrElementFormat:"{entity} {attr}",alwaysShowButtons:!1,accentActiveColumn:!0,uiUpdateInterval:200,scrollSpeed:15,showScrollBar:!0,scrollButtonsScrollBy:500,scrollButtonsLeftHTML:"&lt; ...",scrollButtonsRightHTML:"... &gt;"},_setOption:function(t,e){if("query"!=t)return 2==arguments.length?(this.options[t]=e,this._render(),this):this.options[t];this.setQuery(e)},_create:function(){this._render()},_clear:function(){this.element.html("")},getModel:function(){var t=this.getQuery();return t?t.getModel():null},getQuery:function(){return this._query},setQuery:function(t){this._query=t,this.refresh()},init:function(t){this.setQuery(t)},refresh:function(){this._render()},resize:function(){this._render()},_render:function(){if(this._clear(),this.getModel()){this.options.entitiesList=this.getModel().getEntitiesTree({addUIC:!1,addUIR:!0,addUIS:!1}),this.options.entitiesMenu=this._createEntitiesMenu(),this._refreshByQuery();var t="eqjs-cb-with-add-button-on-";this.element.removeClass(t+"left").removeClass(t+"right"),this.options.showAddButton&&(this.element.addClass(t+this.options.addButtonSide),this._showAddButton())}},_refreshByQuery:function(){if(this.getQuery()){for(var t,e,n,i,o=this,r=v("<div></div>").addClass(o._colsBlockClass),s=v("<div></div>").addClass(o._contentBlockClass),a=o.getQuery(),l=a?a.getColumns():null,u="number"==typeof o._activeColumnIndex,d=0,c=l;d<c.length;d++){var h=c[d],p=(t=o,e=v("<div></div>").appendTo(r),i=void 0,n=l[h],(i=e["ColumnsBarColumn_"+n.expr.tag]).call(e,{columnsBar:t,query:t.getQuery()}),i.call(e,"init",n),{wfn:i,element:e});u&&+h===o._activeColumnIndex&&(p.wfn.call(p.element,"setActiveColumn"),p.element.click())}var m=r.children("div");r.appendTo(s),s.appendTo(o.element),o.options.showScrollBar?(s.css("overflow-x","auto"),o._leftBtn=null,o._rightBtn=null):(s.css("overflow-x","hidden"),o._leftBtn=o._makeScrollButton({html:o.options.scrollButtonsLeftHTML,t:"left",otherT:"right",scrollLeft:"-="+o.options.scrollButtonsScrollBy}),o._rightBtn=o._makeScrollButton({html:o.options.scrollButtonsRightHTML,t:"right",otherT:"left",scrollLeft:"+="+o.options.scrollButtonsScrollBy}),o.element.prepend(o._leftBtn.hide()),o.element.prepend(o._rightBtn.hide())),o._uiUpdaterId&&clearInterval(o._uiUpdaterId),o._uiUpdaterId=window.setInterval(function(){var t=2;m.each(function(){t+=v(this).outerWidth(!0)}),2<t&&t!==o._width&&(o._width=t,o.element.find("."+o._colsBlockClass).css({width:t})),o._leftBtn&&o._rightBtn&&(o._updateScrollButtonVisibility(o._leftBtn,"left"),o._updateScrollButtonVisibility(o._rightBtn,"right"))},o.options.uiUpdateInterval);var f,g,y=!1;r.sortable({cursor:"move",tolerance:"pointer",cancel:".eqjs-cb-column-buttonsBlock, .eqjs-cb-colelement, .eqjs-cb-sortbutton, .eqjs-ce-editbox",placeholder:"eqjs-cb-column-placeholder",forcePlaceholderSize:!0,scroll:!0,scrollSpeed:this.options.scrollSpeed,delay:100,distance:13,forceHelperSize:!0,start:function(t,e){f=e.item.index(),e.item.addClass("eqjs-cb-column-sort"),e.placeholder.height(o.options.placeholderHeight)},update:function(t,e){g=e.item.index(),y?(y=!1,l.splice(g,0,l.pop()),o.refresh()):_(l,f,g)},stop:function(t,e){e.item.removeClass("eqjs-cb-column-sort"),e.item.click(),o._fireQueryChange("change")}}),o.element.droppable({tolerance:"touch",hoverClass:"eqjs-drophover",scope:"entityAttr",drop:function(t,e){o.addNewColumn(e.draggable.attr("data-id")),y=!0},over:function(t,e){e.helper.addClass("eqjs-cb-column-drag")},out:function(t,e){e.helper.removeClass("eqjs-cb-column-drag")}}),r.children().length?s.show():s.hide()}},_makeScrollButton:function(e){var t,n=this,i=e.t,o=(e.otherT,v("<span></span>").addClass((t=i,"eqjs-cb-button-"+t)).html(e.html));return o.click(function(t){v(t.target).parent().find("."+n._contentBlockClass).animate({scrollLeft:e.scrollLeft})}),o},_updateScrollButtonVisibility:function(t,e){var n=t.parent().find("."+this._contentBlockClass),i=n.scrollLeft(),o=n.innerWidth(),r=this._width;if(this.options.showAddButton&&(r+=this.options.innerPaddingCompensation[this.options.addButtonSide]),r<=o||!o||null===i)return t.hide();({left:function(){return i},right:function(){return r-(o+i)}})[e]()<=0?t.hide():t.show()},_showAddButton:function(){var t=this.options.addButtonSide,e=v('<div class="eqjs-cb-add-button"></div>');e.prependTo(this.element).css(t,this.element.css("padding-"+t));var n=v('<a href="javascript:void(0)"></a>').html(this.options.addButtonHTML).appendTo(e),i=this;n.click(function(){i.showEntitiesMenu({anchor:n,selectedIds:null,itemSelectedCallback:function(t,e){var n=e.menuItem.id;return i.getModel().getAttributeById(n),i.addNewColumn(n),!1}})})},showEntitiesMenu:function(t,e){this.options.entitiesMenu.PopupMenu("showMenu",t)},clearColumns:function(t){this.getQuery().clearColumns(),!1!==t&&this.refresh()},_createEntitiesMenu:function(){if(!this.getModel())return null;var t=v("<div></div>").hide().appendTo(this.element);return t.PopupMenu({items:this.options.entitiesList,adjustHeight:this.options.adjustEntitiesMenuHeight}),t},_fireQueryChange:function(t){this.getQuery().fireChangedEvent({author:this,changeType:"query."+t})},_fireColumnChange:function(t,e){e=e||this._column,this.getQuery().fireChangedEvent({author:this,changeType:"column."+t,column:e})},addNewColumn:function(t,e){var r=this,n=function(t){var e=r.getModel(),n=e.getAttributeById(t);if(!n)return null;if(!n.usedInResult){if(!n.lookupAttr)return null;if(t=n.lookupAttr,!(n=e.getAttributeById(t))||!n.usedInResult)return null}var i=new F.Column;i.sorting=F.SortDirection.None,i.sortIndex=-1;var o=new F.Expression;o.id=t,o.tag=F.ExprTag.EntityAttribute,i.expr=o};if(r.getQuery()){var i,o;if(v.isArray(t)){i=[];for(var s=0;s<t.length;s++)(o=n(t[s]))&&i.push(o)}else i=n(t);return r.addColumnObj(i,e),i}},addColumn:function(t,e){var n=this.getQuery();if(n){var i=n.getColumns();if(t&&(!v.isArray(t)||0!=t.length)){var o=[].concat(t);"number"==typeof e?i.splice.apply(i,[e,0].concat(o)):i.push.apply(i,o),this._width+=4*this._initialWidth,this.refresh(),this._fireColumnChange("add",t)}}},removeColumn:function(t){var e=this.getQuery();if(e){var n=e.getColumns(),i=v.inArray(t,n);0<=i&&(i===this._activeColumnIndex&&(this._activeColumnIndex=null),n.splice(i,1),this.refresh(),this._fireColumnChange("remove",t))}},removeColumnByAttrId:function(t){var e=this.getQuery();if(e){for(var n=e.getColumns(),i=0,o=n.length;i<o;){var r=n[i];if(r.expr.tag==F.ExprTag.EntityAttribute&&r.expr.id==t)break;i++}i<o&&(n.splice(i,1),this._fireColumnChange("remove",r),this.refresh())}},setActiveColumn:function(t){this._activeColumn&&this._activeColumn.deactivate(),this._activeColumn=t,this._activeColumn&&this._activeColumn.activate()},getActiveColumn:function(){return this._activeColumn},setActiveColumnIndex:function(t){this._activeColumnIndex=t}});var i=function(t,e,n){var i=t.self.options.columnsBar._query.getColumns();if(i.length){_(i,e,n);var o=t.self.options.columnsBar.getActiveColumn();if(o&&o._active&&o.element.length){var r=o.element.index();if(r===e)return n;if(r===n)return e}}},o=function(t,e){var n=e.parent().parent().parent();void 0!==t&&n.ColumnsBar("setActiveColumnIndex",t),n.ColumnsBar("refresh")},n=[{id:"|<-",text:F.eqi18n.getText("CmdMoveToStart"),fn:function(t){o(i(t,0,t.self.element.index()),t.self.element)}},{id:"->",text:F.eqi18n.getText("CmdMoveRight"),fn:function(t){var e=t.self.element,n=e.next();n.length&&o(i(t,n.index(),e.index()),e)}},{id:"<-",text:F.eqi18n.getText("CmdMoveLeft"),fn:function(t){var e=t.self.element,n=e.prev();n.length&&o(i(t,n.index(),e.index()),e)}},{id:"->|",text:F.eqi18n.getText("CmdMoveToEnd"),fn:function(t){var e=t.self.element,n=e.parent().children().last();n.length&&o(i(t,n.index(),e.index()),e)}}];v.widget("eqjs.ColumnsBarColumn",{_column:null,_sortingButton:null,_buttonsBlock:null,_menuButton:null,_menuButtonMenu:null,_deleteButton:null,_keepShowingButtons:!1,_isMouseOverBlock:!1,_classesToAdd:"",_active:!1,options:{columnsBar:null,query:null},getQuery:function(){return this.options.columnsBar.getQuery()},getModel:function(){var t=this.getQuery();return t?t.getModel():null},init:function(t){this._column=t,this.refresh()},_render:function(){this._clear(),this.getModel()&&this._column&&(this._refreshByColumn(),this._initButtons())},_fireColumnChange:function(t,e){e=e||this._column;var n=this.qetQuery();n&&n.fireChangedEvent({query:this.options.columnsBar.options.query,changeType:"column."+t,condition:e})},refresh:function(){this._render()},_setOption:function(t,e){return 2==arguments.length?(this.options[t]=e,"disabled"===t&&(this._column.enabled=!e),this._render(),this):"disabled"===t?!1===this._column.enabled:this.options[t]},_clear:function(){this.element.unbind(),this.element.html(""),this.element.removeClass()},_refreshByColumn:function(){},remove:function(){this.options.columnsBar&&(this.options.columnsBar.removeColumn(this._column),this._fireColumnChange("delete"))},_initMenu:function(){var n=this._getMenuButtonMenuItems(),s=function(t,e,n){for(var i=0,o=t.length;i<o;i++){var r=t[i];if(r.items){if(s(r.items,e,n))return!0}else if(e==r.id)return r.fn&&r.fn(n),!0}return!1};this._menuButtonMenu=v("<div></div>").hide().appendTo(this.element),this._menuButtonMenu.PopupMenu({items:n});var i=this;i._menuButton.click(function(){i._menuButtonMenu.PopupMenu("showMenu",{anchor:i._menuButton,selectedIds:null,itemSelectedCallback:function(t,e){return s(n,e.menuItem.id,{self:i,evt:t,data:e}),!1},menuClosedCallback:function(){i._isMouseOverBlock||i._menuButtonMenu.trigger("mouseleave")}})})},_initButtons:function(){var i=this,t=i.element;t&&(i._buttonsBlock=v("<span></span>").addClass("eqjs-cb-column-buttonsBlock").appendTo(t),i._menuButton=v("<span></span>").addClass("eqjs-cb-column-button-menu").attr("title",F.eqi18n.getText("ButtonMenu")).appendTo(i._buttonsBlock),i._initMenu(),i._deleteButton=v("<span></span>").addClass("eqjs-cb-column-button-delete").attr("title",F.eqi18n.getText("ButtonDelete")).appendTo(i._buttonsBlock).click(function(){i.remove()}),i._sortingButton=v("<span></span>").addClass("eqjs-colelement eqjs-cb-button-sort").prependTo(i.element),0!=i.options.columnsBar.options.allowSorting&&(i._sortingButton.attr("title",F.eqi18n.getText("ButtonSorting")).click(function(){var t,e,n;i._column.sorting=(t=i.options.columnsBar.options.sortByList,e=i._column.sorting,(n=t.indexOf(e)+1)==t.length?t[0]:t[n]),i.refresh(),i._fireColumnChange("change")}),i._column.sorting===F.SortDirection.None&&i._sortingButton.addClass("eqjs-cb-column-button-sort-none"),i._sortingButton.hover(function(t){v(t.target).addClass("eqjs-cb-column-button-sort-active")},function(t){v(t.target).removeClass("eqjs-cb-column-button-sort-active")})),i._column.sorting===F.SortDirection.Ascending?i._sortingButton.addClass("eqjs-cb-column-button-sort-asc").attr("title",F.eqi18n.getText("ButtonSorting")):i._column.sorting===F.SortDirection.Descending&&i._sortingButton.addClass("eqjs-cb-column-button-sort-desc").attr("title",F.eqi18n.getText("ButtonSorting")),t.find("[class*=eqjs-column-button]").hover(function(t){v(t.target).addClass("eqjs-cb-column-button-sort-active")},function(t){v(t.target).removeClass("eqjs-cb-column-button-sort-active")}),t.bind("mouseenter",function(t){return i._isMouseOverBlock=!0,i._enterButtonBlock(),t.stopPropagation(),!1}).bind("mouseleave",function(t){return i._isMouseOverBlock=!1,i._keepShowingButtons||i._leaveButtonBlock(),t.stopPropagation(),!1}),i._hideButtons(),i._adjustButtonsVisibility())},_adjustButtonsVisibility:function(){(this.options.columnsBar.options.alwaysShowButtons||this.options.columnsBar.options.accentActiveColumn&&this._active)&&this._showButtons()},_enterButtonBlock:function(){this._showButtons()},_leaveButtonBlock:function(){1==this.options.columnsBar.options.alwaysShowButtons||this._active&&1==this.options.columnsBar.options.accentActiveColumn||this._hideButtons()},_showButtons:function(){var t=function(t){t.css("visibility","visible")};t(this._deleteButton),t(this._menuButton),0!=this.options.columnsBar.options.allowSorting&&t(this._sortingButton)},_hideButtons:function(){var t=function(t){t.css("visibility","hidden")};t(this._deleteButton),t(this._menuButton),this._column.sorting===F.SortDirection.None&&t(this._sortingButton)},activate:function(){this._active=!0,this.adjustActiveClass(),this._hideButtons(),this._adjustButtonsVisibility()},deactivate:function(){this._active=!1,this.adjustActiveClass(),this._hideButtons(),this._adjustButtonsVisibility()},adjustActiveClass:function(){this._active?this.element.addClass("active"):this.element.removeClass("active")},isActive:function(){return this._active},setActiveColumn:function(){this.options.columnsBar.setActiveColumn(this)}});var r=function(t){return[{id:"sep",text:"-------"}].concat(t)};v.widget("eqjs.ColumnsBarColumn_"+F.ExprTag.EntityAttribute,v.eqjs.ColumnsBarColumn,{_classesToAdd:"eqjs-cb-column eqjs-cb-column-entattr",_baseAttr:null,_menuFunctionsBlock:null,_getMenuButtonMenuItems:function(){if(!this.options.columnsBar.options.allowAggrColumns)return n;var t=this._createFunctionMenuItems(function(t){t.self._changeTypeToAggr(t.data.menuItem.id)}),e=n;return t&&(e=r(e)),t.concat(e)},_fillBaseBlock:function(t){t.addClass("eqjs-expr-block"),this._baseAttr=this._getAttribute(),this._column.caption||(this._column.caption=this._getDefaultCaption())},_refreshByColumn:function(){if(this._column&&this.getModel()){var t=this;t.element.addClass(t._classesToAdd);var e=v("<span></span>").appendTo(t.element);t._fillBaseBlock(e),t.options.columnsBar.options.accentActiveColumn&&t.element.click(function(){t._active||t.setActiveColumn()}),t._column.caption&&""!=t._column.caption||(t._column.caption=t._getDefaultCaption());var n=v("<span></span>");n.appendTo(this.element),n.ColumnsBarColumn_CaptionEditor(),n.ColumnsBarColumn_CaptionEditor("init",t._column,t._getDefaultCaption(),function(){t._fireColumnChange("change")}),t.adjustActiveClass()}},_getDefaultCaption:function(){return this._getAttributeText(this._baseAttr)},_getAttribute:function(){return this.getModel().getAttributeById(this._column.expr.id)},_getAttributeText:function(t){if(!t)return"";var e=F.eqi18n.getText("Attributes",t.id);if(e||(e=t.caption),!this.options.columnsBar)return e;var n=this.options.columnsBar.options.attrElementFormat;if(!n)return e;var i=n.replace(new RegExp("{attr}","g"),e),o=this.getModel().getFullEntityPathByAttr(t.id,".");return i=i.replace(new RegExp("{entity}","g"),o)},_changeTypeToAggr:function(t){var e=this;t||(t=e._menuFunctionsBlock.PopupMenu("option","items")[0].id);var n=e._column.expr.id,i=new F.Expression;i.tag=F.ExprTag.AggregateFunction,i.distinct=!1,i.func=t;var o=new F.Expression;o.tag=F.ExprTag.EntityAttribute,o.id=n,i.args.push(o),e._column.expr=i;var r=e._column,s=e._active;e.destroy(),e._clear(),e.element.ColumnsBarColumn_AGGRFUNC({columnsBar:e.options.columnsBar,model:e.getModel()}),e.element.ColumnsBarColumn_AGGRFUNC("init",r),e._fireColumnChange("change"),s&&(e.options.columnsBar._activeColumn=null,e.element.ColumnsBarColumn_AGGRFUNC("setActiveColumn"))},_createFunctionMenuItems:function(t){var e,n=this.getModel(),i=[],o=n.aggrFunctions,r=!0,s=!0,a=null,l=this._getAttribute();for(var u in o)o[u]&&(r=!0,"SUM"===o[u].id||"AVG"===o[u].id?r=0<=v.inArray(l.dataType,[F.DataType.Autoinc,F.DataType.Byte,F.DataType.Currency,F.DataType.Float,F.DataType.Int32,F.DataType.Int64,F.DataType.Word]):"MIN"!==o[u].id&&"MAX"!==o[u].id||(r=0<=v.inArray(l.dataType,[F.DataType.Autoinc,F.DataType.BCD,F.DataType.Byte,F.DataType.Currency,F.DataType.Date,F.DataType.DateTime,F.DataType.Float,F.DataType.Time,F.DataType.Int32,F.DataType.Int64,F.DataType.Word])),this._column.expr.func!==o[u].id||r||(s=!1),r&&(e=n.getAggrFunctionCaption(o[u].id),a={id:o[u].id,text:e,fn:t},this._column.expr.func!==a.id&&i.push(a)));return i&&!s&&(this._column.expr.func=i[0].id),i}}),v.widget("eqjs.ColumnsBarColumn_"+F.ExprTag.AggregateFunction,v.eqjs["ColumnsBarColumn_"+F.ExprTag.EntityAttribute],{_classesToAdd:"eqjs-cb-column eqjs-cb-column-aggr",_getMenuButtonMenuItems:function(){return[{id:"to-simple",text:F.eqi18n.getText("CmdToSimple"),fn:function(t){t.self._changeTypeToSimple()}}].concat(this._createFunctionMenuItems(function(t){t.self._changeTypeToSimple(),t.self._changeTypeToAggr(t.data.menuItem.id),t.self.refresh(),t.self._fireColumnChange("change")})).concat(r(n))},_displayFormatParser:{formatStr:"",pos:0,token:"text",tokenText:"",start:function(t){this.formatStr=t,this.pos=0,this.tokenText=""},skipSpaces:function(){for(;this.pos<this.formatStr.length&&" "===this.formatStr.charAt(this.pos);)this.pos++},next:function(){if(this.skipSpaces(),this.pos>=this.formatStr.length)return!1;var t=0;if("{"===this.formatStr.charAt(this.pos)){if((t=this.formatStr.indexOf("}",this.pos))<0)return!1;this.tokenText=this.formatStr.substring(this.pos,t+1),0===this.tokenText.indexOf("{attr")&&(this.token="attribute"),this.pos=t+1}else if("["===this.formatStr.charAt(this.pos)&&this.pos<this.formatStr.length-1&&"["===this.formatStr.charAt(this.pos+1))this.pos+=2,t=this.formatStr.indexOf("]]",this.pos),this.token="function",this.tokenText=this.formatStr.substring(this.pos,t),this.pos=t+2;else{this.token="text";var e=this.formatStr.indexOf("{",this.pos);e<0&&(e=this.formatStr.length);var n=this.formatStr.indexOf("[[",this.pos);n<0&&(n=this.formatStr.length),t=Math.min(e,n),this.tokenText=v.trim(this.formatStr.substring(this.pos,t)),this.pos=t}return!0}},_parseDisplayFormat:function(t){if(!t)return[];var e=[],n=this._displayFormatParser;for(n.start(t);n.next();)"function"===n.token?e.push({type:"function",text:n.tokenText}):"attribute"===n.token?e.push({type:"attribute"}):"text"===n.token&&e.push({type:"text",text:n.tokenText});return e},_fillBaseBlock:function(t){t.addClass("eqjs-expr-block eqjs-expr-block-aggr");var e=this.getModel().getAggrFunctionFormat(this._column.expr.func);if(e&&""!==e){var n=this._parseDisplayFormat(e);if(0!==n.length){for(var i,o,r=[],s=0,a=n.length;s<a;s++)"function"===(o=(i=n[s]).type)||"text"===o?r.push(i.text):"attribute"===o&&(this._baseAttr=this._getAttribute(),r.push(this._getAttributeText(this._baseAttr)));this._column.caption=r.join(" ")}}},_getDefaultCaption:function(){return this._getAttributeText(this._baseAttr)+" "+this.getModel().getAggrFunctionCaption(this._column.expr.func)},_getAttribute:function(){return this.getModel().getAttributeById(this._column.expr.argument.id)},_changeTypeToSimple:function(){var t=this,e=t._column.expr.argument.id;t._column.caption="";var n=new F.Expression;n.id=e,n.tag=F.ExprTag.EntityAttribute,t._column.expr=n;var i=t._column,o=t._active;t.destroy(),t._clear(),t.element.ColumnsBarColumn_ENTATTR({columnsBar:t.options.columnsBar,model:t.getModel()}),t.element.ColumnsBarColumn_ENTATTR("init",i),t._fireColumnChange("change"),o&&(t.options.columnsBar._activeColumn=null,t.element.ColumnsBarColumn_ENTATTR("setActiveColumn"))}}),v.widget("eqjs.ColumnsBarColumn_CaptionEditor",v.eqjs.ValueEditor_EDIT,{_column:null,_defaultValue:"",_editBoxClass:"eqjs-ce-editbox",_onChange:null,init:function(t,e,n){this._expr.value=t.caption,this._expr.text=t.caption,this._column=t,this._defaultValue=e,this._onChange=n,this.refresh()},_render:function(){this.clear(),this._column&&(this._renderCommonPart(),this._renderEditor(),this._linkElement.text(this._getDisplayText()))},_renderCommonPart:function(){var t=this;t.element.addClass(t._getClassesToAdd()),t._linkElement=v("<span></span>",{text:"-"}).appendTo(t.element),t._linkElement.dblclick(function(){return t._showEditor(),!1})},_getClassesToAdd:function(){return"eqjs-colelement eqjs-captionelement"},_setValue:function(t){return this._column.caption=t&&""!=t?t:this._defaultValue,this._linkElement.text(this._column.caption),this._onChange&&this._onChange(t),!0},_getValue:function(){return this._column.caption},_getText:function(){return this._column.caption},_getDisplayText:function(){return this._column.caption},_getZIndex:function(){return 1e5}})}(jQuery);var ct,ht,pt,mt,ft,gt,yt,vt,_t,Ct=(ct=function(t,e){return(ct=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}ct(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),xt=function(n){function t(t){var e=n.call(this,t)||this;return e.jqueryWrapper=jQuery(t),e.widgetType="columnsBar",e.group=F.WidgetGroup.Query,e}return Ct(t,n),t.prototype.init=function(t,e){n.prototype.init.call(this,t,e),this.jqueryWrapper.ColumnsBar(e),this.jqueryWrapper.ColumnsBar("setQuery",this.context.getQuery())},t.prototype.refreshCore=function(){this.jqueryWrapper.ColumnsBar("refresh")},t}(F.Widget),bt=(ht=function(t,e){return(ht=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}ht(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Tt=function(n){function t(t){var e=n.call(this,t)||this;return e.jqueryWrapper=jQuery(t),e.widgetType="columnsPanel",e.group=F.WidgetGroup.Query,e}return bt(t,n),t.prototype.init=function(t,e){n.prototype.init.call(this,t,e),this.jqueryWrapper.ColumnsPanel(e),this.jqueryWrapper.ColumnsPanel("setQuery",this.context.getQuery())},t.prototype.refreshCore=function(){this.jqueryWrapper.ColumnsPanel("refresh")},t}(F.Widget),kt=(pt=function(t,e){return(pt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}pt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),wt=function(n){function t(t){var e=n.call(this,t)||this;return e.jqueryWrapper=jQuery(t),e.widgetType="entitiesPanel",e.group=F.WidgetGroup.Model,e}return kt(t,n),t.prototype.init=function(t,e){n.prototype.init.call(this,t,e),this.jqueryWrapper.EntitiesPanel(e),this.jqueryWrapper.EntitiesPanel("setQuery",this.context.getQuery())},t.prototype.refreshCore=function(){this.jqueryWrapper.EntitiesPanel("refresh")},t}(F.Widget),Bt=(mt=function(t,e){return(mt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}mt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Et=function(n){function t(t){var e=n.call(this,t)||this;return e.jqueryWrapper=jQuery(t),e.widgetType="queryPanel",e.group=F.WidgetGroup.Query,e}return Bt(t,n),t.prototype.init=function(t,e){n.prototype.init.call(this,t,e),this.jqueryWrapper.QueryPanel(e),this.jqueryWrapper.QueryPanel("setQuery",this.context.getQuery()),this.jqueryWrapper.QueryPanel("setContext",this.context)},t.prototype.refreshCore=function(){this.jqueryWrapper.QueryPanel("refresh")},t}(F.Widget),qt=(ft=function(t,e){return(ft=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}ft(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),It=function(n){function t(t){var e=n.call(this,t)||this;return e.jqueryWrapper=jQuery(t),e.widgetType="filterBar",e.group=F.WidgetGroup.Query,e}return qt(t,n),t.prototype.init=function(t,e){n.prototype.init.call(this,t,e),this.jqueryWrapper.FilterBar(e),this.jqueryWrapper.FilterBar("setQuery",this.context.getQuery()),this.jqueryWrapper.FilterBar("setContext",this.context)},t.prototype.refreshCore=function(){this.jqueryWrapper.FilterBar("refresh")},t}(F.Widget),Mt=n(3),Dt=(gt=function(t,e){return(gt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}gt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),St=function(e){function t(){var t=e.call(this)||this;return t.setDialogService(new Mt.a),t}return Dt(t,e),t.prototype.initDone=function(){this.selectQueryMenu=jQuery("<div></div>").hide().insertAfter(this.loadQueryButton);this.selectQueryMenu.PopupMenu({items:[],multiselect:!1})},t.prototype.createDefaultBroker=function(t){return new l.a(t)},t.prototype.createEntitiesPanelWidget=function(t){return new wt(t)},t.prototype.createColumnsPanelWidget=function(t){return new Tt(t)},t.prototype.createQueryPanelWidget=function(t){return new Et(t)},t}(Y),At=(yt=function(t,e){return(yt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}yt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Pt=function(t){function e(){return t.call(this)||this}return At(e,t),e.prototype.createDefaultBroker=function(t){return new l.a(t)},e.prototype.createFilterBarWidget=function(t){return new It(t)},e}(K),Ot=(vt=function(t,e){return(vt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}vt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Lt=function(t){function e(){return t.call(this)||this}return Ot(e,t),e.prototype.createDefaultBroker=function(t){return new l.a(t)},e.prototype.createColumnsBarWidget=function(t){return new xt(t)},e.prototype.createQueryPanelWidget=function(t){return new Et(t)},e}(Z),jt=(_t=function(t,e){return(_t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}_t(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Qt=function(t){function e(){return t.call(this)||this}return jt(e,t),e.prototype.createResultGridWidget=function(t){return new S(t)},e}(Pt);n.d(e,"core",function(){return F}),n.d(e,"broker",function(){return i}),n.d(e,"ui",function(){return o}),F.equtils.assignDeep(o,r)}])});
//# sourceMappingURL=eq.all.min.js.map